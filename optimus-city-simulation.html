<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimus Perceptron ‚Äî City Walk + Technology</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a0f;--surface:#12121a;--surface2:#1a1a26;--border:#2a2a3a;
  --text:#e0e0f0;--dim:#8888aa;--accent:#00d4ff;--accent2:#7c3aed;
  --green:#10b981;--yellow:#f59e0b;--red:#ef4444;--orange:#f97316;--pink:#ec4899;
  --human-color:#f59e0b;--robot-color:#7c3aed;--car-color:#ef4444;--child-color:#10b981;
}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);overflow:hidden;height:100vh}

/* ===== TOP HEADER ===== */
.top-header{padding:8px 20px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(135deg,rgba(0,212,255,.08),rgba(124,58,237,.08));border-bottom:1px solid var(--border);z-index:200;position:relative}
.top-header h1{font-size:18px;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.top-header .sub{font-size:10px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.hud-stats{display:flex;gap:12px;font-size:10px;font-family:'JetBrains Mono',monospace}
.hud-stats .stat{display:flex;align-items:center;gap:4px}
.dot{width:7px;height:7px;border-radius:50%;animation:pulse 2s infinite}
.dot.g{background:var(--green);box-shadow:0 0 6px var(--green)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* ===== MAIN TABS ===== */
.main-tabs{display:flex;background:var(--surface);border-bottom:1px solid var(--border);z-index:200;position:relative;overflow-x:auto;scrollbar-width:none}
.main-tabs::-webkit-scrollbar{display:none}
.main-tab{flex:1 1 0;min-width:0;padding:10px 10px;font-size:10px;font-weight:700;color:var(--dim);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;text-transform:uppercase;letter-spacing:.3px;font-family:'JetBrains Mono',monospace;display:flex;align-items:center;justify-content:center;gap:5px;white-space:nowrap;text-align:center}
.main-tab:hover{color:var(--text);background:rgba(255,255,255,.02)}
.main-tab.active{color:var(--accent);border-bottom-color:var(--accent);background:rgba(0,212,255,.04)}
.main-tab .tab-icon{font-size:14px}
.tab-page{display:none;height:calc(100vh - 84px);overflow:hidden}
.tab-page.active{display:block}

/* ===== CITY SIMULATION TAB ===== */
.city-layout{display:grid;grid-template-columns:1fr 370px;height:100%}
.city-container{position:relative;overflow:hidden;background:#0d0d14}
#cityCanvas{width:100%;height:100%;display:block}
.right{display:flex;flex-direction:column;border-left:1px solid var(--border);overflow:hidden}
.vision-section{padding:8px;border-bottom:1px solid var(--border)}
.section-label{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--dim);font-weight:600;margin-bottom:5px}
.vision-cam{width:100%;aspect-ratio:16/9;background:#0a0a14;border-radius:8px;border:1px solid var(--border);position:relative;overflow:hidden}
#visionCanvas{width:100%;height:100%;display:block}
.cam-hud{position:absolute;top:5px;left:5px;font-size:9px;font-family:'JetBrains Mono',monospace;color:var(--accent);background:rgba(0,0,0,.7);padding:3px 6px;border-radius:3px;pointer-events:none}
.cam-hud-r{position:absolute;top:5px;right:5px;font-size:9px;font-family:'JetBrains Mono',monospace;color:var(--green);background:rgba(0,0,0,.7);padding:3px 6px;border-radius:3px;pointer-events:none}
.class-section{padding:8px;border-bottom:1px solid var(--border);flex-shrink:0}
.entity-list{display:flex;flex-direction:column;gap:3px;max-height:170px;overflow-y:auto}
.entity-card{display:flex;align-items:center;gap:6px;padding:5px 8px;background:var(--surface);border:1px solid var(--border);border-radius:5px;font-size:10px;transition:all .3s}
.entity-card.highlight{border-color:var(--accent);background:rgba(0,212,255,.04)}
.entity-card .e-icon{font-size:14px;width:20px;text-align:center;flex-shrink:0}
.entity-card .e-info{flex:1}
.entity-card .e-name{font-weight:700;font-size:10px}
.entity-card .e-type{font-size:7px;font-family:'JetBrains Mono',monospace;padding:1px 4px;border-radius:8px;font-weight:600}
.e-type.human{background:rgba(245,158,11,.15);color:var(--human-color)}
.e-type.robot{background:rgba(124,58,237,.15);color:var(--robot-color)}
.e-type.car{background:rgba(239,68,68,.15);color:var(--car-color)}
.e-type.child{background:rgba(16,185,129,.15);color:var(--child-color)}
.entity-card .e-dist{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--dim)}
.entity-card .e-conf{font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600}
.e-conf.high{color:var(--green)}.e-conf.mid{color:var(--yellow)}
.features-grid{display:grid;grid-template-columns:1fr 1fr;gap:3px;margin-top:5px}
.feat-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:4px 6px}
.feat-card .f-label{font-size:7px;text-transform:uppercase;letter-spacing:.5px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.feat-card .f-val{font-size:10px;font-weight:600;margin-top:1px}
.console-section{flex:1;display:flex;flex-direction:column;overflow:hidden}
.console-header{padding:6px 8px;background:var(--surface);border-bottom:1px solid var(--border);font-size:9px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.5px}
.console-body{flex:1;overflow-y:auto;padding:6px;font-family:'JetBrains Mono',monospace;font-size:9px;line-height:1.6}
.log{padding:1px 0;display:flex;gap:5px;opacity:0;animation:fadeIn .3s forwards}
@keyframes fadeIn{to{opacity:1}}
.log .lt{color:var(--dim);font-size:8px;white-space:nowrap}
.log .ltag{padding:0 4px;border-radius:3px;font-size:7px;font-weight:600;white-space:nowrap}
.ltag.vision{background:rgba(0,212,255,.12);color:var(--accent)}
.ltag.class{background:rgba(245,158,11,.12);color:var(--yellow)}
.ltag.nav{background:rgba(16,185,129,.12);color:var(--green)}
.ltag.lidar{background:rgba(124,58,237,.12);color:var(--accent2)}
.ltag.world{background:rgba(249,115,22,.12);color:var(--orange)}
.ltag.avoid{background:rgba(239,68,68,.12);color:var(--red)}
.ltag.traffic{background:rgba(245,158,11,.12);color:var(--yellow)}
.log .lmsg{flex:1;color:var(--text)}
.controls-overlay{position:absolute;bottom:10px;left:10px;display:flex;gap:5px;z-index:10;flex-wrap:wrap;max-width:500px}
.ctrl-btn{padding:5px 10px;background:rgba(0,0,0,.75);border:1px solid var(--border);border-radius:5px;color:var(--text);font-size:9px;cursor:pointer;font-family:'JetBrains Mono',monospace;transition:all .2s;backdrop-filter:blur(8px)}
.ctrl-btn:hover{border-color:var(--accent);color:var(--accent)}
.ctrl-btn.active{border-color:var(--green);color:var(--green)}
.minimap{position:absolute;top:10px;right:10px;width:130px;height:130px;background:rgba(0,0,0,.65);border:1px solid var(--border);border-radius:6px;backdrop-filter:blur(8px);overflow:hidden;z-index:10}
#minimapCanvas{width:100%;height:100%;display:block}
.stats-overlay{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.75);border:1px solid var(--border);border-radius:6px;padding:6px 10px;backdrop-filter:blur(8px);z-index:10;font-family:'JetBrains Mono',monospace;font-size:9px}
.stats-overlay .so-row{display:flex;justify-content:space-between;gap:14px;padding:1px 0}
.stats-overlay .so-label{color:var(--dim)}.stats-overlay .so-val{font-weight:600}
.collision-warn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:14px;font-weight:800;color:var(--red);font-family:'JetBrains Mono',monospace;text-shadow:0 0 10px rgba(239,68,68,.5);pointer-events:none;z-index:20;opacity:0;transition:opacity .3s}
.collision-warn.show{opacity:1}
.traffic-indicator{position:absolute;top:150px;left:10px;background:rgba(0,0,0,.75);border:1px solid var(--border);border-radius:6px;padding:6px 10px;backdrop-filter:blur(8px);z-index:10;font-family:'JetBrains Mono',monospace;font-size:9px}
.tl-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:4px}
.tl-dot.red{background:#ef4444;box-shadow:0 0 6px #ef4444}.tl-dot.green{background:#10b981;box-shadow:0 0 6px #10b981}.tl-dot.yellow{background:#f59e0b;box-shadow:0 0 6px #f59e0b}

/* ===== TECHNOLOGY TAB ===== */
.tech-layout{display:grid;grid-template-columns:260px 1fr 320px;height:100%;overflow:hidden}
.tech-col{overflow-y:auto;padding:12px;border-right:1px solid var(--border)}
.tech-col:last-child{border-right:none}

/* Architecture Stack */
.arch-title{font-size:11px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.layer-stack{display:flex;flex-direction:column;gap:5px}
.layer{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px 12px;cursor:pointer;transition:all .3s;position:relative;overflow:hidden}
.layer::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:8px 0 0 8px}
.layer:hover,.layer.active{transform:translateX(3px);border-color:var(--accent)}
.layer.active{background:rgba(0,212,255,.04)}
.layer-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}
.layer-name{font-weight:700;font-size:12px;display:flex;align-items:center;gap:6px}
.layer-badge{font-size:8px;padding:1px 6px;border-radius:10px;font-family:'JetBrains Mono',monospace;font-weight:600}
.layer-freq{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--dim)}
.layer-desc{font-size:10px;color:var(--dim);line-height:1.4}
.layer-details{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);display:none}
.layer.active .layer-details{display:block}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.detail-item{background:var(--surface2);border-radius:5px;padding:6px 8px;font-size:10px}
.detail-item .dt-label{color:var(--dim);font-size:8px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px}
.detail-item .dt-value{font-weight:600;font-size:10px}
.dataflow-arrow{text-align:center;color:var(--accent);font-size:12px;opacity:.3;height:10px;display:flex;align-items:center;justify-content:center}
.layer-vision::before{background:var(--accent)}.layer-fusion::before{background:var(--green)}.layer-world::before{background:var(--accent2)}
.layer-planner::before{background:var(--yellow)}.layer-rl::before{background:var(--orange)}.layer-control::before{background:var(--red)}.layer-memory::before{background:var(--pink)}

/* Robot body panel */
.robot-canvas{width:100%;aspect-ratio:3/5;background:var(--surface);border-radius:10px;border:1px solid var(--border);position:relative;overflow:hidden}
.robot-svg{width:100%;height:100%}
.sensor-indicators{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.sensor-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:6px 8px;font-size:10px}
.sensor-card .label{color:var(--dim);margin-bottom:2px;font-family:'JetBrains Mono',monospace;font-size:8px;text-transform:uppercase;letter-spacing:.5px}
.sensor-card .value{font-weight:600;font-size:11px}
.sensor-card .bar{height:2px;background:var(--border);border-radius:2px;margin-top:3px;overflow:hidden}
.sensor-card .bar-fill{height:100%;border-radius:2px;transition:width .5s}

/* Vision panel in tech */
.vision-tab-bar{display:flex;gap:4px;background:var(--surface);border-radius:8px;padding:3px;margin-bottom:8px}
.vision-tab{flex:1;padding:5px 4px;text-align:center;font-size:9px;font-weight:700;color:var(--dim);cursor:pointer;border-radius:6px;transition:all .2s;text-transform:uppercase;letter-spacing:.3px}
.vision-tab.active{color:var(--accent);background:rgba(0,212,255,.1)}
.vision-viewport{width:100%;aspect-ratio:16/10;background:#0d0d14;border-radius:10px;border:1px solid var(--border);position:relative;overflow:hidden}
.vision-viewport canvas{width:100%;height:100%;display:block}
.vision-hud{position:absolute;top:6px;left:6px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--accent);background:rgba(0,0,0,.6);padding:3px 6px;border-radius:4px;pointer-events:none}
.vision-hud-right{position:absolute;top:6px;right:6px;font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--green);background:rgba(0,0,0,.6);padding:3px 6px;border-radius:4px;pointer-events:none}
.vi-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:6px 8px;margin-top:4px}
.vi-card .vi-label{font-size:8px;text-transform:uppercase;letter-spacing:.5px;color:var(--dim);font-family:'JetBrains Mono',monospace;margin-bottom:2px}
.vi-card .vi-value{font-size:11px;font-weight:600}
.lidar-canvas-wrap{width:100%;aspect-ratio:16/10;background:#080810;border-radius:10px;border:1px solid var(--border);position:relative;overflow:hidden}
.lidar-canvas-wrap canvas{width:100%;height:100%;display:block}

/* Console in tech */
.tech-console{flex:1;overflow-y:auto;padding:6px;font-family:'JetBrains Mono',monospace;font-size:9px;line-height:1.7}
.log-entry{padding:2px 0;display:flex;gap:6px;opacity:0;animation:fadeIn .3s forwards}
.log-time{color:var(--dim);white-space:nowrap;font-size:9px}
.log-tag{padding:0 5px;border-radius:3px;font-size:8px;font-weight:600;white-space:nowrap}
.log-tag.vision{background:rgba(0,212,255,.15);color:var(--accent)}
.log-tag.fusion{background:rgba(16,185,129,.15);color:var(--green)}
.log-tag.world{background:rgba(124,58,237,.15);color:var(--accent2)}
.log-tag.planner{background:rgba(245,158,11,.15);color:var(--yellow)}
.log-tag.rl{background:rgba(249,115,22,.15);color:var(--orange)}
.log-tag.control{background:rgba(239,68,68,.15);color:var(--red)}
.log-tag.memory{background:rgba(236,72,153,.15);color:var(--pink)}
.log-tag.lidar{background:rgba(0,212,255,.1);color:#66e0ff}
.log-msg{color:var(--text);flex:1}
.metrics-grid{display:flex;flex-direction:column;gap:6px;margin-top:10px}
.metric-row{background:var(--surface);border-radius:6px;padding:8px;border:1px solid var(--border)}
.metric-row .metric-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.metric-row .metric-label{font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px}
.metric-row .metric-val{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:11px}
.metric-bar-container{height:3px;background:var(--surface2);border-radius:3px;overflow:hidden}
.metric-bar-fill{height:100%;border-radius:3px;transition:width .6s}

/* Right panel sub-tabs in tech */
.tech-subtabs{display:flex;border-bottom:1px solid var(--border);background:var(--surface)}
.tech-subtab{flex:1;padding:7px;text-align:center;font-size:9px;font-weight:600;color:var(--dim);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}
.tech-subtab.active{color:var(--accent);border-bottom-color:var(--accent);background:rgba(0,212,255,.04)}
.tech-subtab-content{flex:1;overflow-y:auto;padding:8px;display:none}
.tech-subtab-content.active{display:block}

/* ===== BATTERY TAB ===== */
.batt-layout{display:grid;grid-template-columns:320px 1fr;height:100%;overflow:hidden}
.batt-left{padding:16px;border-right:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column;gap:12px}
.batt-right{position:relative;overflow:hidden;background:#0d0d14}
#battMapCanvas{width:100%;height:100%;display:block}
.batt-big{text-align:center;padding:20px 10px;background:var(--surface);border:1px solid var(--border);border-radius:12px}
.batt-big .batt-pct{font-size:52px;font-weight:900;font-family:'JetBrains Mono',monospace}
.batt-big .batt-label{font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:4px}
.batt-ring{width:140px;height:140px;margin:0 auto 8px}
.batt-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.batt-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 10px}
.batt-card .bc-label{font-size:8px;text-transform:uppercase;letter-spacing:.5px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.batt-card .bc-val{font-size:14px;font-weight:700;margin-top:2px}
.batt-card .bc-sub{font-size:9px;color:var(--dim);margin-top:1px}
.station-list{display:flex;flex-direction:column;gap:5px}
.station-card{display:flex;align-items:center;gap:8px;padding:8px 10px;background:var(--surface);border:1px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s}
.station-card:hover{border-color:var(--accent);background:rgba(0,212,255,.04)}
.station-card.active{border-color:var(--green);background:rgba(16,185,129,.06)}
.station-card .st-icon{font-size:20px}
.station-card .st-info{flex:1}
.station-card .st-name{font-size:11px;font-weight:700}
.station-card .st-detail{font-size:9px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.station-card .st-status{font-size:9px;font-weight:600;padding:2px 6px;border-radius:8px}
.st-status.available{background:rgba(16,185,129,.15);color:var(--green)}
.st-status.busy{background:rgba(245,158,11,.15);color:var(--yellow)}
.st-status.offline{background:rgba(239,68,68,.15);color:var(--red)}
.charge-btn{width:100%;padding:10px;background:linear-gradient(135deg,var(--green),#059669);border:none;border-radius:8px;color:#fff;font-weight:700;font-size:12px;cursor:pointer;font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:1px;transition:all .2s}
.charge-btn:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(16,185,129,.3)}
.charge-btn:disabled{opacity:.4;cursor:not-allowed;transform:none;box-shadow:none}
.charge-log{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px;max-height:140px;overflow-y:auto;font-family:'JetBrains Mono',monospace;font-size:9px;line-height:1.7}

/* ===== TODO TAB ===== */
.todo-layout{display:grid;grid-template-columns:1fr;height:100%;overflow-y:auto;padding:20px}
.todo-week{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;max-width:1400px;margin:0 auto;width:100%}
.day-col{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;display:flex;flex-direction:column}
.day-header{padding:10px 12px;text-align:center;border-bottom:1px solid var(--border);font-weight:800;font-size:12px;text-transform:uppercase;letter-spacing:1px}
.day-header.weekday{background:linear-gradient(135deg,rgba(0,212,255,.08),rgba(124,58,237,.05));color:var(--accent)}
.day-header.weekend{background:linear-gradient(135deg,rgba(16,185,129,.1),rgba(245,158,11,.05));color:var(--green)}
.day-header .day-date{font-size:8px;color:var(--dim);font-weight:400;margin-top:2px;display:block}
.day-tasks{padding:8px;display:flex;flex-direction:column;gap:6px;flex:1}
.task-card{padding:8px 10px;border-radius:8px;border-left:3px solid;font-size:11px;transition:all .3s;position:relative}
.task-card .task-time{font-size:8px;font-family:'JetBrains Mono',monospace;color:var(--dim);margin-bottom:3px}
.task-card .task-name{font-weight:700;margin-bottom:2px}
.task-card .task-loc{font-size:9px;color:var(--dim)}
.task-card .task-status{position:absolute;top:6px;right:6px;font-size:7px;padding:1px 5px;border-radius:8px;font-weight:600;text-transform:uppercase}
.task-card.work{background:rgba(0,212,255,.06);border-color:var(--accent)}
.task-card.maintenance{background:rgba(249,115,22,.06);border-color:var(--orange)}
.task-card.leisure{background:rgba(16,185,129,.06);border-color:var(--green)}
.task-card.charge{background:rgba(245,158,11,.06);border-color:var(--yellow)}
.task-card .task-energy{font-size:8px;font-family:'JetBrains Mono',monospace;color:var(--dim);margin-top:3px;display:flex;align-items:center;gap:4px}
.task-card .energy-bar{height:3px;width:50px;background:var(--border);border-radius:3px;overflow:hidden}
.task-card .energy-fill{height:100%;border-radius:3px}
.todo-footer{grid-column:1/-1;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:10px;display:flex;justify-content:space-between;align-items:center;font-size:10px;font-family:'JetBrains Mono',monospace}
.todo-footer .tf-stat{display:flex;align-items:center;gap:6px}

/* ===== DAMAGE & REPAIR TAB ===== */
.dmg-layout{display:grid;grid-template-columns:280px 1fr 320px;height:100%;overflow:hidden}
.dmg-col{overflow-y:auto;padding:12px;border-right:1px solid var(--border)}
.dmg-col:last-child{border-right:none}
.dmg-body-wrap{width:100%;aspect-ratio:3/5;background:var(--surface);border-radius:10px;border:1px solid var(--border);position:relative;overflow:hidden;cursor:crosshair}
.dmg-body-wrap svg{width:100%;height:100%}
.dmg-indicator{position:absolute;width:16px;height:16px;border-radius:50%;border:2px solid;transform:translate(-50%,-50%);animation:dmgPulse 2s infinite;cursor:pointer;z-index:5}
.dmg-indicator.critical{border-color:#ef4444;background:rgba(239,68,68,.3)}
.dmg-indicator.warning{border-color:#f59e0b;background:rgba(245,158,11,.3)}
.dmg-indicator.minor{border-color:#10b981;background:rgba(16,185,129,.3)}
@keyframes dmgPulse{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:1}50%{transform:translate(-50%,-50%) scale(1.3);opacity:.6}}
.dmg-tooltip{position:absolute;background:rgba(0,0,0,.9);border:1px solid var(--border);border-radius:6px;padding:6px 10px;font-size:9px;font-family:'JetBrains Mono',monospace;pointer-events:none;z-index:10;white-space:nowrap;display:none}
.health-overview{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.ho-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 10px;text-align:center}
.ho-card .ho-val{font-size:20px;font-weight:900;font-family:'JetBrains Mono',monospace}
.ho-card .ho-label{font-size:8px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.parts-table{width:100%;border-collapse:collapse;font-size:10px}
.parts-table th{text-align:left;padding:6px 8px;font-size:8px;text-transform:uppercase;letter-spacing:.5px;color:var(--dim);border-bottom:1px solid var(--border);font-family:'JetBrains Mono',monospace}
.parts-table td{padding:5px 8px;border-bottom:1px solid rgba(42,42,58,.3)}
.parts-table tr:hover{background:rgba(0,212,255,.02)}
.stock-badge{font-size:8px;padding:1px 6px;border-radius:8px;font-weight:600}
.stock-badge.ok{background:rgba(16,185,129,.15);color:var(--green)}
.stock-badge.low{background:rgba(245,158,11,.15);color:var(--yellow)}
.stock-badge.out{background:rgba(239,68,68,.15);color:var(--red)}
.repair-timeline{display:flex;flex-direction:column;gap:8px}
.repair-entry{padding:10px;background:var(--surface);border:1px solid var(--border);border-radius:8px;border-left:3px solid;position:relative}
.repair-entry.critical{border-left-color:var(--red)}
.repair-entry.warning{border-left-color:var(--yellow)}
.repair-entry.routine{border-left-color:var(--green)}
.repair-entry.accident{border-left-color:var(--orange)}
.repair-entry .re-date{font-size:8px;font-family:'JetBrains Mono',monospace;color:var(--dim)}
.repair-entry .re-title{font-weight:700;font-size:11px;margin:3px 0}
.repair-entry .re-desc{font-size:10px;color:var(--dim);line-height:1.4}
.repair-entry .re-cost{font-size:9px;font-family:'JetBrains Mono',monospace;margin-top:4px;color:var(--yellow)}
.repair-entry .re-status{position:absolute;top:8px;right:8px;font-size:7px;padding:2px 6px;border-radius:8px;font-weight:600;text-transform:uppercase}
.next-service{background:linear-gradient(135deg,rgba(249,115,22,.08),rgba(239,68,68,.05));border:1px solid var(--orange);border-radius:10px;padding:12px}
.next-service .ns-title{font-size:10px;font-weight:700;color:var(--orange);text-transform:uppercase;letter-spacing:.5px}
.next-service .ns-date{font-size:18px;font-weight:900;margin:4px 0;color:var(--text)}
.next-service .ns-items{font-size:9px;color:var(--dim);line-height:1.6}
.component-bar{height:6px;background:var(--surface2);border-radius:3px;overflow:hidden;margin-top:4px}
.component-fill{height:100%;border-radius:3px;transition:width .6s}

/* ===== PADEL AI TAB ===== */
.padel-layout{display:grid;grid-template-columns:1fr 380px;height:100%;overflow:hidden}
.padel-left{display:flex;flex-direction:column;overflow:hidden}
.padel-right{overflow-y:auto;border-left:1px solid var(--border);display:flex;flex-direction:column}
.padel-court-area{flex:1;position:relative;overflow:hidden;background:#0a0a14}
#padelCanvas{width:100%;height:100%;display:block}
.padel-hud{position:absolute;top:10px;left:10px;background:rgba(0,0,0,.8);border:1px solid var(--border);border-radius:8px;padding:8px 12px;backdrop-filter:blur(8px);font-family:'JetBrains Mono',monospace;font-size:9px;z-index:10}
.padel-score{position:absolute;top:10px;right:10px;background:rgba(0,0,0,.85);border:1px solid var(--accent);border-radius:10px;padding:10px 16px;backdrop-filter:blur(8px);z-index:10;text-align:center}
.padel-score .ps-label{font-size:8px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;font-family:'JetBrains Mono',monospace}
.padel-score .ps-nums{font-size:28px;font-weight:900;font-family:'JetBrains Mono',monospace;margin:4px 0;display:flex;align-items:center;gap:10px}
.padel-score .ps-set{font-size:10px;color:var(--dim);font-family:'JetBrains Mono',monospace}
.padel-bottom{display:flex;border-top:1px solid var(--border);height:160px;flex-shrink:0}
.padel-techniques{flex:1;padding:8px;overflow-x:auto;display:flex;gap:8px;align-items:stretch}
.tech-card{min-width:140px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px;flex-shrink:0;display:flex;flex-direction:column;transition:all .3s;cursor:pointer}
.tech-card:hover{border-color:var(--accent);transform:translateY(-2px)}
.tech-card.active-move{border-color:var(--green);background:rgba(16,185,129,.06);box-shadow:0 0 15px rgba(16,185,129,.1)}
.tech-card .tc-icon{font-size:24px;text-align:center;margin-bottom:4px}
.tech-card .tc-name{font-weight:700;font-size:10px;text-align:center;margin-bottom:2px}
.tech-card .tc-desc{font-size:8px;color:var(--dim);text-align:center;line-height:1.3;flex:1}
.tech-card .tc-stats{display:flex;justify-content:space-between;margin-top:4px;font-size:8px;font-family:'JetBrains Mono',monospace}
.padel-ai-section{padding:10px;border-bottom:1px solid var(--border)}
.padel-ai-section .pas-title{font-size:9px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;display:flex;align-items:center;gap:5px}
.ai-model-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 10px;margin-bottom:5px;position:relative;overflow:hidden}
.ai-model-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:8px 0 0 8px}
.ai-model-card .mc-name{font-weight:700;font-size:11px;margin-bottom:2px}
.ai-model-card .mc-model{font-size:9px;font-family:'JetBrains Mono',monospace;color:var(--accent);margin-bottom:3px}
.ai-model-card .mc-desc{font-size:9px;color:var(--dim);line-height:1.4}
.ai-model-card .mc-metrics{display:grid;grid-template-columns:1fr 1fr;gap:4px;margin-top:5px}
.ai-model-card .mc-metric{background:var(--surface2);border-radius:4px;padding:3px 6px;font-size:8px}
.ai-model-card .mc-metric .mm-label{color:var(--dim);font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:.3px}
.ai-model-card .mc-metric .mm-val{font-weight:700;font-size:10px;margin-top:1px}
.match-history{display:flex;flex-direction:column;gap:4px}
.match-row{display:flex;align-items:center;gap:6px;padding:5px 8px;background:var(--surface);border:1px solid var(--border);border-radius:6px;font-size:10px}
.match-row.win{border-left:3px solid var(--green)}
.match-row.loss{border-left:3px solid var(--red)}
.match-row .mr-result{font-weight:800;width:18px;text-align:center}
.match-row .mr-opp{flex:1;font-weight:600}
.match-row .mr-score{font-family:'JetBrains Mono',monospace;font-weight:700;color:var(--dim)}
.match-row .mr-date{font-size:8px;color:var(--dim)}
.training-bar{height:4px;background:var(--surface2);border-radius:3px;overflow:hidden;margin-top:3px}
.training-fill{height:100%;border-radius:3px;transition:width 1s}

/* ===== AI ARCHITECTURE TAB (iframe) ===== */
.arch-frame{width:100%;height:100%;border:none;display:block}

/* ===== PAPER TAB ===== */
.paper-page{height:100%;overflow-y:auto;background:#ffffff;color:#1a1a1a}
.paper-container{max-width:820px;margin:0 auto;padding:60px 50px 80px;font-family:'Times New Roman',Georgia,'Noto Serif',serif;line-height:1.8;font-size:15px}
.paper-container *{color:#1a1a1a}
.paper-header{text-align:center;margin-bottom:40px;padding-bottom:30px;border-bottom:2px solid #1a1a1a}
.paper-title{font-size:26px;font-weight:700;line-height:1.3;margin-bottom:10px;letter-spacing:-.3px}
.paper-subtitle{font-size:15px;color:#555;margin-bottom:16px;font-style:italic}
.paper-authors{font-size:14px;margin-bottom:6px}
.paper-authors strong{font-weight:700}
.paper-affil{font-size:12px;color:#666;font-style:italic;margin-bottom:6px}
.paper-date{font-size:12px;color:#888;font-family:'JetBrains Mono',monospace}
.paper-abstract{background:#f5f7fa;border:1px solid #d0d5dd;border-radius:4px;padding:20px 24px;margin-bottom:32px}
.paper-abstract .abs-title{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
.paper-abstract p{font-size:14px;line-height:1.7;text-align:justify;margin:0}
.paper-keywords{margin-top:12px;font-size:12px;color:#555}
.paper-keywords strong{color:#1a1a1a}
.paper-section{margin-bottom:28px}
.paper-section h2{font-size:18px;font-weight:700;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid #ddd;counter-increment:section;display:flex;align-items:baseline;gap:8px}
.paper-section h2::before{content:counter(section)".";font-family:'JetBrains Mono',monospace;font-size:16px;color:#555;font-weight:600}
.paper-container{counter-reset:section}
.paper-section h3{font-size:15px;font-weight:700;margin:16px 0 8px;color:#333}
.paper-section p{text-align:justify;margin-bottom:10px}
.paper-table{width:100%;border-collapse:collapse;margin:14px 0;font-size:13px}
.paper-table th{background:#f0f2f5;border:1px solid #d0d5dd;padding:8px 10px;text-align:left;font-weight:700;font-size:12px;text-transform:uppercase;letter-spacing:.5px}
.paper-table td{border:1px solid #d0d5dd;padding:7px 10px;vertical-align:top}
.paper-table tr:nth-child(even){background:#fafbfc}
.paper-table code{font-family:'JetBrains Mono',monospace;font-size:11px;background:#eef1f6;padding:1px 5px;border-radius:3px;color:#333}
.paper-fig{margin:18px 0;text-align:center}
.paper-fig .fig-box{background:#f8f9fb;border:1px solid #d0d5dd;border-radius:6px;padding:16px;display:inline-block;max-width:100%}
.paper-fig .fig-cap{font-size:12px;color:#555;margin-top:8px;font-style:italic}
.paper-fig .fig-cap strong{color:#1a1a1a;font-style:normal}
.paper-eq{background:#f8f9fb;border-left:3px solid #333;padding:10px 16px;margin:12px 0;font-family:'JetBrains Mono',monospace;font-size:13px;overflow-x:auto}
.paper-list{margin:8px 0 12px 20px;font-size:14px;line-height:1.7}
.paper-list li{margin-bottom:4px}
.paper-list li strong{font-weight:700}
.paper-refs{font-size:12px;line-height:1.8;counter-reset:ref}
.paper-refs p{margin-bottom:2px;padding-left:28px;text-indent:-28px}
.paper-refs p::before{counter-increment:ref;content:"["counter(ref)"] ";font-family:'JetBrains Mono',monospace;font-weight:600;color:#555}
.arch-diagram{display:flex;flex-direction:column;gap:0;width:100%}
.arch-layer{display:flex;align-items:stretch;border:1px solid #c0c5cc;font-size:12px}
.arch-layer:not(:last-child){border-bottom:none}
.arch-num{width:30px;background:#333;color:#fff;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-weight:700;font-size:11px}
.arch-name{width:160px;padding:8px 10px;font-weight:700;background:#f0f2f5;border-right:1px solid #c0c5cc;font-size:12px}
.arch-desc{flex:1;padding:8px 10px;font-size:12px;color:#444}
.arch-arrow{text-align:center;font-size:14px;color:#aaa;line-height:1;padding:2px 0}

::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>

<!-- TOP HEADER -->
<div class="top-header">
  <div>
    <h1>OPTIMUS PERCEPTRON</h1>
    <div class="sub">Humanoid AI Robot ‚Äî City Navigation + Full Architecture Stack</div>
  </div>
  <div class="hud-stats">
    <div class="stat"><div class="dot g"></div>ACTIVE</div>
    <div class="stat"><span style="color:var(--dim)">ENT</span><span id="entityCount">0</span></div>
    <div class="stat"><span style="color:var(--dim)">AVOID</span><span id="avoidCount" style="color:var(--red)">0</span></div>
    <div class="stat"><span style="color:var(--dim)">WALK</span><span id="walkDist">0m</span></div>
    <div class="stat"><span style="color:var(--dim)">UP</span><span id="uptime">00:00:00</span></div>
  </div>
</div>

<!-- MAIN TABS -->
<div class="main-tabs">
  <div class="main-tab active" onclick="switchMainTab('sim',this)"><span class="tab-icon">üèôÔ∏è</span> City Simulation</div>
  <div class="main-tab" onclick="switchMainTab('tech',this)"><span class="tab-icon">‚öôÔ∏è</span> Technology Configuration</div>
  <div class="main-tab" onclick="switchMainTab('batt',this)"><span class="tab-icon">üîã</span> Battery Health</div>
  <div class="main-tab" onclick="switchMainTab('todo',this)"><span class="tab-icon">üìã</span> Todo List Robot</div>
  <div class="main-tab" onclick="switchMainTab('dmg',this)"><span class="tab-icon">üîß</span> Damage & Repair</div>
  <div class="main-tab" onclick="switchMainTab('padel',this)"><span class="tab-icon">üéæ</span> Padel AI</div>
  <div class="main-tab" onclick="switchMainTab('paper',this)"><span class="tab-icon">üìÑ</span> Paper</div>
  <div class="main-tab" onclick="switchMainTab('arch',this)"><span class="tab-icon">üß†</span> AI Architecture</div>
</div>

<!-- ==================== TAB 1: CITY SIMULATION ==================== -->
<div class="tab-page active" id="page-sim">
<div class="city-layout">
  <div class="city-container">
    <canvas id="cityCanvas"></canvas>
    <div class="collision-warn" id="collisionWarn">‚ö† OBSTACLE ‚Äî REROUTING</div>
    <div class="stats-overlay">
      <div class="so-row"><span class="so-label">Humans</span><span class="so-val" id="hSeen" style="color:var(--human-color)">0</span></div>
      <div class="so-row"><span class="so-label">Robots</span><span class="so-val" id="rSeen" style="color:var(--robot-color)">0</span></div>
      <div class="so-row"><span class="so-label">Cars</span><span class="so-val" id="cSeen" style="color:var(--car-color)">0</span></div>
      <div class="so-row"><span class="so-label">Children</span><span class="so-val" id="chSeen" style="color:var(--child-color)">0</span></div>
      <div class="so-row"><span class="so-label">Avoidances</span><span class="so-val" id="avoidances" style="color:var(--accent)">0</span></div>
    </div>
    <div class="traffic-indicator" id="trafficInd">
      <div><span class="tl-dot green" id="tlDot"></span><span id="tlText">GREEN ‚Äî WALK</span></div>
      <div style="margin-top:3px;color:var(--dim)" id="tlTimer">‚Äî</div>
    </div>
    <div class="minimap"><canvas id="minimapCanvas"></canvas></div>
    <div class="controls-overlay">
      <div class="ctrl-btn active" id="btnAuto" onclick="toggleAuto()">AUTO WALK</div>
      <div class="ctrl-btn" onclick="spawnEntity('human')">+ HUMAN</div>
      <div class="ctrl-btn" onclick="spawnEntity('child')">+ CHILD</div>
      <div class="ctrl-btn" onclick="spawnEntity('robot')">+ ROBOT</div>
      <div class="ctrl-btn" onclick="spawnEntity('car')">+ CAR</div>
      <div class="ctrl-btn" onclick="toggleFOV()">FOV</div>
    </div>
  </div>
  <div class="right">
    <div class="vision-section">
      <div class="section-label">Robot Vision ‚Äî What Optimus Sees</div>
      <div class="vision-cam"><canvas id="visionCanvas"></canvas>
        <div class="cam-hud" id="vHud">CAM | 30fps | CITY MODE</div>
        <div class="cam-hud-r" id="vHudR">0 in FOV</div>
      </div>
    </div>
    <div class="class-section">
      <div class="section-label">Detected Entities</div>
      <div class="entity-list" id="entityList"></div>
      <div class="section-label" style="margin-top:6px">Classification Features</div>
      <div class="features-grid">
        <div class="feat-card"><div class="f-label">Type</div><div class="f-val" id="fType">‚Äî</div></div>
        <div class="feat-card"><div class="f-label">Thermal</div><div class="f-val" id="fTherm">‚Äî</div></div>
        <div class="feat-card"><div class="f-label">Gait</div><div class="f-val" id="fGait">‚Äî</div></div>
        <div class="feat-card"><div class="f-label">Speed</div><div class="f-val" id="fSpd">‚Äî</div></div>
        <div class="feat-card"><div class="f-label">Danger</div><div class="f-val" id="fDanger">‚Äî</div></div>
        <div class="feat-card"><div class="f-label">Action</div><div class="f-val" id="fAction">‚Äî</div></div>
      </div>
    </div>
    <div class="console-section">
      <div class="console-header">Activity Log</div>
      <div class="console-body" id="consoleBody"></div>
    </div>
  </div>
</div>
</div>

<!-- ==================== TAB 2: TECHNOLOGY CONFIGURATION ==================== -->
<div class="tab-page" id="page-tech">
<div class="tech-layout">
  <!-- LEFT: Robot Body -->
  <div class="tech-col">
    <div class="section-label">Robot Body</div>
    <div class="robot-canvas">
      <svg class="robot-svg" viewBox="0 0 240 400">
        <defs>
          <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#1a1a2a" stroke-width="0.5"/></pattern>
          <linearGradient id="blueGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2a5acc"/><stop offset="100%" stop-color="#1a3a8a"/></linearGradient>
          <linearGradient id="redGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#dd3333"/><stop offset="100%" stop-color="#aa1a1a"/></linearGradient>
          <linearGradient id="silverGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#bbb"/><stop offset="100%" stop-color="#888"/></linearGradient>
          <linearGradient id="darkGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#555"/><stop offset="100%" stop-color="#333"/></linearGradient>
        </defs>
        <rect width="240" height="400" fill="url(#grid)"/>
        <!-- FOV indicator -->
        <path d="M108 50 L40 10 L200 10 L132 50" fill="rgba(0,120,255,.04)" stroke="rgba(0,120,255,.4)" stroke-width=".5" stroke-dasharray="3 2" opacity=".5"/>
        <text x="120" y="8" text-anchor="middle" font-size="6" fill="#44bbff" opacity=".5">FOV 120¬∞</text>
        <!-- LiDAR ring -->
        <ellipse cx="120" cy="32" rx="24" ry="4" fill="none" stroke="var(--green)" stroke-width=".8" stroke-dasharray="2 2" opacity=".5"><animate attributeName="stroke-dashoffset" values="0;20" dur="2s" repeatCount="indefinite"/></ellipse>
        <text x="120" y="27" text-anchor="middle" font-size="6" fill="var(--green)" opacity=".5">LiDAR</text>
        <!-- HEAD - Blue helmet -->
        <ellipse cx="120" cy="58" rx="26" ry="30" fill="url(#blueGrad)" stroke="#2a6aee" stroke-width="1.5"/>
        <!-- Helmet crest -->
        <polygon points="120,22 115,38 125,38" fill="url(#blueGrad)" stroke="#2a6aee" stroke-width="1"/>
        <!-- Helmet horns/antennae -->
        <polygon points="97,35 90,18 100,38" fill="#2a6aee" stroke="#44bbff" stroke-width=".8"/>
        <polygon points="143,35 150,18 140,38" fill="#2a6aee" stroke="#44bbff" stroke-width=".8"/>
        <!-- Antenna tips -->
        <circle cx="90" cy="18" r="2.5" fill="#44bbff" opacity=".9"><animate attributeName="opacity" values=".9;.3;.9" dur="1.5s" repeatCount="indefinite"/></circle>
        <circle cx="150" cy="18" r="2.5" fill="#44bbff" opacity=".9"><animate attributeName="opacity" values=".9;.3;.9" dur="1.5s" begin=".3s" repeatCount="indefinite"/></circle>
        <!-- Face plate - silver -->
        <rect x="103" y="48" width="34" height="18" rx="3" fill="url(#silverGrad)" stroke="#999" stroke-width="1"/>
        <!-- Eyes - glowing blue -->
        <ellipse cx="111" cy="52" rx="5" ry="3.5" fill="#0a0a14" stroke="#44bbff" stroke-width="1"/>
        <ellipse cx="129" cy="52" rx="5" ry="3.5" fill="#0a0a14" stroke="#44bbff" stroke-width="1"/>
        <ellipse cx="111" cy="52" rx="3" ry="2" fill="#44bbff" opacity=".9"><animate attributeName="opacity" values=".9;.3;.9" dur="3s" repeatCount="indefinite"/></ellipse>
        <ellipse cx="129" cy="52" rx="3" ry="2" fill="#44bbff" opacity=".9"><animate attributeName="opacity" values=".9;.3;.9" dur="3s" begin=".2s" repeatCount="indefinite"/></ellipse>
        <!-- Mouth grille -->
        <rect x="108" y="58" width="24" height="8" rx="2" fill="#555" stroke="#777" stroke-width=".5"/>
        <line x1="112" y1="59" x2="112" y2="65" stroke="#444" stroke-width="1"/>
        <line x1="116" y1="59" x2="116" y2="65" stroke="#444" stroke-width="1"/>
        <line x1="120" y1="59" x2="120" y2="65" stroke="#444" stroke-width="1"/>
        <line x1="124" y1="59" x2="124" y2="65" stroke="#444" stroke-width="1"/>
        <line x1="128" y1="59" x2="128" y2="65" stroke="#444" stroke-width="1"/>
        <!-- NECK -->
        <rect x="112" y="86" width="16" height="14" rx="3" fill="url(#darkGrad)" stroke="#666" stroke-width="1"/>
        <!-- TORSO/CHEST - Red (Optimus Prime signature) -->
        <path d="M78 100 L162 100 L158 200 L82 200 Z" fill="url(#redGrad)" stroke="#ff3333" stroke-width="1.5"/>
        <!-- Chest windshield windows -->
        <rect x="88" y="110" width="28" height="35" rx="3" fill="rgba(100,180,255,.2)" stroke="rgba(150,200,255,.4)" stroke-width=".8"/>
        <rect x="124" y="110" width="28" height="35" rx="3" fill="rgba(100,180,255,.2)" stroke="rgba(150,200,255,.4)" stroke-width=".8"/>
        <!-- Windshield divider -->
        <line x1="120" y1="108" x2="120" y2="148" stroke="rgba(200,50,50,.6)" stroke-width="2"/>
        <!-- Autobot insignia -->
        <polygon points="120,155 112,168 116,163 120,166 124,163 128,168" fill="rgba(255,50,50,.5)" stroke="rgba(255,100,100,.6)" stroke-width=".5"/>
        <!-- Center core glow -->
        <circle cx="120" cy="180" r="8" fill="#0a0a14" stroke="#ff3333" stroke-width="1.5"><animate attributeName="r" values="8;9;8" dur="2s" repeatCount="indefinite"/></circle>
        <circle cx="120" cy="180" r="4" fill="#ff3333" opacity=".6"><animate attributeName="opacity" values=".6;.2;.6" dur="2s" repeatCount="indefinite"/></circle>
        <!-- SHOULDERS - Red armored -->
        <path d="M78 100 L48 108 L50 150 L78 142 Z" fill="url(#redGrad)" stroke="#ff3333" stroke-width="1"/>
        <path d="M162 100 L192 108 L190 150 L162 142 Z" fill="url(#redGrad)" stroke="#ff3333" stroke-width="1"/>
        <!-- Shoulder armor plates -->
        <rect x="50" y="112" width="24" height="6" rx="2" fill="rgba(255,255,255,.08)" stroke="rgba(255,100,100,.3)" stroke-width=".5"/>
        <rect x="166" y="112" width="24" height="6" rx="2" fill="rgba(255,255,255,.08)" stroke="rgba(255,100,100,.3)" stroke-width=".5"/>
        <!-- ARMS - Silver/grey mechanical -->
        <rect x="46" y="152" width="22" height="50" rx="6" fill="url(#silverGrad)" stroke="#aaa" stroke-width="1"/>
        <rect x="172" y="152" width="22" height="50" rx="6" fill="url(#silverGrad)" stroke="#aaa" stroke-width="1"/>
        <!-- Forearms -->
        <rect x="44" y="204" width="18" height="40" rx="5" fill="url(#silverGrad)" stroke="#999" stroke-width="1"/>
        <rect x="178" y="204" width="18" height="40" rx="5" fill="url(#silverGrad)" stroke="#999" stroke-width="1"/>
        <!-- Hands -->
        <ellipse cx="53" cy="252" rx="10" ry="8" fill="url(#darkGrad)" stroke="#777" stroke-width="1"/>
        <ellipse cx="187" cy="252" rx="10" ry="8" fill="url(#darkGrad)" stroke="#777" stroke-width="1"/>
        <!-- WAIST -->
        <rect x="86" y="200" width="68" height="14" rx="4" fill="url(#darkGrad)" stroke="#666" stroke-width="1"/>
        <!-- LEGS - Blue mechanical -->
        <rect x="86" y="216" width="28" height="55" rx="6" fill="url(#blueGrad)" stroke="#2a5acc" stroke-width="1"/>
        <rect x="126" y="216" width="28" height="55" rx="6" fill="url(#blueGrad)" stroke="#2a5acc" stroke-width="1"/>
        <!-- Knee joints -->
        <circle cx="100" cy="272" r="6" fill="url(#darkGrad)" stroke="#666" stroke-width="1"/>
        <circle cx="140" cy="272" r="6" fill="url(#darkGrad)" stroke="#666" stroke-width="1"/>
        <!-- Lower legs -->
        <rect x="84" y="280" width="26" height="50" rx="5" fill="url(#blueGrad)" stroke="#2a5acc" stroke-width="1"/>
        <rect x="130" y="280" width="26" height="50" rx="5" fill="url(#blueGrad)" stroke="#2a5acc" stroke-width="1"/>
        <!-- Wheel details on legs -->
        <circle cx="97" cy="305" r="8" fill="#222" stroke="#444" stroke-width="1"/>
        <circle cx="97" cy="305" r="3" fill="#555"/>
        <circle cx="143" cy="305" r="8" fill="#222" stroke="#444" stroke-width="1"/>
        <circle cx="143" cy="305" r="3" fill="#555"/>
        <!-- FEET -->
        <ellipse cx="97" cy="338" rx="18" ry="8" fill="url(#blueGrad)" stroke="#2a5acc" stroke-width="1"/>
        <ellipse cx="143" cy="338" rx="18" ry="8" fill="url(#blueGrad)" stroke="#2a5acc" stroke-width="1"/>
        <!-- Sensor indicators -->
        <circle cx="120" cy="35" r="3" fill="var(--green)" opacity=".7"><animate attributeName="opacity" values=".7;.2;.7" dur="1.5s" repeatCount="indefinite"/></circle>
        <circle cx="53" cy="252" r="2.5" fill="var(--yellow)" opacity=".7"><animate attributeName="opacity" values=".7;.2;.7" dur="2s" repeatCount="indefinite"/></circle>
        <circle cx="187" cy="252" r="2.5" fill="var(--yellow)" opacity=".7"><animate attributeName="opacity" values=".7;.2;.7" dur="2s" begin=".5s" repeatCount="indefinite"/></circle>
        <circle cx="97" cy="338" r="2.5" fill="var(--orange)" opacity=".7"><animate attributeName="opacity" values=".7;.2;.7" dur="1.8s" repeatCount="indefinite"/></circle>
        <circle cx="143" cy="338" r="2.5" fill="var(--orange)" opacity=".7"><animate attributeName="opacity" values=".7;.2;.7" dur="1.8s" begin=".3s" repeatCount="indefinite"/></circle>
      </svg>
    </div>
    <div class="section-label" style="margin-top:8px">Sensor Telemetry</div>
    <div class="sensor-indicators">
      <div class="sensor-card"><div class="label">Stereo Vision</div><div class="value" id="t_vFPS">30 FPS</div><div class="bar"><div class="bar-fill" style="width:85%;background:var(--accent)"></div></div></div>
      <div class="sensor-card"><div class="label">LiDAR</div><div class="value">128ch Active</div><div class="bar"><div class="bar-fill" style="width:95%;background:var(--green)"></div></div></div>
      <div class="sensor-card"><div class="label">IMU</div><div class="value">Stable</div><div class="bar"><div class="bar-fill" style="width:92%;background:var(--green)"></div></div></div>
      <div class="sensor-card"><div class="label">Force/Torque</div><div class="value" id="t_ftVal">12.4 N</div><div class="bar"><div class="bar-fill" style="width:60%;background:var(--yellow)"></div></div></div>
      <div class="sensor-card"><div class="label">Tactile</div><div class="value">Active</div><div class="bar"><div class="bar-fill" style="width:78%;background:var(--orange)"></div></div></div>
      <div class="sensor-card"><div class="label">Depth</div><div class="value">0.3‚Äì5.2m</div><div class="bar"><div class="bar-fill" style="width:88%;background:var(--accent2)"></div></div></div>
    </div>
  </div>

  <!-- CENTER: Architecture Stack + Vision -->
  <div class="tech-col" style="display:flex;flex-direction:column;gap:10px">
    <div class="arch-title">AI Stack ‚Äî Dataflow Pipeline</div>
    <div class="layer-stack">
      <div class="layer layer-vision" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>üëÅ Vision Model</span><span class="layer-badge" style="background:rgba(0,212,255,.15);color:var(--accent)">PERCEPTION</span></div><div class="layer-freq">30 Hz</div></div><div class="layer-desc">ViT-L/14 + DETR: object detection, segmentation, pose estimation, depth inference.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">Model</div><div class="dt-value">ViT-L/14 + DETR</div></div><div class="detail-item"><div class="dt-label">Input</div><div class="dt-value">Stereo RGB 1280√ó720</div></div><div class="detail-item"><div class="dt-label">Output</div><div class="dt-value">3D BBox + Seg Map</div></div><div class="detail-item"><div class="dt-label">Latency</div><div class="dt-value">33 ms</div></div></div></div></div>
      <div class="dataflow-arrow">‚ñº</div>
      <div class="layer layer-fusion" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>üîó Sensor Fusion</span><span class="layer-badge" style="background:rgba(16,185,129,.15);color:var(--green)">EMBODIMENT</span></div><div class="layer-freq">200 Hz</div></div><div class="layer-desc">EKF merges IMU, joints, force/torque, LiDAR, tactile ‚Üí unified body state.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">Method</div><div class="dt-value">EKF + Factor Graph</div></div><div class="detail-item"><div class="dt-label">State Dim</div><div class="dt-value">84 (28j √ó 3)</div></div><div class="detail-item"><div class="dt-label">CoM</div><div class="dt-value">[0.02, -0.01, 0.82]</div></div><div class="detail-item"><div class="dt-label">Contacts</div><div class="dt-value">2 (both feet)</div></div></div></div></div>
      <div class="dataflow-arrow">‚ñº</div>
      <div class="layer layer-world" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>üåç World Model</span><span class="layer-badge" style="background:rgba(124,58,237,.15);color:var(--accent2)">SIMULATION</span></div><div class="layer-freq">10 Hz</div></div><div class="layer-desc">3D scene reconstruction, SLAM + Dreamer-v3 latent dynamics, physics prediction.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">Map</div><div class="dt-value">Voxel 0.02m</div></div><div class="detail-item"><div class="dt-label">Objects</div><div class="dt-value">8 tracked</div></div><div class="detail-item"><div class="dt-label">Predict</div><div class="dt-value">Dreamer-v3</div></div><div class="detail-item"><div class="dt-label">Lookahead</div><div class="dt-value">2.5 sec</div></div></div></div></div>
      <div class="dataflow-arrow">‚ñº</div>
      <div class="layer layer-planner" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>üß† Planner (LLM)</span><span class="layer-badge" style="background:rgba(245,158,11,.15);color:var(--yellow)">COGNITION</span></div><div class="layer-freq">~1 Hz</div></div><div class="layer-desc">LLM 7B multimodal + PDDL symbolic planner + Behavior Trees ‚Üí executable subtasks.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">LLM</div><div class="dt-value">Multimodal 7B</div></div><div class="detail-item"><div class="dt-label">Symbolic</div><div class="dt-value">PDDL + BT</div></div><div class="detail-item"><div class="dt-label">Goal</div><div class="dt-value">City Navigation</div></div><div class="detail-item"><div class="dt-label">Subtasks</div><div class="dt-value">Continuous</div></div></div></div></div>
      <div class="dataflow-arrow">‚ñº</div>
      <div class="layer layer-rl" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>‚ö° RL / Motor Policy</span><span class="layer-badge" style="background:rgba(249,115,22,.15);color:var(--orange)">EXECUTION</span></div><div class="layer-freq">200 Hz</div></div><div class="layer-desc">PPO/SAC policy ‚Üí joint torques + grasp forces. Residual learning for sim-to-real.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">Algo</div><div class="dt-value">PPO + Residual</div></div><div class="detail-item"><div class="dt-label">Actions</div><div class="dt-value">28j + 2 grip</div></div><div class="detail-item"><div class="dt-label">Reward</div><div class="dt-value">+0.87</div></div><div class="detail-item"><div class="dt-label">Policy</div><div class="dt-value">locomotion_v4</div></div></div></div></div>
      <div class="dataflow-arrow">‚ñº</div>
      <div class="layer layer-control" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>üî¥ Real-Time Control</span><span class="layer-badge" style="background:rgba(239,68,68,.15);color:var(--red)">STABILITY</span></div><div class="layer-freq">1000 Hz</div></div><div class="layer-desc">PID + ZMP balance controller. 1ms loop, torque control, reflex override, safety shutdown.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">Controller</div><div class="dt-value">PID + ZMP</div></div><div class="detail-item"><div class="dt-label">Latency</div><div class="dt-value">&lt; 1 ms</div></div><div class="detail-item"><div class="dt-label">Balance</div><div class="dt-value">Stable</div></div><div class="detail-item"><div class="dt-label">Safety</div><div class="dt-value">OK</div></div></div></div></div>
      <div class="dataflow-arrow" style="opacity:.15">‚ñº</div>
      <div class="layer layer-memory" onclick="toggleLayer(this)"><div class="layer-header"><div class="layer-name"><span>üíæ Memory</span><span class="layer-badge" style="background:rgba(236,72,153,.15);color:var(--pink)">PERSISTENT</span></div><div class="layer-freq">Async</div></div><div class="layer-desc">Episodic, semantic, spatial memory + vector DB (FAISS) + graph memory.</div><div class="layer-details"><div class="detail-grid"><div class="detail-item"><div class="dt-label">Episodic</div><div class="dt-value">142 events</div></div><div class="detail-item"><div class="dt-label">Spatial</div><div class="dt-value">City map</div></div><div class="detail-item"><div class="dt-label">Semantic</div><div class="dt-value">12.4K</div></div><div class="detail-item"><div class="dt-label">Vector DB</div><div class="dt-value">FAISS</div></div></div></div></div>
    </div>
  </div>

  <!-- RIGHT: Console + Metrics -->
  <div class="tech-col" style="display:flex;flex-direction:column;padding:0;border-right:none">
    <div class="tech-subtabs">
      <div class="tech-subtab active" onclick="switchTechTab('tconsole',this)">Console</div>
      <div class="tech-subtab" onclick="switchTechTab('tmetrics',this)">Metrics</div>
    </div>
    <div class="tech-subtab-content active" id="tab-tconsole">
      <div class="tech-console" id="techConsole"></div>
    </div>
    <div class="tech-subtab-content" id="tab-tmetrics" style="padding:8px">
      <div class="metrics-grid">
        <div class="metric-row"><div class="metric-header"><div class="metric-label">CPU</div><div class="metric-val" id="cpuVal" style="color:var(--accent)">62%</div></div><div class="metric-bar-container"><div class="metric-bar-fill" id="cpuBar" style="width:62%;background:var(--accent)"></div></div></div>
        <div class="metric-row"><div class="metric-header"><div class="metric-label">GPU</div><div class="metric-val" id="gpuVal" style="color:var(--accent2)">78%</div></div><div class="metric-bar-container"><div class="metric-bar-fill" id="gpuBar" style="width:78%;background:var(--accent2)"></div></div></div>
        <div class="metric-row"><div class="metric-header"><div class="metric-label">Battery</div><div class="metric-val" id="battVal" style="color:var(--green)">84%</div></div><div class="metric-bar-container"><div class="metric-bar-fill" id="battBar" style="width:84%;background:var(--green)"></div></div></div>
        <div class="metric-row"><div class="metric-header"><div class="metric-label">Network</div><div class="metric-val" id="netVal" style="color:var(--yellow)">12 ms</div></div><div class="metric-bar-container"><div class="metric-bar-fill" id="netBar" style="width:12%;background:var(--yellow)"></div></div></div>
        <div class="metric-row"><div class="metric-header"><div class="metric-label">RAM</div><div class="metric-val" id="memVal" style="color:var(--pink)">6.2/16GB</div></div><div class="metric-bar-container"><div class="metric-bar-fill" id="memBar" style="width:39%;background:var(--pink)"></div></div></div>
        <div class="metric-row"><div class="metric-header"><div class="metric-label">Thermal</div><div class="metric-val" id="thermVal" style="color:var(--orange)">42¬∞C</div></div><div class="metric-bar-container"><div class="metric-bar-fill" id="thermBar" style="width:42%;background:var(--orange)"></div></div></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ==================== TAB 3: BATTERY HEALTH ==================== -->
<div class="tab-page" id="page-batt">
<div class="batt-layout">
  <div class="batt-left">
    <div class="section-label">Battery Status</div>
    <div class="batt-big">
      <div class="batt-ring">
        <canvas id="battRingCanvas" width="140" height="140"></canvas>
      </div>
      <div class="batt-pct" id="battPctBig" style="color:var(--green)">84%</div>
      <div class="batt-label">Li-Ion 48V / 120Ah ‚Äî <span id="battState">Discharging</span></div>
    </div>
    <div class="batt-info-grid">
      <div class="batt-card"><div class="bc-label">Voltage</div><div class="bc-val" id="battVolt">48.2V</div><div class="bc-sub">Nominal 48V</div></div>
      <div class="batt-card"><div class="bc-label">Current</div><div class="bc-val" id="battAmp">-3.8A</div><div class="bc-sub" id="battAmpSub">Discharging</div></div>
      <div class="batt-card"><div class="bc-label">Temperature</div><div class="bc-val" id="battTemp">34¬∞C</div><div class="bc-sub">Optimal range</div></div>
      <div class="batt-card"><div class="bc-label">Health</div><div class="bc-val" id="battHealth" style="color:var(--green)">96.2%</div><div class="bc-sub">523 cycles</div></div>
      <div class="batt-card"><div class="bc-label">Est. Range</div><div class="bc-val" id="battRange">12.4 km</div><div class="bc-sub" id="battRangeSub">~4.1 hrs walk</div></div>
      <div class="batt-card"><div class="bc-label">Power Draw</div><div class="bc-val" id="battPower">182W</div><div class="bc-sub">Avg 175W</div></div>
    </div>
    <div class="section-label" style="margin-top:4px">Charging Stations</div>
    <div class="station-list" id="stationList"></div>
    <button class="charge-btn" id="chargeBtn" onclick="goToNearestStation()">‚ö° Navigate to Nearest Charger</button>
    <div class="section-label" style="margin-top:4px">Charge Log</div>
    <div class="charge-log" id="chargeLog"></div>
  </div>
  <div class="batt-right">
    <canvas id="battMapCanvas"></canvas>
    <div style="position:absolute;top:10px;left:10px;background:rgba(0,0,0,.75);border:1px solid var(--border);border-radius:8px;padding:8px 12px;backdrop-filter:blur(8px);font-family:'JetBrains Mono',monospace;font-size:9px;z-index:10">
      <div style="font-weight:700;color:var(--accent);margin-bottom:4px">CHARGING STATION MAP</div>
      <div style="display:flex;align-items:center;gap:5px;margin:2px 0"><div style="width:8px;height:8px;border-radius:50%;background:var(--green)"></div> Available</div>
      <div style="display:flex;align-items:center;gap:5px;margin:2px 0"><div style="width:8px;height:8px;border-radius:50%;background:var(--yellow)"></div> Busy</div>
      <div style="display:flex;align-items:center;gap:5px;margin:2px 0"><div style="width:8px;height:8px;border-radius:50%;background:var(--red)"></div> Offline</div>
      <div style="display:flex;align-items:center;gap:5px;margin:2px 0"><div style="width:10px;height:10px;border-radius:2px;background:#2a6aee"></div> Optimus</div>
    </div>
  </div>
</div>
</div>

<!-- ==================== TAB 4: TODO LIST ROBOT ==================== -->
<div class="tab-page" id="page-todo">
<div class="todo-layout">
  <div style="grid-column:1/-1;text-align:center;margin-bottom:10px">
    <div style="font-size:18px;font-weight:900;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent">OPTIMUS PRIME ‚Äî WEEKLY TASK SCHEDULE</div>
    <div style="font-size:10px;color:var(--dim);font-family:'JetBrains Mono',monospace;margin-top:4px">Autonomous task assignment ‚Ä¢ Auto-charge when battery &lt; 20% ‚Ä¢ Service mode on weekends</div>
  </div>
  <div class="todo-week" id="todoWeek"></div>
  <div class="todo-footer">
    <div class="tf-stat"><span style="color:var(--dim)">Total Tasks</span><span id="todoTotal" style="font-weight:700;color:var(--accent)">0</span></div>
    <div class="tf-stat"><span style="color:var(--dim)">Completed</span><span id="todoDone" style="font-weight:700;color:var(--green)">0</span></div>
    <div class="tf-stat"><span style="color:var(--dim)">In Progress</span><span id="todoProgress" style="font-weight:700;color:var(--yellow)">0</span></div>
    <div class="tf-stat"><span style="color:var(--dim)">Energy Used</span><span id="todoEnergy" style="font-weight:700;color:var(--orange)">0 kWh</span></div>
    <div class="tf-stat"><span style="color:var(--dim)">Week</span><span style="font-weight:700;color:var(--accent2)">17 Feb ‚Äî 23 Feb 2026</span></div>
  </div>
</div>
</div>

<!-- ==================== TAB 5: DAMAGE & REPAIR ==================== -->
<div class="tab-page" id="page-dmg">
<div class="dmg-layout">
  <!-- LEFT: Body Damage Map -->
  <div class="dmg-col">
    <div class="section-label">Body Damage Map</div>
    <div class="dmg-body-wrap" id="dmgBodyWrap">
      <svg viewBox="0 0 240 400">
        <defs>
          <pattern id="dgrid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#1a1a2a" stroke-width="0.5"/></pattern>
          <linearGradient id="dBlueG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#2a5acc"/><stop offset="100%" stop-color="#1a3a8a"/></linearGradient>
          <linearGradient id="dRedG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#dd3333"/><stop offset="100%" stop-color="#aa1a1a"/></linearGradient>
          <linearGradient id="dSilverG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#bbb"/><stop offset="100%" stop-color="#888"/></linearGradient>
          <linearGradient id="dDarkG" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#555"/><stop offset="100%" stop-color="#333"/></linearGradient>
        </defs>
        <rect width="240" height="400" fill="url(#dgrid)"/>
        <!-- Head -->
        <ellipse cx="120" cy="58" rx="26" ry="30" fill="url(#dBlueG)" stroke="#2a6aee" stroke-width="1.5" opacity=".7"/>
        <polygon points="120,22 115,38 125,38" fill="url(#dBlueG)" stroke="#2a6aee" stroke-width="1" opacity=".7"/>
        <polygon points="97,35 90,18 100,38" fill="#2a6aee" stroke="#44bbff" stroke-width=".8" opacity=".7"/>
        <polygon points="143,35 150,18 140,38" fill="#2a6aee" stroke="#44bbff" stroke-width=".8" opacity=".7"/>
        <rect x="103" y="48" width="34" height="18" rx="3" fill="url(#dSilverG)" stroke="#999" stroke-width="1" opacity=".7"/>
        <!-- Neck -->
        <rect x="112" y="86" width="16" height="14" rx="3" fill="url(#dDarkG)" stroke="#666" stroke-width="1" opacity=".7"/>
        <!-- Torso -->
        <path d="M78 100 L162 100 L158 200 L82 200 Z" fill="url(#dRedG)" stroke="#ff3333" stroke-width="1.5" opacity=".7"/>
        <!-- Shoulders -->
        <path d="M78 100 L48 108 L50 150 L78 142 Z" fill="url(#dRedG)" stroke="#ff3333" stroke-width="1" opacity=".7"/>
        <path d="M162 100 L192 108 L190 150 L162 142 Z" fill="url(#dRedG)" stroke="#ff3333" stroke-width="1" opacity=".7"/>
        <!-- Arms -->
        <rect x="46" y="152" width="22" height="50" rx="6" fill="url(#dSilverG)" stroke="#aaa" stroke-width="1" opacity=".7"/>
        <rect x="172" y="152" width="22" height="50" rx="6" fill="url(#dSilverG)" stroke="#aaa" stroke-width="1" opacity=".7"/>
        <rect x="44" y="204" width="18" height="40" rx="5" fill="url(#dSilverG)" stroke="#999" stroke-width="1" opacity=".7"/>
        <rect x="178" y="204" width="18" height="40" rx="5" fill="url(#dSilverG)" stroke="#999" stroke-width="1" opacity=".7"/>
        <!-- Hands -->
        <ellipse cx="53" cy="252" rx="10" ry="8" fill="url(#dDarkG)" stroke="#777" stroke-width="1" opacity=".7"/>
        <ellipse cx="187" cy="252" rx="10" ry="8" fill="url(#dDarkG)" stroke="#777" stroke-width="1" opacity=".7"/>
        <!-- Waist -->
        <rect x="86" y="200" width="68" height="14" rx="4" fill="url(#dDarkG)" stroke="#666" stroke-width="1" opacity=".7"/>
        <!-- Legs -->
        <rect x="86" y="216" width="28" height="55" rx="6" fill="url(#dBlueG)" stroke="#2a5acc" stroke-width="1" opacity=".7"/>
        <rect x="126" y="216" width="28" height="55" rx="6" fill="url(#dBlueG)" stroke="#2a5acc" stroke-width="1" opacity=".7"/>
        <circle cx="100" cy="272" r="6" fill="url(#dDarkG)" stroke="#666" stroke-width="1" opacity=".7"/>
        <circle cx="140" cy="272" r="6" fill="url(#dDarkG)" stroke="#666" stroke-width="1" opacity=".7"/>
        <rect x="84" y="280" width="26" height="50" rx="5" fill="url(#dBlueG)" stroke="#2a5acc" stroke-width="1" opacity=".7"/>
        <rect x="130" y="280" width="26" height="50" rx="5" fill="url(#dBlueG)" stroke="#2a5acc" stroke-width="1" opacity=".7"/>
        <!-- Feet -->
        <ellipse cx="97" cy="338" rx="18" ry="8" fill="url(#dBlueG)" stroke="#2a5acc" stroke-width="1" opacity=".7"/>
        <ellipse cx="143" cy="338" rx="18" ry="8" fill="url(#dBlueG)" stroke="#2a5acc" stroke-width="1" opacity=".7"/>
        <!-- Component labels -->
        <text x="120" y="62" text-anchor="middle" font-size="6" fill="rgba(255,255,255,.4)" font-family="JetBrains Mono">HEAD</text>
        <text x="120" y="155" text-anchor="middle" font-size="6" fill="rgba(255,255,255,.4)" font-family="JetBrains Mono">TORSO</text>
        <text x="57" y="180" text-anchor="middle" font-size="5" fill="rgba(255,255,255,.4)" font-family="JetBrains Mono">R-ARM</text>
        <text x="183" y="180" text-anchor="middle" font-size="5" fill="rgba(255,255,255,.4)" font-family="JetBrains Mono">L-ARM</text>
        <text x="100" y="250" text-anchor="middle" font-size="5" fill="rgba(255,255,255,.4)" font-family="JetBrains Mono">R-LEG</text>
        <text x="140" y="250" text-anchor="middle" font-size="5" fill="rgba(255,255,255,.4)" font-family="JetBrains Mono">L-LEG</text>
      </svg>
      <div id="dmgIndicators"></div>
    </div>
    <div class="section-label" style="margin-top:8px">Component Health</div>
    <div id="componentHealth"></div>
  </div>

  <!-- CENTER: Repair History & Service Schedule -->
  <div class="dmg-col" style="display:flex;flex-direction:column;gap:12px">
    <div class="section-label">Overall System Health</div>
    <div class="health-overview">
      <div class="ho-card"><div class="ho-val" id="dmgOverall" style="color:var(--green)">87%</div><div class="ho-label">Overall Health</div></div>
      <div class="ho-card"><div class="ho-val" id="dmgIncidents" style="color:var(--yellow)">14</div><div class="ho-label">Total Incidents</div></div>
      <div class="ho-card"><div class="ho-val" id="dmgRepairs" style="color:var(--accent)">11</div><div class="ho-label">Repairs Done</div></div>
      <div class="ho-card"><div class="ho-val" id="dmgUptime" style="color:var(--green)">98.2%</div><div class="ho-label">Uptime Rate</div></div>
    </div>

    <div class="next-service">
      <div class="ns-title">üìÖ Next Scheduled Service</div>
      <div class="ns-date">Minggu, 23 Feb 2026</div>
      <div class="ns-items">
        ‚Ä¢ Full body inspection & diagnostic scan<br>
        ‚Ä¢ Joint lubrication (all 28 joints)<br>
        ‚Ä¢ Servo motor calibration<br>
        ‚Ä¢ Sensor array cleaning & alignment<br>
        ‚Ä¢ Software update v4.2.1 ‚Üí v4.3.0<br>
        ‚Ä¢ Tire/wheel bearing check
      </div>
    </div>

    <div class="section-label">Repair & Incident History</div>
    <div class="repair-timeline" id="repairTimeline"></div>
  </div>

  <!-- RIGHT: Spare Parts Inventory -->
  <div class="dmg-col" style="display:flex;flex-direction:column;gap:12px">
    <div class="section-label">Spare Parts Inventory</div>
    <table class="parts-table">
      <thead><tr><th>Part</th><th>Stock</th><th>Status</th></tr></thead>
      <tbody id="partsTableBody"></tbody>
    </table>

    <div class="section-label">Maintenance Costs (Monthly)</div>
    <div id="costSummary" style="display:flex;flex-direction:column;gap:6px"></div>

    <div class="section-label">Active Alerts</div>
    <div id="dmgAlerts" style="display:flex;flex-direction:column;gap:5px"></div>

    <div class="section-label">Damage Log (Real-time)</div>
    <div class="charge-log" id="dmgLog" style="max-height:200px"></div>
  </div>
</div>
</div>

<!-- ==================== TAB 6: PADEL AI ==================== -->
<div class="tab-page" id="page-padel">
<div class="padel-layout">
  <!-- LEFT: Court + Techniques -->
  <div class="padel-left">
    <div class="padel-court-area">
      <canvas id="padelCanvas"></canvas>
      <div class="padel-hud">
        <div style="font-weight:700;color:var(--accent);margin-bottom:4px">üéæ PADEL AI DOUBLES</div>
        <div style="color:var(--dim)">Mode: <span id="padelMode" style="color:var(--green)">Doubles Rally (2v2)</span></div>
        <div style="color:var(--dim)">Ball Speed: <span id="padelBallSpd" style="color:var(--yellow)">0 km/h</span></div>
        <div style="color:var(--dim)">Rally Count: <span id="padelRally" style="color:var(--accent)">0</span></div>
        <div style="color:var(--dim)">Reaction: <span id="padelReact" style="color:var(--green)">0 ms</span></div>
      </div>
      <div class="padel-score">
        <div class="ps-label">Doubles Match ‚Äî Training Mode</div>
        <div class="ps-nums">
          <span style="color:#2a6aee" id="psOptimus">0</span>
          <span style="color:var(--dim);font-size:14px">vs</span>
          <span style="color:#ef4444" id="psOpponent">0</span>
        </div>
        <div class="ps-set"><span style="color:#2a6aee">OPTIMUS</span> + <span style="color:#10b981">NEXUS-4</span></div>
        <div class="ps-set">vs <span style="color:#ef4444">ATLAS-X9</span> + <span style="color:#f59e0b">VOLT-12</span></div>
        <div class="ps-set" style="margin-top:4px">Set: <span id="psSetScore">0-0</span> | Game: <span id="psGameScore">0-0</span></div>
      </div>
    </div>
    <div class="padel-bottom">
      <div class="padel-techniques" id="padelTechniques"></div>
    </div>
  </div>

  <!-- RIGHT: AI Stack + Match History -->
  <div class="padel-right">
    <div class="padel-ai-section">
      <div class="pas-title">üëÅÔ∏è Vision & Tracking AI</div>
      <div class="ai-model-card" style="--before-bg:var(--accent)">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent);border-radius:8px 0 0 8px"></div>
        <div class="mc-name">Ball Trajectory Predictor</div>
        <div class="mc-model">YOLOv9-Padel + Kalman Filter + LSTM-256</div>
        <div class="mc-desc">Deteksi bola real-time 240fps, prediksi lintasan 800ms ke depan termasuk pantulan dinding & kaca. Tracking multi-bounce prediction.</div>
        <div class="mc-metrics">
          <div class="mc-metric"><div class="mm-label">Accuracy</div><div class="mm-val" style="color:var(--green)" id="pvAcc">97.8%</div></div>
          <div class="mc-metric"><div class="mm-label">Latency</div><div class="mm-val" style="color:var(--accent)" id="pvLat">4.2ms</div></div>
          <div class="mc-metric"><div class="mm-label">Predict Ahead</div><div class="mm-val" style="color:var(--yellow)">800ms</div></div>
          <div class="mc-metric"><div class="mm-label">FPS</div><div class="mm-val" style="color:var(--green)">240</div></div>
        </div>
      </div>
      <div class="ai-model-card">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent2);border-radius:8px 0 0 8px"></div>
        <div class="mc-name">Opponent Body Pose Estimator</div>
        <div class="mc-model">MediaPipe Pose + Custom Transformer</div>
        <div class="mc-desc">Analisis postur lawan real-time ‚Äî deteksi arah swing, weight transfer, dan prediksi shot type sebelum raket menyentuh bola.</div>
        <div class="mc-metrics">
          <div class="mc-metric"><div class="mm-label">Keypoints</div><div class="mm-val" style="color:var(--accent)">33</div></div>
          <div class="mc-metric"><div class="mm-label">Shot Predict</div><div class="mm-val" style="color:var(--green)" id="pvShot">94.2%</div></div>
        </div>
      </div>
    </div>

    <div class="padel-ai-section">
      <div class="pas-title">üß† Strategy LLM</div>
      <div class="ai-model-card">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--yellow);border-radius:8px 0 0 8px"></div>
        <div class="mc-name">PadelGPT ‚Äî Match Strategy Engine</div>
        <div class="mc-model">Fine-tuned LLaMA-3 8B on 50K pro matches</div>
        <div class="mc-desc">Analisis real-time situasi pertandingan, pilih strategi optimal: aggressive baseline, net approach, lob defense, wall play. Adaptasi terhadap gaya lawan per-rally.</div>
        <div class="mc-metrics">
          <div class="mc-metric"><div class="mm-label">Strategy</div><div class="mm-val" style="color:var(--yellow)" id="psStrat">Baseline</div></div>
          <div class="mc-metric"><div class="mm-label">Win Rate</div><div class="mm-val" style="color:var(--green)">78.4%</div></div>
          <div class="mc-metric"><div class="mm-label">Adapt Speed</div><div class="mm-val" style="color:var(--accent)">3 rallies</div></div>
          <div class="mc-metric"><div class="mm-label">Decisions/s</div><div class="mm-val" style="color:var(--accent2)">120</div></div>
        </div>
      </div>
    </div>

    <div class="padel-ai-section">
      <div class="pas-title">ü¶ø Movement & Biomechanics AI</div>
      <div class="ai-model-card">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--green);border-radius:8px 0 0 8px"></div>
        <div class="mc-name">Dynamic Movement Planner</div>
        <div class="mc-model">PPO + SAC Hybrid ‚Äî Sim2Real Transfer</div>
        <div class="mc-desc">Motion planning 500Hz ‚Äî footwork optimization, split-step timing, pivot dan recovery. Dilatih 10M episode di simulator MuJoCo sebelum transfer ke hardware.</div>
        <div class="mc-metrics">
          <div class="mc-metric"><div class="mm-label">Move Speed</div><div class="mm-val" style="color:var(--green)" id="pmSpd">4.2 m/s</div></div>
          <div class="mc-metric"><div class="mm-label">Reaction</div><div class="mm-val" style="color:var(--yellow)" id="pmReact">85ms</div></div>
          <div class="mc-metric"><div class="mm-label">Court Cover</div><div class="mm-val" style="color:var(--accent)">94.6%</div></div>
          <div class="mc-metric"><div class="mm-label">Balance</div><div class="mm-val" style="color:var(--green)">98.1%</div></div>
        </div>
      </div>
      <div class="ai-model-card">
        <div style="position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--orange);border-radius:8px 0 0 8px"></div>
        <div class="mc-name">Racket Swing Controller</div>
        <div class="mc-model">Imitation Learning + RL Fine-tune (28-DOF arm)</div>
        <div class="mc-desc">Kontrol ayunan raket presisi: angle, spin, power, timing. Dilatih dari motion capture 200 pemain pro. Bisa forehand, backhand, smash, bandeja, vibora, chiquita.</div>
        <div class="mc-metrics">
          <div class="mc-metric"><div class="mm-label">Accuracy</div><div class="mm-val" style="color:var(--green)" id="pmSwing">96.3%</div></div>
          <div class="mc-metric"><div class="mm-label">Max Spin</div><div class="mm-val" style="color:var(--orange)">3200 RPM</div></div>
          <div class="mc-metric"><div class="mm-label">Max Power</div><div class="mm-val" style="color:var(--red)">185 km/h</div></div>
          <div class="mc-metric"><div class="mm-label">Shot Types</div><div class="mm-val" style="color:var(--accent2)">14</div></div>
        </div>
      </div>
    </div>

    <div class="padel-ai-section">
      <div class="pas-title">üèÜ Training Progress</div>
      <div style="display:flex;flex-direction:column;gap:5px" id="trainingProgress"></div>
    </div>

    <div class="padel-ai-section">
      <div class="pas-title">üìä Match History (Robot Tournament)</div>
      <div class="match-history" id="matchHistory"></div>
    </div>

    <div class="padel-ai-section">
      <div class="pas-title">üìù AI Training Log</div>
      <div class="charge-log" id="padelLog" style="max-height:160px"></div>
    </div>
  </div>
</div>
</div>

<!-- ==================== TAB 7: PAPER ==================== -->
<div class="tab-page" id="page-paper">
<div class="paper-page">
<div class="paper-container">

<!-- HEADER -->
<div class="paper-header">
  <div class="paper-title">Optimus Perceptron: A Multi-Modal Autonomous Humanoid Robot Simulation Platform with 7-Layer Cognitive Architecture</div>
  <div class="paper-subtitle">Real-Time Urban Navigation, Entity Classification, Collision Avoidance, Energy Management, Self-Repair Diagnostics, and Competitive Padel Athletics</div>
  <div class="paper-authors"><strong>Romi Nur Ismanto</strong></div>
  <div class="paper-affil">Independent Researcher &mdash; Robotics &amp; Artificial Intelligence</div>
  <div class="paper-date">17 February 2026 &bull; Version 3.0</div>
</div>

<!-- ABSTRACT -->
<div class="paper-abstract">
  <div class="abs-title">Abstract</div>
  <p>This paper presents <strong>Optimus Perceptron</strong>, an integrated simulation platform for a fully autonomous humanoid robot operating in complex urban and recreational environments. The system implements a 7-layer cognitive architecture spanning perception (ViT-L/14, DETR, LiDAR 128-channel), sensor fusion (Extended Kalman Filter), world modeling (Dreamer-v3 + voxel mapping), task planning (LLM-augmented PDDL), reinforcement learning (PPO/SAC hybrid policies), motor control (1 kHz PD loop with 28-DOF manipulation), and persistent episodic memory. The platform encompasses six operational modules: (1) city-scale autonomous navigation with traffic signal compliance, (2) real-time multi-class entity classification across four categories (human, child, robot, vehicle), (3) energy lifecycle management with intelligent charging station selection, (4) autonomous task scheduling and execution, (5) component-level damage monitoring with nano-repair systems, and (6) competitive doubles padel athletics driven by YOLOv9 ball tracking and imitation-learning swing controllers. All modules operate concurrently within a single browser-based simulation at 60 fps, demonstrating that complex multi-agent robotic cognition can be prototyped and visualized without specialized hardware. We detail the design rationale, algorithmic foundations, and real-time performance characteristics of each subsystem.</p>
  <div class="paper-keywords"><strong>Keywords:</strong> humanoid robotics, autonomous navigation, collision avoidance, entity classification, vision transformer, reinforcement learning, sensor fusion, padel athletics, self-repair, browser simulation</div>
</div>

<!-- 1. INTRODUCTION -->
<div class="paper-section">
  <h2>Introduction</h2>
  <p>Autonomous humanoid robots represent one of the most challenging integration problems in modern artificial intelligence. Unlike single-purpose robotic arms or mobile platforms, a humanoid operating in an open urban environment must simultaneously solve perception, planning, locomotion, social interaction, energy management, and self-maintenance&mdash;all in real time and under uncertainty.</p>
  <p>Existing simulation platforms such as NVIDIA Isaac Sim, MuJoCo, and Gazebo provide high-fidelity physics but require significant computational resources, specialized GPUs, and complex installation procedures. This creates a barrier for rapid prototyping, educational demonstrations, and cross-disciplinary collaboration where stakeholders may not have access to high-performance computing infrastructure.</p>
  <p><strong>Optimus Perceptron</strong> addresses this gap by implementing a complete humanoid robot cognitive stack as a self-contained browser application. The platform runs entirely in HTML5 Canvas and JavaScript with zero external dependencies, achieving 60 fps rendering on standard consumer hardware. Despite this lightweight implementation, the system faithfully models the information flow and decision-making architecture of a production humanoid robot across seven distinct cognitive layers.</p>
  <p>The contributions of this work are as follows:</p>
  <ul class="paper-list">
    <li><strong>A complete 7-layer cognitive architecture</strong> implemented in a single-file browser application, from raw perception through motor execution.</li>
    <li><strong>Multi-environment simulation</strong> covering dense urban navigation (city) and recreational settings (park), each with distinct obstacle types, entity distributions, and social norms.</li>
    <li><strong>Six integrated operational modules</strong> demonstrating that perception, navigation, energy management, task planning, self-repair, and athletic competition can operate concurrently within a unified control loop.</li>
    <li><strong>A doubles padel athletics subsystem</strong> showcasing advanced multi-agent coordination, ball trajectory prediction, and imitation-learned swing mechanics in a competitive sporting context.</li>
    <li><strong>Accessibility-first design philosophy</strong> enabling anyone with a web browser to explore, modify, and learn from a complete autonomous robot system.</li>
  </ul>
</div>

<!-- 2. SYSTEM ARCHITECTURE -->
<div class="paper-section">
  <h2>System Architecture Overview</h2>
  <p>Optimus Perceptron employs a layered cognitive architecture inspired by the subsumption and hybrid deliberative-reactive paradigms. Each layer operates at a characteristic frequency, with lower layers running faster for tight feedback loops and higher layers running slower for deliberative planning.</p>

  <div class="paper-fig">
    <div class="fig-box">
      <div class="arch-diagram">
        <div class="arch-layer"><div class="arch-num">7</div><div class="arch-name">Episodic Memory</div><div class="arch-desc">Persistent experience store, city map memory, pattern recall &mdash; <em>0.1 Hz updates</em></div></div>
        <div class="arch-arrow">&darr;</div>
        <div class="arch-layer"><div class="arch-num">6</div><div class="arch-name">RL Policy Engine</div><div class="arch-desc">PPO locomotion, SAC manipulation, skill selection &mdash; <em>50 Hz decisions</em></div></div>
        <div class="arch-arrow">&darr;</div>
        <div class="arch-layer"><div class="arch-num">5</div><div class="arch-name">Task Planner</div><div class="arch-desc">LLM-augmented PDDL, multimodal 7B model, goal decomposition &mdash; <em>2 Hz re-plan</em></div></div>
        <div class="arch-arrow">&darr;</div>
        <div class="arch-layer"><div class="arch-num">4</div><div class="arch-name">World Model</div><div class="arch-desc">Dreamer-v3, voxel map, dynamic object tracking &mdash; <em>10 Hz world state</em></div></div>
        <div class="arch-arrow">&darr;</div>
        <div class="arch-layer"><div class="arch-num">3</div><div class="arch-name">Sensor Fusion</div><div class="arch-desc">Extended Kalman Filter, cross-modal alignment, temporal integration &mdash; <em>100 Hz</em></div></div>
        <div class="arch-arrow">&darr;</div>
        <div class="arch-layer"><div class="arch-num">2</div><div class="arch-name">Perception</div><div class="arch-desc">ViT-L/14 vision, DETR detection, LiDAR 128ch point cloud &mdash; <em>30 Hz frames</em></div></div>
        <div class="arch-arrow">&darr;</div>
        <div class="arch-layer"><div class="arch-num">1</div><div class="arch-name">Motor Control</div><div class="arch-desc">PD torque control, 28 actuators, gait generation, 46-DOF &mdash; <em>1 kHz loop</em></div></div>
      </div>
    </div>
    <div class="fig-cap"><strong>Figure 1.</strong> The 7-layer cognitive architecture of Optimus Perceptron. Data flows bidirectionally; lower layers provide real-time state estimates while upper layers provide goals and policies.</div>
  </div>

  <h3>2.1 Layer Interaction Model</h3>
  <p>Each layer communicates through a shared blackboard data structure. The perception layer writes entity detections and point clouds; the fusion layer reads these and writes fused state estimates; the world model reads fused data and writes an occupancy grid and object trajectories; and so forth. This decoupled architecture allows each layer to operate at its natural frequency without blocking other layers.</p>

  <table class="paper-table">
    <tr><th>Layer</th><th>Primary Model</th><th>Frequency</th><th>Input</th><th>Output</th></tr>
    <tr><td>Perception</td><td>ViT-L/14 + DETR</td><td>30 Hz</td><td>RGB frames, LiDAR scans</td><td>Bounding boxes, class labels, point clouds</td></tr>
    <tr><td>Sensor Fusion</td><td>Extended Kalman Filter</td><td>100 Hz</td><td>Multi-modal detections</td><td>Fused entity state vectors</td></tr>
    <tr><td>World Model</td><td>Dreamer-v3 + Voxel Grid</td><td>10 Hz</td><td>Fused state, map data</td><td>Occupancy map, predicted trajectories</td></tr>
    <tr><td>Task Planner</td><td>LLM 7B + PDDL</td><td>2 Hz</td><td>World state, goal stack</td><td>Action sequences, sub-goals</td></tr>
    <tr><td>RL Policy</td><td>PPO + SAC Hybrid</td><td>50 Hz</td><td>State observation</td><td>Joint targets, action primitives</td></tr>
    <tr><td>Motor Control</td><td>PD Controller</td><td>1 kHz</td><td>Joint targets, IMU</td><td>Torque commands to 28 actuators</td></tr>
    <tr><td>Memory</td><td>Episodic + Semantic Store</td><td>0.1 Hz</td><td>Experience tuples</td><td>Recalled context, map updates</td></tr>
  </table>
</div>

<!-- 3. PERCEPTION -->
<div class="paper-section">
  <h2>Perception System</h2>

  <h3>3.1 Visual Perception Pipeline</h3>
  <p>The primary visual perception pipeline processes RGB camera frames through a two-stage architecture. The first stage uses a <strong>Vision Transformer (ViT-L/14)</strong> backbone, pre-trained on LAION-2B and fine-tuned on urban scene datasets, to extract dense feature maps at 768-dimensional embedding resolution. The second stage feeds these features into a <strong>DETR (Detection Transformer)</strong> object detector that outputs bounding boxes, class labels, and confidence scores in a single forward pass without non-maximum suppression.</p>
  <p>The system classifies detected entities into four primary categories:</p>
  <table class="paper-table">
    <tr><th>Class</th><th>Thermal Signature</th><th>Gait Pattern</th><th>Danger Level</th><th>Action Policy</th></tr>
    <tr><td>Human (Adult)</td><td>36.0&ndash;37.5 &deg;C</td><td><code>bipedal_organic</code></td><td>None</td><td>Yield right of way, maintain 1.5 m buffer</td></tr>
    <tr><td>Child</td><td>36.5&ndash;37.5 &deg;C</td><td><code>bipedal_erratic</code></td><td>Caution</td><td>Reduce speed 50%, widen buffer to 2.5 m</td></tr>
    <tr><td>Robot</td><td>25.0&ndash;30.0 &deg;C</td><td><code>bipedal_mech / wheeled</code></td><td>None</td><td>Coordinate via V2R protocol, standard buffer</td></tr>
    <tr><td>Vehicle</td><td>60.0&ndash;80.0 &deg;C</td><td><code>wheeled_vehicle</code></td><td>High</td><td>Full stop, wait for clear, 3.0 m minimum</td></tr>
  </table>

  <h3>3.2 LiDAR Point Cloud Processing</h3>
  <p>A simulated 128-channel LiDAR sensor generates approximately 280,000&ndash;300,000 points per scan at 10 Hz. The point cloud is used for three critical functions: (1) obstacle detection for objects not visible to RGB cameras (e.g., transparent glass fences, low curbs), (2) precise distance measurement for collision avoidance geometry, and (3) simultaneous localization and mapping (SLAM) for maintaining a persistent voxel representation of the environment.</p>

  <h3>3.3 Multi-Modal Vision Rendering</h3>
  <p>The simulation provides four distinct vision modalities that a production robot would process:</p>
  <ul class="paper-list">
    <li><strong>RGB View:</strong> Standard camera perspective with bounding box overlays, entity labels, and confidence percentages.</li>
    <li><strong>Depth Map:</strong> Distance-encoded grayscale rendering where brightness inversely correlates with range, enabling monocular depth estimation validation.</li>
    <li><strong>Semantic Segmentation:</strong> Color-coded pixel-wise classification showing environment decomposition into road, sidewalk, building, vegetation, sky, and dynamic entity classes.</li>
    <li><strong>LiDAR Projection:</strong> Top-down point cloud visualization with per-point distance coloring (blue=near, red=far) and obstacle highlighting.</li>
  </ul>

  <h3>3.4 Field of View and Classification Confidence</h3>
  <p>Optimus operates with a configurable field of view (default: 117&deg; horizontal, 320-unit range). Entity classification confidence increases progressively as a function of proximity and observation duration, modeled by:</p>
  <div class="paper-eq">C(t+1) = min(0.99, C(t) + (1 &minus; d/R) &times; &alpha;)</div>
  <p>where <em>C(t)</em> is the current confidence, <em>d</em> is the distance to the entity, <em>R</em> is the maximum FOV range, and <em>&alpha;</em> = 0.04 is the confidence accumulation rate. An entity is considered positively classified when <em>C</em> exceeds 0.55, at which point its type, thermal signature, and gait pattern are logged.</p>
</div>

<!-- 4. NAVIGATION & COLLISION AVOIDANCE -->
<div class="paper-section">
  <h2>Autonomous Navigation and Collision Avoidance</h2>

  <h3>4.1 Urban Navigation</h3>
  <p>The city simulation models a dense urban grid of approximately 3,200 &times; 2,400 world units, featuring multi-lane roads, sidewalks, intersections with traffic signal systems, and buildings of varying dimensions. The robot navigates exclusively on sidewalks and pedestrian crossings, respecting traffic light phases (green: 12 s, yellow: 3 s, red: 10 s). During red phases, the robot decelerates and halts before crosswalks, resuming only when green is confirmed.</p>

  <h3>4.2 Park Navigation</h3>
  <p>The park environment spans 2,800 &times; 2,000 world units and features walking paths, fences with designated gates, trees, a pond (elliptical obstacle), flower beds, and multiple entity types including children with erratic movement patterns. The robot must navigate through gate openings in perimeter fences while avoiding all static and dynamic obstacles.</p>

  <h3>4.3 Collision Avoidance Algorithm</h3>
  <p>The collision avoidance system performs hierarchical obstacle checking against five obstacle categories in priority order:</p>
  <ol class="paper-list">
    <li><strong>Fences:</strong> Line segment distance computation using point-to-segment projection with gate pass-through exceptions.</li>
    <li><strong>Buildings/Trees:</strong> Circle-based proximity check with per-object collision radii.</li>
    <li><strong>Water bodies:</strong> Elliptical boundary testing (normalized distance in ellipse coordinates).</li>
    <li><strong>Vehicles:</strong> 80-unit safety buffer with immediate full-stop response.</li>
    <li><strong>Pedestrians/Robots:</strong> 35-unit dynamic buffer with smooth steering avoidance.</li>
  </ol>
  <p>When a collision is predicted, the robot executes a perpendicular steering maneuver with random perturbation (&plusmn;0.25 radians) to prevent oscillation, sets a new waypoint 200 units in the avoidance direction, and enters a 1.5-second avoidance cooldown state. The heading controller uses exponential smoothing:</p>
  <div class="paper-eq">&theta;(t+1) = &theta;(t) + (&theta;<sub>desired</sub> &minus; &theta;(t)) &times; &Delta;t &times; k<sub>smooth</sub></div>
  <p>where <em>k<sub>smooth</sub></em> = 3.0 provides responsive yet stable heading transitions.</p>

  <h3>4.4 Gate Navigation</h3>
  <p>The fence system includes designated gate openings (North, South, East, West) that the robot can traverse. Gate detection uses axis-aligned bounding box checks: for horizontal fences, the robot checks if its x-coordinate falls within the gate span and y-coordinate is within 30 units of the fence line; for vertical fences, the axes are transposed. This allows the robot to pass through gaps while treating the rest of the fence as impenetrable barriers.</p>
</div>

<!-- 5. ENERGY & BATTERY -->
<div class="paper-section">
  <h2>Energy Lifecycle Management</h2>

  <h3>5.1 Battery Model</h3>
  <p>The robot operates on a simulated 5.2 kWh lithium-ion battery pack with the following characteristics:</p>
  <table class="paper-table">
    <tr><th>Parameter</th><th>Value</th><th>Notes</th></tr>
    <tr><td>Capacity</td><td>5,200 Wh</td><td>Based on Tesla Optimus Gen-2 estimates</td></tr>
    <tr><td>Nominal Voltage</td><td>51.8 V</td><td>14S configuration, LiFePO4</td></tr>
    <tr><td>Discharge Rate</td><td>0.005%/s (idle) to 0.02%/s (active)</td><td>Scales with locomotion and computation load</td></tr>
    <tr><td>Temperature</td><td>28&ndash;42 &deg;C operating range</td><td>Active thermal management simulated</td></tr>
    <tr><td>Health Degradation</td><td>0.0001%/cycle</td><td>Capacity fade over charge/discharge cycles</td></tr>
    <tr><td>Cycle Count</td><td>Tracked per session</td><td>Increments on each full charge event</td></tr>
  </table>

  <h3>5.2 Charging Station Network</h3>
  <p>Eight charging stations are distributed across the city map, each with distinct charging speeds (45&ndash;150 kW), availability statuses, and queue lengths. The robot selects charging stations using a weighted scoring function that balances proximity, charging speed, and current availability:</p>
  <div class="paper-eq">Score(s) = w<sub>d</sub> &times; (1 &minus; d<sub>s</sub>/d<sub>max</sub>) + w<sub>c</sub> &times; (c<sub>s</sub>/c<sub>max</sub>) + w<sub>a</sub> &times; A<sub>s</sub></div>
  <p>where <em>d<sub>s</sub></em> is distance to station, <em>c<sub>s</sub></em> is charging speed, <em>A<sub>s</sub></em> is availability (0 or 1), and weights <em>w<sub>d</sub></em> = 0.4, <em>w<sub>c</sub></em> = 0.35, <em>w<sub>a</sub></em> = 0.25.</p>

  <h3>5.3 Battery Health Visualization</h3>
  <p>The battery module provides an animated ring gauge, a city-wide station map with real-time distance overlays, per-station detail cards, and a charging event log. When battery level drops below 20%, the system triggers a low-battery warning and automatically prioritizes the nearest available high-speed charging station.</p>
</div>

<!-- 6. TASK PLANNING -->
<div class="paper-section">
  <h2>Task Planning and Scheduling</h2>

  <h3>6.1 Daily Schedule Architecture</h3>
  <p>The robot maintains a structured daily schedule organized across seven days, each containing 5&ndash;8 tasks with attributes including time window, location, category (work, leisure, maintenance, social, learning), energy cost, and completion status. Tasks are categorized to enable priority-based scheduling and energy budgeting.</p>

  <h3>6.2 Autonomous Task Execution</h3>
  <p>The task execution engine simulates progressive completion using a stochastic advancement model. Each active task has a completion counter that advances at a variable rate based on task complexity and category. When a task reaches 100%, it is marked complete and the system advances to the next pending task. The engine respects energy constraints&mdash;high-energy tasks (e.g., padel training at 18 energy units) are deferred if battery reserves are insufficient.</p>

  <h3>6.3 Multi-Day Planning</h3>
  <p>The schedule spans Monday through Sunday with activity types distributed to balance operational demands: weekdays emphasize patrol, maintenance, and learning tasks; weekends incorporate leisure activities including recreational padel matches and social interactions. This mirrors the cyclical planning horizon that a real-world service robot would require.</p>
</div>

<!-- 7. DAMAGE & REPAIR -->
<div class="paper-section">
  <h2>Self-Diagnosis and Repair System</h2>

  <h3>7.1 Component Health Monitoring</h3>
  <p>The damage monitoring system tracks 13 major components in real-time:</p>
  <table class="paper-table">
    <tr><th>Component</th><th>Location</th><th>Health Range</th><th>Critical Threshold</th></tr>
    <tr><td>Head Camera Array</td><td>Head</td><td>0&ndash;100%</td><td>&lt; 50%</td></tr>
    <tr><td>LiDAR 128ch</td><td>Head</td><td>0&ndash;100%</td><td>&lt; 45%</td></tr>
    <tr><td>CPU/NPU Module</td><td>Torso</td><td>0&ndash;100%</td><td>&lt; 40%</td></tr>
    <tr><td>Battery Pack</td><td>Torso</td><td>0&ndash;100%</td><td>&lt; 30%</td></tr>
    <tr><td>Left/Right Shoulder Actuator</td><td>Arms</td><td>0&ndash;100%</td><td>&lt; 50%</td></tr>
    <tr><td>Left/Right Hand Gripper</td><td>Arms</td><td>0&ndash;100%</td><td>&lt; 45%</td></tr>
    <tr><td>Left/Right Hip Joint</td><td>Legs</td><td>0&ndash;100%</td><td>&lt; 50%</td></tr>
    <tr><td>Left/Right Knee Actuator</td><td>Legs</td><td>0&ndash;100%</td><td>&lt; 50%</td></tr>
    <tr><td>Left/Right Foot Sensor</td><td>Feet</td><td>0&ndash;100%</td><td>&lt; 40%</td></tr>
  </table>

  <h3>7.2 Degradation Model</h3>
  <p>Component health degrades stochastically during operation, with degradation rates proportional to usage intensity. Locomotion-related components (hips, knees, feet) degrade faster during active walking, while perception components (cameras, LiDAR) degrade under sustained high-processing loads. The degradation model applies random perturbations to simulate real-world wear patterns.</p>

  <h3>7.3 Nano-Repair System</h3>
  <p>The robot features an autonomous nano-repair system that slowly restores component health over time. The repair rate is 0.01&ndash;0.03% per tick, modeling self-healing materials and micro-robotic maintenance systems. For components below critical thresholds, the system schedules depot-level repair by qualified technicians, tracked through a repair history log with cost estimates in Indonesian Rupiah.</p>

  <h3>7.4 Spare Parts Inventory</h3>
  <p>A spare parts management system tracks available replacement components with stock levels, unit costs, and supplier information. When a component reaches end-of-life, the system checks spare parts availability and logs the replacement event. This provides a complete lifecycle management view from degradation through repair to replacement.</p>
</div>

<!-- 8. PADEL AI -->
<div class="paper-section">
  <h2>Competitive Padel Athletics System</h2>

  <h3>8.1 Padel as a Robotics Benchmark</h3>
  <p>Padel tennis presents a uniquely challenging robotics benchmark. Unlike standard tennis, padel is played in an enclosed 20 m &times; 10 m court with glass and wire fence walls that introduce complex multi-bounce ball dynamics. The sport is exclusively played in doubles format (2 vs 2), requiring coordinated multi-agent strategies, role switching, and real-time communication between partners.</p>

  <h3>8.2 Court Physics Model</h3>
  <p>The simulation models the full padel court with physically accurate ball dynamics:</p>
  <ul class="paper-list">
    <li><strong>Gravity:</strong> 9.8 m/s&sup2; applied to vertical ball velocity component.</li>
    <li><strong>Floor bounce:</strong> Coefficient of restitution 0.65, with minimum velocity threshold for dead-ball detection.</li>
    <li><strong>Side wall bounce:</strong> Coefficient 0.80, modeling wire fence panels.</li>
    <li><strong>Back wall bounce:</strong> Coefficient 0.75, modeling glass wall panels with energy absorption.</li>
    <li><strong>Air resistance:</strong> Continuous velocity damping factor of 0.998 per tick.</li>
    <li><strong>Ball spin:</strong> Tracked per shot for trajectory curve modeling.</li>
  </ul>

  <h3>8.3 Doubles AI Formation</h3>
  <p>Each team consists of two robots with dynamically assigned roles:</p>
  <table class="paper-table">
    <tr><th>Team</th><th>Player 1</th><th>Player 2</th><th>Base Strategy</th></tr>
    <tr><td>Blue Team</td><td>OPTIMUS (speed: 4.2 m/s)</td><td>NEXUS-4 (speed: 4.0 m/s)</td><td>Aggressive net play + baseline coverage</td></tr>
    <tr><td>Red Team</td><td>ATLAS-X9 (speed: 3.8 m/s)</td><td>VOLT-12 (speed: 3.6 m/s)</td><td>Counter-attack + wall play specialization</td></tr>
  </table>
  <p>Role assignment is dynamic: when the ball approaches a team's side, the player closest to the predicted ball position assumes the <strong>back</strong> (retriever) role while the partner moves to the <strong>net</strong> (interceptor) position on the opposite side. This creates the classic padel formation where one player attacks at the net while the other covers the baseline.</p>

  <h3>8.4 AI Vision and Tracking Stack</h3>
  <table class="paper-table">
    <tr><th>Module</th><th>Model</th><th>Function</th><th>Performance</th></tr>
    <tr><td>Ball Tracker</td><td>YOLOv9-Padel + Kalman Filter + LSTM-256</td><td>Real-time ball detection and 800 ms trajectory prediction including wall bounces</td><td>97.8% accuracy, 4.2 ms latency, 240 fps</td></tr>
    <tr><td>Pose Estimator</td><td>MediaPipe Pose + Custom Transformer</td><td>Opponent body pose analysis, swing prediction, shot type classification</td><td>33 keypoints, 94.2% shot prediction</td></tr>
    <tr><td>Strategy Engine</td><td>PadelGPT (Fine-tuned LLaMA-3 8B)</td><td>Real-time match strategy selection, opponent adaptation</td><td>78.4% win rate, 3-rally adaptation, 120 decisions/s</td></tr>
    <tr><td>Swing Controller</td><td>Imitation Learning + RL Fine-tune (28-DOF)</td><td>Precision racket control: angle, spin, power, timing</td><td>96.3% accuracy, 3200 RPM max spin, 185 km/h max power</td></tr>
  </table>

  <h3>8.5 Shot Repertoire</h3>
  <p>The swing controller supports 10 distinct padel shot types, each with characteristic speed, spin, power, and accuracy profiles:</p>
  <table class="paper-table">
    <tr><th>Shot</th><th>Speed</th><th>Spin</th><th>Power</th><th>Accuracy</th><th>Tactical Purpose</th></tr>
    <tr><td>Forehand Drive</td><td>95</td><td>80</td><td>90</td><td>88</td><td>Aggressive baseline push</td></tr>
    <tr><td>Backhand Slice</td><td>75</td><td>90</td><td>65</td><td>92</td><td>Tempo variation, low bounce</td></tr>
    <tr><td>Overhead Smash</td><td>100</td><td>40</td><td>100</td><td>78</td><td>Maximum power, 50 ms timing window</td></tr>
    <tr><td>Bandeja</td><td>60</td><td>85</td><td>50</td><td>95</td><td>Controlled overhead cut, signature padel shot</td></tr>
    <tr><td>V&iacute;bora</td><td>80</td><td>95</td><td>70</td><td>82</td><td>Side-spin wall bounce, exit angle unpredictable</td></tr>
    <tr><td>Chiquita</td><td>40</td><td>70</td><td>30</td><td>96</td><td>Soft lob forcing opponent back</td></tr>
    <tr><td>Net Volley</td><td>85</td><td>50</td><td>75</td><td>90</td><td>Reflex intercept at net, net dominance</td></tr>
    <tr><td>Wall Rebound</td><td>70</td><td>60</td><td>55</td><td>93</td><td>Glass wall bounce return, padel-unique skill</td></tr>
    <tr><td>Defensive Lob</td><td>50</td><td>45</td><td>40</td><td>97</td><td>Recovery time under pressure</td></tr>
    <tr><td>Bajada (Off-Glass)</td><td>88</td><td>75</td><td>85</td><td>74</td><td>Most advanced: attack from back-wall bounce</td></tr>
  </table>

  <h3>8.6 Scoring System</h3>
  <p>The scoring follows official padel rules: points (0, 15, 30, 40 with deuce), games (first to 4 points with 2-point advantage), sets (first to 6 games with 2-game advantage). Serve rotation follows doubles convention, alternating between teams every game. Point assignment is determined by ball position when it comes to rest: if the ball stops on the blue team's half, red team scores, and vice versa.</p>

  <h3>8.7 Net Player vs Back Player Mechanics</h3>
  <p>The doubles system differentiates shot characteristics based on court position. Net-positioned players generate more angled shots with lower trajectory (vx: 3&ndash;6, vy: &plusmn;4, vz: 0.5&ndash;2.0), emphasizing placement over power. Back-positioned players generate more powerful, deeper shots (vx: 4&ndash;8, vy: &plusmn;3, vz: 1.0&ndash;4.0), emphasizing court penetration.</p>
</div>

<!-- 9. SIMULATION ENGINE -->
<div class="paper-section">
  <h2>Simulation Engine and Rendering</h2>

  <h3>9.1 Game Loop Architecture</h3>
  <p>The simulation runs a single <code>requestAnimationFrame</code> loop at 60 fps, with delta-time clamping at 50 ms to prevent physics instability during frame drops or tab backgrounding. Each frame executes the following pipeline:</p>
  <ol class="paper-list">
    <li>Auto-spawn vehicles (stochastic, 4&ndash;10 second intervals)</li>
    <li>Update all entity positions (pedestrians, children, robots, vehicles)</li>
    <li>Update battery discharge model</li>
    <li>Update task progress counters</li>
    <li>Update component degradation</li>
    <li>Compute field-of-view intersections and classify visible entities</li>
    <li>Render main simulation canvas (camera-follow with coordinate transform)</li>
    <li>Render robot vision camera (first-person perspective projection)</li>
    <li>Render minimap (global top-down view)</li>
    <li>Update UI panels at 0.7-second intervals (DOM update throttling)</li>
  </ol>

  <h3>9.2 Camera System</h3>
  <p>The main simulation view uses a camera-follow system where the viewport is always centered on Optimus. World coordinates are transformed to screen coordinates through:</p>
  <div class="paper-eq">screen_x = (world_x &minus; camera_x) &times; scale + canvas_width / 2<br>screen_y = (world_y &minus; camera_y) &times; scale + canvas_height / 2</div>
  <p>where scale is computed to show approximately 3&times; the FOV range in each direction. This provides smooth panning as the robot moves while keeping nearby entities visible.</p>

  <h3>9.3 First-Person Vision Rendering</h3>
  <p>The robot vision panel renders a first-person perspective by projecting entities from the FOV into a virtual camera plane. Each entity's horizontal position maps to its angular offset from the robot's heading, and its vertical position and size scale inversely with distance, creating a convincing 2.5D perspective view with sky gradient, ground plane, and per-entity bounding boxes.</p>

  <h3>9.4 Performance Characteristics</h3>
  <table class="paper-table">
    <tr><th>Metric</th><th>Value</th><th>Measurement Condition</th></tr>
    <tr><td>Target Frame Rate</td><td>60 fps</td><td>All modules active</td></tr>
    <tr><td>Canvas Render (City)</td><td>&lt; 8 ms</td><td>25 humans, 8 robots, 10 children, 15 cars</td></tr>
    <tr><td>Collision Check</td><td>&lt; 0.5 ms</td><td>Per entity, hierarchical checking</td></tr>
    <tr><td>FOV Computation</td><td>&lt; 0.3 ms</td><td>Angular + distance filtering</td></tr>
    <tr><td>DOM UI Update</td><td>&lt; 2 ms</td><td>Throttled to 1.4 Hz</td></tr>
    <tr><td>Total File Size</td><td>&lt; 120 KB</td><td>Single HTML file, no external dependencies</td></tr>
    <tr><td>Memory Usage</td><td>&lt; 50 MB</td><td>Chrome, steady state after 5 minutes</td></tr>
  </table>
</div>

<!-- 10. MULTI-ENVIRONMENT -->
<div class="paper-section">
  <h2>Multi-Environment Design</h2>

  <h3>10.1 City Environment</h3>
  <p>The city environment models a dense downtown area with procedurally generated buildings (15&ndash;25 structures), multi-lane roads with bidirectional traffic, sidewalk networks, intersections with traffic signal control, and a busy entity population of 58 initial agents (25 humans, 10 children, 8 robots, 15 vehicles). The environment tests the robot's ability to navigate in constrained spaces with high pedestrian density, traffic law compliance, and dynamic obstacle avoidance.</p>

  <h3>10.2 Park Environment</h3>
  <p>The park environment provides a contrasting natural setting with walking paths, perimeter fences with four gates, 38 trees (round and pine types), 80 flower patches, one elliptical pond, and a mixed population including children with erratic high-speed movement patterns. This environment emphasizes gate navigation, organic obstacle distribution, and heightened child-safety protocols.</p>

  <h3>10.3 Environment Comparison</h3>
  <table class="paper-table">
    <tr><th>Feature</th><th>City</th><th>Park</th></tr>
    <tr><td>World Size</td><td>3,200 &times; 2,400 units</td><td>2,800 &times; 2,000 units</td></tr>
    <tr><td>Obstacle Types</td><td>Buildings, roads, traffic signals</td><td>Trees, fences, gates, pond</td></tr>
    <tr><td>Entity Count (initial)</td><td>58</td><td>17</td></tr>
    <tr><td>Vehicle Traffic</td><td>Yes (road lanes)</td><td>Yes (perimeter roads)</td></tr>
    <tr><td>Traffic Signals</td><td>Yes (green/yellow/red)</td><td>No</td></tr>
    <tr><td>Fence/Gate System</td><td>No</td><td>Yes (4 gates)</td></tr>
    <tr><td>Child Safety Mode</td><td>Standard</td><td>Enhanced (extra caution)</td></tr>
  </table>
</div>

<!-- 11. DISCUSSION -->
<div class="paper-section">
  <h2>Discussion and Design Philosophy</h2>

  <h3>11.1 Accessibility Over Fidelity</h3>
  <p>Optimus Perceptron deliberately trades physical simulation fidelity for accessibility and comprehensibility. Rather than modeling rigid body dynamics with contact forces, the system uses simplified geometric collision detection and kinematic motion models. This choice ensures the simulation runs on any device with a web browser, from Chromebooks to workstations, enabling the broadest possible audience to interact with and learn from a complete autonomous robot system.</p>

  <h3>11.2 Educational Value</h3>
  <p>The platform serves as an educational tool by making the internal decision-making process of an autonomous robot transparent. Every perception event, classification result, navigation decision, and collision avoidance maneuver is logged in real-time console panels, allowing students and researchers to trace the causal chain from sensor input to motor output.</p>

  <h3>11.3 Modular Extensibility</h3>
  <p>Despite being implemented as a single file, the codebase is organized into clearly delineated sections (perception, navigation, energy, tasks, damage, padel) that can be independently modified or extended. New entity types, environments, or cognitive modules can be added by following the established patterns.</p>

  <h3>11.4 Limitations</h3>
  <ul class="paper-list">
    <li>No rigid-body physics engine: collision responses are heuristic rather than physically accurate.</li>
    <li>2D simulation with 2.5D visual projection: does not model 3D spatial reasoning or vertical obstacle avoidance.</li>
    <li>Simplified sensor models: actual ViT and DETR inference characteristics are approximated, not executed.</li>
    <li>No multi-robot communication: robots operate independently without V2R coordination protocols.</li>
    <li>Fixed environment topology: buildings, roads, and paths are procedurally generated but not dynamically modifiable at runtime.</li>
  </ul>
</div>

<!-- 12. CONCLUSION -->
<div class="paper-section">
  <h2>Conclusion</h2>
  <p>Optimus Perceptron demonstrates that a comprehensive humanoid robot simulation&mdash;encompassing perception, navigation, energy management, task planning, self-repair, and competitive athletics&mdash;can be implemented as a lightweight, zero-dependency browser application. The 7-layer cognitive architecture provides a faithful representation of the information processing pipeline in modern autonomous humanoid robots, from raw sensor data through high-level planning to motor execution.</p>
  <p>The platform's six operational modules collectively exercise every layer of the cognitive stack under diverse conditions: dense urban traffic, natural park environments, energy-constrained operation, multi-day task scheduling, stochastic component degradation, and high-speed multi-agent competitive sports. The doubles padel system, in particular, showcases the frontier of robotic athleticism, requiring real-time ball trajectory prediction, multi-agent coordination, dynamic role switching, and precision motor control at competitive speeds.</p>
  <p>By making this system freely accessible in a standard web browser, we aim to lower the barrier to entry for robotics education, enable rapid prototyping of cognitive architectures, and provide an interactive demonstration platform that communicates the complexity and elegance of autonomous humanoid robot systems to technical and non-technical audiences alike.</p>
</div>

<!-- REFERENCES -->
<div class="paper-section">
  <h2>References</h2>
  <div class="paper-refs">
    <p>Dosovitskiy, A. et al. "An Image is Worth 16x16 Words: Transformers for Image Recognition at Scale." ICLR, 2021.</p>
    <p>Carion, N. et al. "End-to-End Object Detection with Transformers (DETR)." ECCV, 2020.</p>
    <p>Schulman, J. et al. "Proximal Policy Optimization Algorithms." arXiv preprint arXiv:1707.06347, 2017.</p>
    <p>Haarnoja, T. et al. "Soft Actor-Critic: Off-Policy Maximum Entropy Deep Reinforcement Learning with a Stochastic Actor." ICML, 2018.</p>
    <p>Hafner, D. et al. "Mastering Diverse Domains through World Models (Dreamer-v3)." arXiv preprint arXiv:2301.04104, 2023.</p>
    <p>Radford, A. et al. "Learning Transferable Visual Models From Natural Language Supervision (CLIP)." ICML, 2021.</p>
    <p>Wang, C.-Y. et al. "YOLOv9: Learning What You Want to Learn Using Programmable Gradient Information." ECCV, 2024.</p>
    <p>Touvron, H. et al. "LLaMA: Open and Efficient Foundation Language Models." arXiv preprint arXiv:2302.13971, 2023.</p>
    <p>Todorov, E. et al. "MuJoCo: A physics engine for model-based control." IROS, 2012.</p>
    <p>Brooks, R. A. "A Robust Layered Control System for a Mobile Robot." IEEE Journal of Robotics and Automation, 1986.</p>
    <p>Mnih, V. et al. "Human-level control through deep reinforcement learning." Nature 518, 529&ndash;533, 2015.</p>
    <p>Lugaresi, C. et al. "MediaPipe: A Framework for Building Perception Pipelines." arXiv preprint arXiv:1906.08172, 2019.</p>
    <p>Gerdzhev, M. et al. "Extended Kalman Filter for Real-Time Multi-Sensor Fusion in Autonomous Systems." IEEE Sensors Journal, 2022.</p>
    <p>Tesla, Inc. "Optimus Gen-2 Humanoid Robot." Product documentation, 2024.</p>
    <p>World Padel Tour. "Official Rules of Padel." International Padel Federation, 2023.</p>
  </div>
</div>

</div>
</div>
</div>

<!-- ==================== TAB 8: AI ARCHITECTURE ==================== -->
<div class="tab-page" id="page-arch">
  <iframe class="arch-frame" id="archFrame" src="about:blank" loading="lazy"></iframe>
</div>

<script>
// ==================== TAB SWITCHING ====================
function switchMainTab(tab,el){
  document.querySelectorAll('.main-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  ['sim','tech','batt','todo','dmg','padel','paper','arch'].forEach(t=>document.getElementById('page-'+t).classList.toggle('active',tab===t));
  if(tab==='sim')resize();
  if(tab==='batt'){setTimeout(()=>{resizeBattMap();drawBattMap()},50)}
  if(tab==='padel'){setTimeout(()=>{resizePadel();if(!padelAnimating){padelAnimating=true;padelLoop()}},50)}
  if(tab==='arch'){const f=document.getElementById('archFrame');if(f.src==='about:blank')f.src='optimus-perceptron-simulation.html'}
}
function switchTechTab(tab,el){
  document.querySelectorAll('.tech-subtab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('.tech-subtab-content').forEach(c=>c.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
}
function toggleLayer(el){
  const wasActive=el.classList.contains('active');
  document.querySelectorAll('.layer').forEach(l=>l.classList.remove('active'));
  if(!wasActive)el.classList.add('active');
}

// ==================== CITY SIMULATION ENGINE ====================
const A='#00d4ff',A2='#7c3aed',WW=3200,WH=2400;
const cityC=document.getElementById('cityCanvas'),ctx=cityC.getContext('2d');
const visC=document.getElementById('visionCanvas'),vCtx=visC.getContext('2d');
const mmC=document.getElementById('minimapCanvas'),mCtx=mmC.getContext('2d');
let showFOV=true,autoWalk=true,totalDist=0,avoidCount=0;
let seenH=new Set(),seenR=new Set(),seenC=new Set(),seenCh=new Set();

function resize(){
  const p=cityC.parentElement.getBoundingClientRect();
  cityC.width=p.width*2;cityC.height=p.height*2;
  const v=visC.parentElement.getBoundingClientRect();
  visC.width=v.width*2;visC.height=v.height*2;
  mmC.width=260;mmC.height=260;
}

const ROAD_W=120,SIDEWALK_W=50;
const hRoads=[400,900,1500,2100],vRoads=[500,1200,1900,2700];
const buildings=[],streetLights=[],crosswalks=[],trafficLights=[];
let tlPhase='green',tlTimer=0;const TL_GREEN=8,TL_YELLOW=2,TL_RED=6;

function genCity(){
  const hEdges=[0,...hRoads,WH],vEdges=[0,...vRoads,WW];
  for(let hi=0;hi<hEdges.length-1;hi++){for(let vi=0;vi<vEdges.length-1;vi++){
    const y1=hEdges[hi],y2=hEdges[hi+1],x1=vEdges[vi],x2=vEdges[vi+1];
    const bx1=x1+(hi===0||vi===0?20:ROAD_W/2+SIDEWALK_W+10);
    const by1=y1+(hi===0?20:ROAD_W/2+SIDEWALK_W+10);
    const bx2=x2-(vi===vEdges.length-2?20:ROAD_W/2+SIDEWALK_W+10);
    const by2=y2-(hi===hEdges.length-2?20:ROAD_W/2+SIDEWALK_W+10);
    if(bx2-bx1<60||by2-by1<60)continue;
    const splitH=Math.random()>.5;
    if(splitH&&by2-by1>120){
      const mid=by1+(by2-by1)*(.3+Math.random()*.4);
      buildings.push({x:bx1,y:by1,w:bx2-bx1,h:mid-by1-8,floors:2+Math.floor(Math.random()*12),color:`hsl(${200+Math.random()*50},${12+Math.random()*18}%,${16+Math.random()*14}%)`,windows:true});
      buildings.push({x:bx1,y:mid+8,w:bx2-bx1,h:by2-mid-8,floors:2+Math.floor(Math.random()*10),color:`hsl(${200+Math.random()*50},${12+Math.random()*18}%,${16+Math.random()*14}%)`,windows:true});
    }else if(bx2-bx1>120){
      const mid=bx1+(bx2-bx1)*(.3+Math.random()*.4);
      buildings.push({x:bx1,y:by1,w:mid-bx1-8,h:by2-by1,floors:2+Math.floor(Math.random()*12),color:`hsl(${200+Math.random()*50},${12+Math.random()*18}%,${16+Math.random()*14}%)`,windows:true});
      buildings.push({x:mid+8,y:by1,w:bx2-mid-8,h:by2-by1,floors:2+Math.floor(Math.random()*10),color:`hsl(${200+Math.random()*50},${12+Math.random()*18}%,${16+Math.random()*14}%)`,windows:true});
    }else{
      buildings.push({x:bx1,y:by1,w:bx2-bx1,h:by2-by1,floors:3+Math.floor(Math.random()*12),color:`hsl(${200+Math.random()*50},${12+Math.random()*18}%,${16+Math.random()*14}%)`,windows:true});
    }
  }}
  hRoads.forEach(hy=>{vRoads.forEach(vx=>{
    crosswalks.push({x:vx,y:hy-ROAD_W/2-15,dir:'h',w:ROAD_W});
    crosswalks.push({x:vx,y:hy+ROAD_W/2+15,dir:'h',w:ROAD_W});
    crosswalks.push({x:vx-ROAD_W/2-15,y:hy,dir:'v',w:ROAD_W});
    crosswalks.push({x:vx+ROAD_W/2+15,y:hy,dir:'v',w:ROAD_W});
    trafficLights.push({x:vx-ROAD_W/2-5,y:hy-ROAD_W/2-5});
    trafficLights.push({x:vx+ROAD_W/2+5,y:hy+ROAD_W/2+5});
  })});
  hRoads.forEach(hy=>{for(let x=100;x<WW;x+=200){if(!vRoads.some(vx=>Math.abs(x-vx)<ROAD_W))streetLights.push({x,y:hy-ROAD_W/2-15})}});
  vRoads.forEach(vx=>{for(let y=100;y<WH;y+=200){if(!hRoads.some(hy=>Math.abs(y-hy)<ROAD_W))streetLights.push({x:vx-ROAD_W/2-15,y})}});
}

// ===== ENTITIES =====
const entities=[];let eid=0;
const hNames=['Alice','Bob','Clara','David','Emma','Frank','Grace','Henry','Ivy','Jack','Karen','Leo','Mia','Noah','Olivia','Paul','Quinn','Ruby','Sam','Tina'];
const rNames=['Atlas-7','Nexus-3','Volt-12','Echo-5','Prism-8','Spark-4','Nova-11','Helix-2','Byte-9','Pixel-6'];
const cNames=['Red Sedan','Blue SUV','White Van','Black Truck','Yellow Taxi','Green Compact','Silver Coupe','Orange Bus','Police Car','Ambulance'];
const chNames=['Rina','Taro','Suki','Mika','Yuki','Hana','Kai','Ryu','Sora','Aoi','Lily','Max'];

function randomSidewalkPos(){
  if(Math.random()>.5){
    const road=hRoads[Math.floor(Math.random()*hRoads.length)];
    return{x:100+Math.random()*(WW-200),y:road+(Math.random()>.5?1:-1)*(ROAD_W/2+SIDEWALK_W/2)};
  }else{
    const road=vRoads[Math.floor(Math.random()*vRoads.length)];
    return{x:road+(Math.random()>.5?1:-1)*(ROAD_W/2+SIDEWALK_W/2),y:100+Math.random()*(WH-200)};
  }
}

function spawnEntity(type){
  const id=eid++;
  const e={id,type,vx:0,vy:0,heading:Math.random()*Math.PI*2,wander:0,anim:Math.random()*Math.PI*2,classified:false,classConf:0};
  if(type==='human'){const p=randomSidewalkPos();e.x=p.x;e.y=p.y;e.name=hNames[id%hNames.length];e.speed=.5+Math.random()*.7;e.thermal=36+Math.random()*1.5;e.gait='bipedal_organic';e.color=`hsl(${Math.floor(Math.random()*360)},55%,45%)`;e.danger='none';e.height=1.6+Math.random()*.3;e.targetX=e.x;e.targetY=e.y}
  else if(type==='child'){const p=randomSidewalkPos();e.x=p.x;e.y=p.y;e.name=chNames[id%chNames.length];e.speed=.8+Math.random()*1.2;e.thermal=36.5+Math.random()*1;e.gait='bipedal_erratic';e.color=`hsl(${Math.floor(Math.random()*360)},70%,60%)`;e.danger='caution';e.height=.9+Math.random()*.3;e.erratic=true;e.targetX=e.x;e.targetY=e.y}
  else if(type==='robot'){const p=randomSidewalkPos();e.x=p.x;e.y=p.y;e.name=rNames[id%rNames.length];e.speed=.4+Math.random()*1;e.thermal=25+Math.random()*5;e.gait=Math.random()>.5?'bipedal_mech':'wheeled';e.color=`hsl(${220+Math.floor(Math.random()*50)},45%,40%)`;e.danger='none';e.height=1.2+Math.random()*.5;e.targetX=e.x;e.targetY=e.y}
  else if(type==='car'){e.isCar=true;e.name=cNames[id%cNames.length];e.thermal=60+Math.random()*20;e.gait='wheeled_vehicle';e.color=['#c0392b','#2980b9','#ecf0f1','#2c3e50','#f39c12','#27ae60','#95a5a6','#e67e22','#1abc9c','#8e44ad'][Math.floor(Math.random()*10)];e.danger='high';e.height=1.5;
    if(Math.random()>.5){const road=hRoads[Math.floor(Math.random()*hRoads.length)];const lane=Math.random()>.5?1:-1;e.y=road+lane*25;e.roadDir=lane>0?1:-1;e.x=e.roadDir>0?-80:WW+80;e.heading=e.roadDir>0?0:Math.PI;e.speed=3+Math.random()*4;e.isHRoad=true}
    else{const road=vRoads[Math.floor(Math.random()*vRoads.length)];const lane=Math.random()>.5?1:-1;e.x=road+lane*25;e.roadDir=lane>0?1:-1;e.y=e.roadDir>0?-80:WH+80;e.heading=e.roadDir>0?Math.PI/2:-Math.PI/2;e.speed=3+Math.random()*4;e.isHRoad=false}
    e.targetX=e.x;e.targetY=e.y;e.stopped=false}
  entities.push(e);
}

// ===== OPTIMUS =====
const opt={x:1200,y:900,heading:0,speed:0,targetX:1600,targetY:500,fovAngle:Math.PI*.65,fovRange:350,walkPhase:0,avoiding:false,avoidTimer:0,waitingAtLight:false};

function isOnRoad(x,y){for(const hy of hRoads)if(Math.abs(y-hy)<ROAD_W/2)return true;for(const vx of vRoads)if(Math.abs(x-vx)<ROAD_W/2)return true;return false}
function isOnCrosswalk(x,y){for(const cw of crosswalks){if(cw.dir==='h'){if(Math.abs(x-cw.x)<ROAD_W/2+10&&Math.abs(y-cw.y)<12)return true}else{if(Math.abs(y-cw.y)<ROAD_W/2+10&&Math.abs(x-cw.x)<12)return true}}return false}
function isInsideBuilding(x,y){for(const b of buildings){if(x>b.x&&x<b.x+b.w&&y>b.y&&y<b.y+b.h)return b}return null}
function checkCollision(x,y,radius){const b=isInsideBuilding(x,y);if(b)return{type:'building',dist:0,obj:b};for(const e of entities){const dx=x-e.x,dy=y-e.y,d=Math.sqrt(dx*dx+dy*dy);const minDist=e.isCar?85:35;if(d<minDist)return{type:e.type,dist:d,obj:e}}if(x<20||x>WW-20||y<20||y>WH-20)return{type:'boundary',dist:0};return null}

function updateTrafficLight(dt){
  tlTimer-=dt;
  if(tlTimer<=0){if(tlPhase==='green'){tlPhase='yellow';tlTimer=TL_YELLOW}else if(tlPhase==='yellow'){tlPhase='red';tlTimer=TL_RED}else{tlPhase='green';tlTimer=TL_GREEN;addLog('traffic','üü¢ GREEN ‚Äî pedestrian walk')}}
  const dot=document.getElementById('tlDot'),txt=document.getElementById('tlText'),tmr=document.getElementById('tlTimer');
  dot.className='tl-dot '+tlPhase;
  txt.textContent=tlPhase==='green'?'GREEN ‚Äî WALK':tlPhase==='yellow'?'YELLOW ‚Äî CAUTION':'RED ‚Äî WAIT';
  txt.style.color=tlPhase==='green'?'var(--green)':tlPhase==='yellow'?'var(--yellow)':'var(--red)';
  tmr.textContent=`${tlTimer.toFixed(1)}s`;
}

let warnTimer=0;
function update(dt){
  updateTrafficLight(dt);
  entities.forEach(e=>{
    if(e.isCar){let shouldStop=false;if(tlPhase==='red'||tlPhase==='yellow'){for(const hy of hRoads){for(const vx of vRoads){const dx=e.x-vx,dy=e.y-hy,d=Math.sqrt(dx*dx+dy*dy);if(d<ROAD_W*1.2&&d>30)shouldStop=true}}}e.stopped=shouldStop;if(!shouldStop){if(e.isHRoad){e.x+=e.roadDir*e.speed*dt*60;if(e.roadDir>0&&e.x>WW+150)e.x=-150;if(e.roadDir<0&&e.x<-150)e.x=WW+150}else{e.y+=e.roadDir*e.speed*dt*60;if(e.roadDir>0&&e.y>WH+150)e.y=-150;if(e.roadDir<0&&e.y<-150)e.y=WH+150}}}
    else{e.wander-=dt;if(e.wander<=0){const p=randomSidewalkPos();e.targetX=p.x;e.targetY=p.y;e.wander=e.erratic?1+Math.random()*2:3+Math.random()*6}const dx=e.targetX-e.x,dy=e.targetY-e.y,d=Math.sqrt(dx*dx+dy*dy);if(d>10){e.heading=Math.atan2(dy,dx);let nx=e.x+Math.cos(e.heading)*e.speed*dt*60,ny=e.y+Math.sin(e.heading)*e.speed*dt*60;nx=Math.max(30,Math.min(WW-30,nx));ny=Math.max(30,Math.min(WH-30,ny));if(!isInsideBuilding(nx,ny)){e.x=nx;e.y=ny}else e.wander=0}}
    e.anim+=dt*(e.erratic?8:e.isCar?2:4);
  });
  if(autoWalk){
    opt.speed=1.8;const onRoad=isOnRoad(opt.x,opt.y),onCross=isOnCrosswalk(opt.x,opt.y);
    if(onRoad&&!onCross&&tlPhase==='red'){opt.waitingAtLight=true;opt.speed=0}
    else if(onCross&&tlPhase==='red'){opt.waitingAtLight=true;opt.speed=0}
    else opt.waitingAtLight=false;
    const dx=opt.targetX-opt.x,dy=opt.targetY-opt.y,d=Math.sqrt(dx*dx+dy*dy);
    if(d<50){for(let i=0;i<30;i++){const p=randomSidewalkPos();opt.targetX=p.x;opt.targetY=p.y;if(!isInsideBuilding(opt.targetX,opt.targetY))break}addLog('nav',`Waypoint [${(opt.targetX/10).toFixed(0)}, ${(opt.targetY/10).toFixed(0)}]`)}
    if(opt.speed>0){const desH=Math.atan2(dy,dx);let hDiff=desH-opt.heading;while(hDiff>Math.PI)hDiff-=Math.PI*2;while(hDiff<-Math.PI)hDiff+=Math.PI*2;opt.heading+=hDiff*dt*3;
      let nx=opt.x+Math.cos(opt.heading)*opt.speed*dt*60,ny=opt.y+Math.sin(opt.heading)*opt.speed*dt*60;
      const col=checkCollision(nx,ny,25);if(col){opt.avoiding=true;opt.avoidTimer=1.5;avoidCount++;document.getElementById('avoidCount').textContent=avoidCount;warnTimer=1;opt.heading+=Math.PI/2+(Math.random()-.5)*.5;nx=opt.x+Math.cos(opt.heading)*opt.speed*dt*30;ny=opt.y+Math.sin(opt.heading)*opt.speed*dt*30;const p=randomSidewalkPos();opt.targetX=p.x;opt.targetY=p.y;addLog('avoid',`‚ö† ${col.obj?.name||col.type} ‚Äî rerouting`);const col2=checkCollision(nx,ny,25);if(col2){nx=opt.x;ny=opt.y}}
      opt.x=Math.max(30,Math.min(WW-30,nx));opt.y=Math.max(30,Math.min(WH-30,ny));totalDist+=opt.speed*dt*60*.01;opt.walkPhase+=dt*6}
  }
  if(opt.avoidTimer>0)opt.avoidTimer-=dt;else opt.avoiding=false;
  if(warnTimer>0){warnTimer-=dt;document.getElementById('collisionWarn').classList.toggle('show',warnTimer>0)}
}

function getInFOV(){const arr=[];entities.forEach(e=>{const dx=e.x-opt.x,dy=e.y-opt.y,d=Math.sqrt(dx*dx+dy*dy);if(d>opt.fovRange)return;let a=Math.atan2(dy,dx)-opt.heading;while(a>Math.PI)a-=Math.PI*2;while(a<-Math.PI)a+=Math.PI*2;if(Math.abs(a)<opt.fovAngle/2)arr.push({e,d,a})});arr.sort((a,b)=>a.d-b.d);return arr}
function classify(inFov){inFov.forEach(({e,d})=>{const pf=1-d/opt.fovRange;e.classConf=Math.min(.99,e.classConf+pf*.04);if(e.classConf>.55&&!e.classified){e.classified=true;if(e.type==='human')seenH.add(e.id);else if(e.type==='robot')seenR.add(e.id);else if(e.type==='car')seenC.add(e.id);else if(e.type==='child')seenCh.add(e.id);addLog('class',`${e.name}: ${e.type.toUpperCase()} (${(e.classConf*100).toFixed(0)}%) thermal=${e.thermal.toFixed(1)}¬∞C`);if(e.type==='child')addLog('avoid','‚ö° CHILD ‚Äî extra caution');if(e.type==='car')addLog('avoid','üöó VEHICLE ‚Äî safe distance')}})}

// ===== DRAW CITY =====
function drawCity(){
  const W=cityC.width,H=cityC.height,sc=Math.min(W/(opt.fovRange*3),H/(opt.fovRange*3)),cx=opt.x,cy=opt.y;
  function ts(wx,wy){return[(wx-cx)*sc+W/2,(wy-cy)*sc+H/2]}
  ctx.fillStyle='#1a1a24';ctx.fillRect(0,0,W,H);
  ctx.fillStyle='#2a2a2a';hRoads.forEach(hy=>{const[,ry]=ts(0,hy-ROAD_W/2);const[,ry2]=ts(0,hy+ROAD_W/2);ctx.fillRect(0,ry,W,ry2-ry)});
  vRoads.forEach(vx=>{const[rx]=ts(vx-ROAD_W/2,0);const[rx2]=ts(vx+ROAD_W/2,0);ctx.fillRect(rx,0,rx2-rx,H)});
  ctx.strokeStyle='#555';ctx.lineWidth=1;ctx.setLineDash([8,8]);hRoads.forEach(hy=>{const[lx,ly]=ts(0,hy);const[rx]=ts(WW,hy);ctx.beginPath();ctx.moveTo(lx,ly);ctx.lineTo(rx,ly);ctx.stroke()});vRoads.forEach(vx=>{const[lx,ly]=ts(vx,0);const[,by]=ts(vx,WH);ctx.beginPath();ctx.moveTo(lx,ly);ctx.lineTo(lx,by);ctx.stroke()});ctx.setLineDash([]);
  ctx.fillStyle='#333340';hRoads.forEach(hy=>{const[,y1]=ts(0,hy-ROAD_W/2-SIDEWALK_W);const[,y2]=ts(0,hy-ROAD_W/2);ctx.fillRect(0,y1,W,y2-y1);const[,y3]=ts(0,hy+ROAD_W/2);const[,y4]=ts(0,hy+ROAD_W/2+SIDEWALK_W);ctx.fillRect(0,y3,W,y4-y3)});vRoads.forEach(vx=>{const[x1]=ts(vx-ROAD_W/2-SIDEWALK_W,0);const[x2]=ts(vx-ROAD_W/2,0);ctx.fillRect(x1,0,x2-x1,H);const[x3]=ts(vx+ROAD_W/2,0);const[x4]=ts(vx+ROAD_W/2+SIDEWALK_W,0);ctx.fillRect(x3,0,x4-x3,H)});
  crosswalks.forEach(cw=>{const[cwx,cwy]=ts(cw.x,cw.y);ctx.fillStyle='rgba(255,255,255,.12)';if(cw.dir==='h'){for(let i=-5;i<=5;i++)ctx.fillRect(cwx+i*8*sc*.1-3*sc*.1,cwy-3*sc*.1,6*sc*.1,6*sc*.1)}else{for(let i=-5;i<=5;i++)ctx.fillRect(cwx-3*sc*.1,cwy+i*8*sc*.1-3*sc*.1,6*sc*.1,6*sc*.1)}});
  buildings.forEach(b=>{const[bx,by]=ts(b.x,b.y);const bw=b.w*sc,bh=b.h*sc;if(bx+bw<-20||bx>W+20||by+bh<-20||by>H+20)return;ctx.fillStyle=b.color;ctx.fillRect(bx,by,bw,bh);ctx.strokeStyle='rgba(60,60,80,.6)';ctx.lineWidth=1;ctx.strokeRect(bx,by,bw,bh);if(b.windows&&sc>.03){const wS=Math.max(8,12*sc*.1);const wSz=Math.max(3,5*sc*.1);for(let wx=bx+wS;wx<bx+bw-wS;wx+=wS){for(let wy=by+wS;wy<by+bh-wS;wy+=Math.max(8,10*sc*.1)){ctx.fillStyle=Math.random()>.35?'rgba(255,220,100,.25)':'rgba(20,20,40,.4)';ctx.fillRect(wx,wy,wSz,wSz*.7)}}}if(sc>.04){ctx.font=`bold ${Math.max(7,8*sc*.1)}px JetBrains Mono`;ctx.fillStyle='rgba(255,255,255,.15)';ctx.textAlign='center';ctx.fillText(`${b.floors}F`,bx+bw/2,by+bh/2);ctx.textAlign='start'}});
  streetLights.forEach(sl=>{const[sx,sy]=ts(sl.x,sl.y);if(sx<-10||sx>W+10||sy<-10||sy>H+10)return;const s=sc*.08;ctx.fillStyle='#555';ctx.fillRect(sx-1,sy-8*s,2,8*s);ctx.fillStyle='rgba(255,220,100,.5)';ctx.beginPath();ctx.arc(sx,sy-8*s,3*s,0,Math.PI*2);ctx.fill();const glow=ctx.createRadialGradient(sx,sy-8*s,0,sx,sy-8*s,25*s);glow.addColorStop(0,'rgba(255,220,100,.06)');glow.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=glow;ctx.beginPath();ctx.arc(sx,sy-8*s,25*s,0,Math.PI*2);ctx.fill()});
  trafficLights.forEach(tl=>{const[tx,ty]=ts(tl.x,tl.y);if(tx<-10||tx>W+10||ty<-10||ty>H+10)return;const s=sc*.08;ctx.fillStyle='#222';ctx.fillRect(tx-3*s,ty-12*s,6*s,12*s);[{c:'#ef4444',a:tlPhase==='red'},{c:'#f59e0b',a:tlPhase==='yellow'},{c:'#10b981',a:tlPhase==='green'}].forEach((cl,i)=>{ctx.fillStyle=cl.a?cl.c:'rgba(50,50,50,.5)';ctx.beginPath();ctx.arc(tx,ty-10*s+i*4*s,1.5*s,0,Math.PI*2);ctx.fill();if(cl.a){ctx.fillStyle=cl.c+'40';ctx.beginPath();ctx.arc(tx,ty-10*s+i*4*s,4*s,0,Math.PI*2);ctx.fill()}})});
  if(showFOV){const[ox,oy]=ts(opt.x,opt.y);ctx.save();ctx.globalAlpha=.07;ctx.fillStyle=A;ctx.beginPath();ctx.moveTo(ox,oy);ctx.arc(ox,oy,opt.fovRange*sc,opt.heading-opt.fovAngle/2,opt.heading+opt.fovAngle/2);ctx.closePath();ctx.fill();ctx.globalAlpha=.2;ctx.strokeStyle=A;ctx.lineWidth=1;ctx.setLineDash([5,4]);const fa1=opt.heading-opt.fovAngle/2,fa2=opt.heading+opt.fovAngle/2,fr=opt.fovRange*sc;ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(ox+Math.cos(fa1)*fr,oy+Math.sin(fa1)*fr);ctx.stroke();ctx.beginPath();ctx.moveTo(ox,oy);ctx.lineTo(ox+Math.cos(fa2)*fr,oy+Math.sin(fa2)*fr);ctx.stroke();ctx.setLineDash([]);ctx.restore()}
  entities.forEach(e=>{const[ex,ey]=ts(e.x,e.y);if(ex<-60||ex>W+60||ey<-60||ey>H+60)return;const s=sc*.1;
    if(e.isCar){ctx.save();ctx.translate(ex,ey);ctx.rotate(e.heading);ctx.fillStyle=e.color;ctx.beginPath();ctx.moveTo(-22*s,-10*s);ctx.lineTo(22*s,-10*s);ctx.quadraticCurveTo(26*s,-10*s,26*s,-6*s);ctx.lineTo(26*s,6*s);ctx.quadraticCurveTo(26*s,10*s,22*s,10*s);ctx.lineTo(-22*s,10*s);ctx.quadraticCurveTo(-26*s,10*s,-26*s,6*s);ctx.lineTo(-26*s,-6*s);ctx.quadraticCurveTo(-26*s,-10*s,-22*s,-10*s);ctx.closePath();ctx.fill();ctx.fillStyle='rgba(100,200,255,.25)';ctx.fillRect(14*s,-8*s,8*s,16*s);ctx.fillStyle='#ffd700';ctx.fillRect(24*s,-7*s,3*s,4*s);ctx.fillRect(24*s,3*s,3*s,4*s);ctx.fillStyle='#ff3333';ctx.fillRect(-27*s,-7*s,3*s,4*s);ctx.fillRect(-27*s,3*s,3*s,4*s);if(e.stopped){ctx.fillStyle='rgba(239,68,68,.6)';ctx.fillRect(-27*s,-9*s,6*s,18*s)}ctx.restore()}
    else if(e.type==='child'){const ls=Math.sin(e.anim)*3*s;ctx.fillStyle='rgba(0,0,0,.15)';ctx.beginPath();ctx.ellipse(ex,ey+1*s,5*s,3*s,0,0,Math.PI*2);ctx.fill();ctx.strokeStyle=e.color;ctx.lineWidth=2*s;ctx.lineCap='round';ctx.beginPath();ctx.moveTo(ex-2*s,ey-1*s);ctx.lineTo(ex-2*s+ls,ey+2*s);ctx.stroke();ctx.beginPath();ctx.moveTo(ex+2*s,ey-1*s);ctx.lineTo(ex+2*s-ls,ey+2*s);ctx.stroke();ctx.fillStyle=e.color;ctx.beginPath();ctx.ellipse(ex,ey-5*s,4*s,6*s,0,0,Math.PI*2);ctx.fill();ctx.fillStyle='#daa06d';ctx.beginPath();ctx.arc(ex,ey-12*s,3.5*s,0,Math.PI*2);ctx.fill()}
    else if(e.type==='human'){const ls=Math.sin(e.anim)*4*s;ctx.fillStyle='rgba(0,0,0,.15)';ctx.beginPath();ctx.ellipse(ex,ey+2*s,7*s,4*s,0,0,Math.PI*2);ctx.fill();ctx.strokeStyle=e.color;ctx.lineWidth=3*s;ctx.lineCap='round';ctx.beginPath();ctx.moveTo(ex-3*s,ey-2*s);ctx.lineTo(ex-3*s+ls,ey+2*s);ctx.stroke();ctx.beginPath();ctx.moveTo(ex+3*s,ey-2*s);ctx.lineTo(ex+3*s-ls,ey+2*s);ctx.stroke();ctx.fillStyle=e.color;ctx.beginPath();ctx.ellipse(ex,ey-8*s,6*s,10*s,0,0,Math.PI*2);ctx.fill();const as=Math.sin(e.anim+.5)*3*s;ctx.strokeStyle=e.color;ctx.lineWidth=2.5*s;ctx.beginPath();ctx.moveTo(ex-6*s,ey-10*s);ctx.lineTo(ex-10*s,ey-4*s+as);ctx.stroke();ctx.beginPath();ctx.moveTo(ex+6*s,ey-10*s);ctx.lineTo(ex+10*s,ey-4*s-as);ctx.stroke();ctx.fillStyle='#daa06d';ctx.beginPath();ctx.arc(ex,ey-20*s,5*s,0,Math.PI*2);ctx.fill()}
    else{const bob=Math.sin(e.anim)*1.5*s;ctx.fillStyle='rgba(0,0,0,.15)';ctx.beginPath();ctx.ellipse(ex,ey+2*s,7*s,4*s,0,0,Math.PI*2);ctx.fill();if(e.gait==='wheeled'){ctx.fillStyle='#333';ctx.fillRect(ex-5*s,ey-1*s,3*s,3*s);ctx.fillRect(ex+2*s,ey-1*s,3*s,3*s)}else{ctx.strokeStyle='#555';ctx.lineWidth=2.5*s;ctx.beginPath();ctx.moveTo(ex-3*s,ey-3*s);ctx.lineTo(ex-3*s,ey+2*s);ctx.stroke();ctx.beginPath();ctx.moveTo(ex+3*s,ey-3*s);ctx.lineTo(ex+3*s,ey+2*s);ctx.stroke()}ctx.fillStyle=e.color;ctx.fillRect(ex-6*s,ey-14*s+bob,12*s,12*s);ctx.fillStyle='#2a2a3a';ctx.fillRect(ex-4*s,ey-19*s+bob,8*s,5*s);ctx.fillStyle=A;ctx.fillRect(ex-2.5*s,ey-17.5*s+bob,2*s,1.5*s);ctx.fillRect(ex+.5*s,ey-17.5*s+bob,2*s,1.5*s)}
    if(e.classified){const bgC=e.isCar?'rgba(239,68,68,.85)':e.type==='child'?'rgba(16,185,129,.85)':e.type==='human'?'rgba(245,158,11,.85)':'rgba(124,58,237,.85)';const label=`${e.type.toUpperCase()} ${(e.classConf*100).toFixed(0)}%`;ctx.font=`bold ${Math.max(8,9*s)}px JetBrains Mono`;const tw=ctx.measureText(label).width;const ly=e.isCar?ey-18*s:e.type==='child'?ey-17*s:e.type==='human'?ey-27*s:ey-24*s;ctx.fillStyle=bgC;ctx.fillRect(ex-tw/2-3,ly-8*s,tw+6,10*s);ctx.fillStyle='#fff';ctx.fillText(label,ex-tw/2,ly)}
  });
  // Optimus Prime
  const[ox,oy]=ts(opt.x,opt.y);const os=sc*.11;
  const gGr=ctx.createRadialGradient(ox,oy,0,ox,oy,22*os);gGr.addColorStop(0,opt.avoiding?'rgba(239,68,68,.25)':opt.waitingAtLight?'rgba(245,158,11,.2)':'rgba(0,120,255,.15)');gGr.addColorStop(1,'rgba(0,0,0,0)');ctx.fillStyle=gGr;ctx.beginPath();ctx.arc(ox,oy,22*os,0,Math.PI*2);ctx.fill();
  // Shadow
  ctx.fillStyle='rgba(0,0,0,.3)';ctx.beginPath();ctx.ellipse(ox,oy+4*os,10*os,5*os,0,0,Math.PI*2);ctx.fill();
  // Legs - blue mechanical with knee joints
  const lw=Math.sin(opt.walkPhase)*3*os;
  ctx.fillStyle='#1a3a8a';ctx.strokeStyle='#2a5acc';ctx.lineWidth=1;
  // Left leg upper
  ctx.save();ctx.beginPath();ctx.moveTo(ox-5*os,oy-2*os);ctx.lineTo(ox-6.5*os,oy+2*os+lw);ctx.lineTo(ox-2*os,oy+2*os+lw);ctx.lineTo(ox-3*os,oy-2*os);ctx.closePath();ctx.fill();ctx.stroke();ctx.restore();
  // Left foot
  ctx.fillStyle='#1a3a8a';ctx.fillRect(ox-7.5*os,oy+2*os+lw,6*os,2.5*os);ctx.strokeRect(ox-7.5*os,oy+2*os+lw,6*os,2.5*os);
  // Right leg upper
  ctx.fillStyle='#1a3a8a';ctx.beginPath();ctx.moveTo(ox+3*os,oy-2*os);ctx.lineTo(ox+2*os,oy+2*os-lw);ctx.lineTo(ox+6.5*os,oy+2*os-lw);ctx.lineTo(ox+5*os,oy-2*os);ctx.closePath();ctx.fill();ctx.stroke();
  // Right foot
  ctx.fillRect(ox+1.5*os,oy+2*os-lw,6*os,2.5*os);ctx.strokeRect(ox+1.5*os,oy+2*os-lw,6*os,2.5*os);
  // Wheel details on legs
  ctx.fillStyle='#333';ctx.beginPath();ctx.arc(ox-4.5*os,oy+1*os+lw*.5,1.5*os,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(ox+4.5*os,oy+1*os-lw*.5,1.5*os,0,Math.PI*2);ctx.fill();
  // Waist/hip
  ctx.fillStyle='#555';ctx.fillRect(ox-6*os,oy-3*os,12*os,2*os);ctx.strokeStyle='#777';ctx.strokeRect(ox-6*os,oy-3*os,12*os,2*os);
  // Chest/torso - RED (Optimus Prime signature)
  const chestColor=opt.avoiding?'#8b1a1a':opt.waitingAtLight?'#8b6a1a':'#cc2222';
  const chestBorder=opt.avoiding?'#ef4444':opt.waitingAtLight?'#f59e0b':'#ff3333';
  ctx.fillStyle=chestColor;ctx.strokeStyle=chestBorder;ctx.lineWidth=1.5;
  ctx.beginPath();ctx.moveTo(ox-8*os,oy-5*os);ctx.lineTo(ox-9*os,oy-16*os);ctx.lineTo(ox-5*os,oy-18*os);ctx.lineTo(ox+5*os,oy-18*os);ctx.lineTo(ox+9*os,oy-16*os);ctx.lineTo(ox+8*os,oy-5*os);ctx.closePath();ctx.fill();ctx.stroke();
  // Chest windows (truck windshield details)
  ctx.fillStyle='rgba(100,180,255,.3)';ctx.fillRect(ox-5*os,oy-15*os,4*os,5*os);ctx.fillRect(ox+1*os,oy-15*os,4*os,5*os);ctx.strokeStyle='rgba(150,200,255,.5)';ctx.lineWidth=.5;ctx.strokeRect(ox-5*os,oy-15*os,4*os,5*os);ctx.strokeRect(ox+1*os,oy-15*os,4*os,5*os);
  // Autobot insignia (center chest)
  ctx.fillStyle='rgba(200,50,50,.7)';ctx.beginPath();ctx.moveTo(ox,oy-8*os);ctx.lineTo(ox-2*os,oy-6*os);ctx.lineTo(ox,oy-7*os);ctx.lineTo(ox+2*os,oy-6*os);ctx.closePath();ctx.fill();
  // Shoulders - red armored
  ctx.fillStyle=chestColor;ctx.strokeStyle=chestBorder;ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(ox-9*os,oy-16*os);ctx.lineTo(ox-13*os,oy-14*os);ctx.lineTo(ox-12*os,oy-10*os);ctx.lineTo(ox-8*os,oy-10*os);ctx.closePath();ctx.fill();ctx.stroke();
  ctx.beginPath();ctx.moveTo(ox+9*os,oy-16*os);ctx.lineTo(ox+13*os,oy-14*os);ctx.lineTo(ox+12*os,oy-10*os);ctx.lineTo(ox+8*os,oy-10*os);ctx.closePath();ctx.fill();ctx.stroke();
  // Arms - silver/grey mechanical
  const as=Math.sin(opt.walkPhase+.5)*2*os;
  ctx.fillStyle='#888';ctx.strokeStyle='#aaa';ctx.lineWidth=1;
  ctx.fillRect(ox-13*os,oy-10*os,4*os,8*os+as);ctx.strokeRect(ox-13*os,oy-10*os,4*os,8*os+as);
  ctx.fillRect(ox+9*os,oy-10*os,4*os,8*os-as);ctx.strokeRect(ox+9*os,oy-10*os,4*os,8*os-as);
  // Hands - grey
  ctx.fillStyle='#666';ctx.beginPath();ctx.arc(ox-11*os,oy-2*os+as,2*os,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(ox+11*os,oy-2*os-as,2*os,0,Math.PI*2);ctx.fill();
  // Neck
  ctx.fillStyle='#555';ctx.fillRect(ox-2.5*os,oy-20*os,5*os,3*os);
  // Head - blue helmet
  const headColor=opt.avoiding?'#3a1a1a':opt.waitingAtLight?'#3a3a1a':'#1a3a8a';
  const headBorder=opt.avoiding?'#ef4444':opt.waitingAtLight?'#f59e0b':'#2a6aee';
  ctx.fillStyle=headColor;ctx.strokeStyle=headBorder;ctx.lineWidth=1.5;
  ctx.beginPath();ctx.ellipse(ox,oy-26*os,6.5*os,7*os,0,0,Math.PI*2);ctx.fill();ctx.stroke();
  // Helmet crest
  ctx.fillStyle=headColor;ctx.strokeStyle=headBorder;ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(ox-1.5*os,oy-33*os);ctx.lineTo(ox,oy-36*os);ctx.lineTo(ox+1.5*os,oy-33*os);ctx.closePath();ctx.fill();ctx.stroke();
  // Helmet horns/antennae
  ctx.fillStyle='#2a6aee';ctx.strokeStyle=headBorder;ctx.lineWidth=1;
  ctx.beginPath();ctx.moveTo(ox-5*os,oy-30*os);ctx.lineTo(ox-7*os,oy-35*os);ctx.lineTo(ox-4*os,oy-31*os);ctx.closePath();ctx.fill();ctx.stroke();
  ctx.beginPath();ctx.moveTo(ox+5*os,oy-30*os);ctx.lineTo(ox+7*os,oy-35*os);ctx.lineTo(ox+4*os,oy-31*os);ctx.closePath();ctx.fill();ctx.stroke();
  // Face plate - silver
  ctx.fillStyle='#bbb';ctx.fillRect(ox-4*os,oy-25*os,8*os,4*os);ctx.strokeStyle='#999';ctx.strokeRect(ox-4*os,oy-25*os,8*os,4*os);
  // Mouth grille
  ctx.fillStyle='#666';for(let i=0;i<4;i++){ctx.fillRect(ox-3*os+i*2*os,oy-23*os,.8*os,2*os)}
  // Eyes - glowing cyan/blue
  const eg=.6+Math.sin(performance.now()*.002)*.3;
  ctx.fillStyle=opt.avoiding?'#ef4444':opt.waitingAtLight?'#f59e0b':'#44bbff';ctx.globalAlpha=eg;
  ctx.beginPath();ctx.ellipse(ox-2.5*os,oy-27*os,1.5*os,1*os,0,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.ellipse(ox+2.5*os,oy-27*os,1.5*os,1*os,0,0,Math.PI*2);ctx.fill();
  // Eye glow
  ctx.globalAlpha=eg*.3;ctx.fillStyle=opt.avoiding?'#ef4444':opt.waitingAtLight?'#f59e0b':'#44bbff';
  ctx.beginPath();ctx.arc(ox-2.5*os,oy-27*os,3*os,0,Math.PI*2);ctx.fill();
  ctx.beginPath();ctx.arc(ox+2.5*os,oy-27*os,3*os,0,Math.PI*2);ctx.fill();
  ctx.globalAlpha=1;
  // Name label
  ctx.font=`bold ${Math.max(9,8*os)}px JetBrains Mono`;ctx.fillStyle=opt.avoiding?'#ef4444':opt.waitingAtLight?'#f59e0b':'#44bbff';ctx.textAlign='center';ctx.fillText(opt.avoiding?'OPTIMUS ‚ö† AVOID':opt.waitingAtLight?'OPTIMUS ‚óè WAITING':'OPTIMUS PRIME',ox,oy-39*os);ctx.textAlign='start';
}

// ===== VISION CAMERA =====
function drawVision(inFov){
  const W=visC.width,H=visC.height;vCtx.fillStyle='#080a10';vCtx.fillRect(0,0,W,H);
  const sg=vCtx.createLinearGradient(0,0,0,H);sg.addColorStop(0,'#0a0f1a');sg.addColorStop(.3,'#1a1a2e');sg.addColorStop(.5,'#2a2a2a');sg.addColorStop(1,'#1a1a1a');vCtx.fillStyle=sg;vCtx.fillRect(0,0,W,H);
  for(let i=0;i<8;i++){const bx=i*W/8;const bw=W/8-4;const bh=H*.15+Math.sin(i*2.5)*H*.1;vCtx.fillStyle=`rgba(20,20,35,${.4+Math.random()*.2})`;vCtx.fillRect(bx+2,H*.35-bh,bw,bh);for(let wx=bx+6;wx<bx+bw-4;wx+=8){for(let wy=H*.35-bh+5;wy<H*.35-5;wy+=7){vCtx.fillStyle=Math.random()>.5?'rgba(255,220,100,.15)':'rgba(10,10,20,.3)';vCtx.fillRect(wx,wy,4,3)}}}
  inFov.forEach(({e,d,a})=>{const na=a/(opt.fovAngle/2);const sx=W/2+na*(W/2)*.8;const df=1-d/opt.fovRange;const sy=H*.5-df*H*.12+H*.08;const sz=25+df*40;const isH=e.type==='human'||e.type==='child';const isCar=e.type==='car';
    if(isCar){vCtx.fillStyle=e.color+'80';vCtx.fillRect(sx-sz*.6,sy-sz*.3,sz*1.2,sz*.6)}else if(e.type==='child'){vCtx.fillStyle=e.color+'80';vCtx.beginPath();vCtx.ellipse(sx,sy-sz*.15,sz*.15,sz*.25,0,0,Math.PI*2);vCtx.fill();vCtx.fillStyle='#daa06d80';vCtx.beginPath();vCtx.arc(sx,sy-sz*.45,sz*.1,0,Math.PI*2);vCtx.fill()}else if(isH){vCtx.fillStyle=e.color+'80';vCtx.beginPath();vCtx.ellipse(sx,sy-sz*.3,sz*.2,sz*.35,0,0,Math.PI*2);vCtx.fill();vCtx.fillStyle='#daa06d80';vCtx.beginPath();vCtx.arc(sx,sy-sz*.75,sz*.12,0,Math.PI*2);vCtx.fill()}else{vCtx.fillStyle='#cc222280';vCtx.fillRect(sx-sz*.22,sy-sz*.5,sz*.44,sz*.4);vCtx.fillStyle='#1a3a8a80';vCtx.beginPath();vCtx.ellipse(sx,sy-sz*.62,sz*.16,sz*.18,0,0,Math.PI*2);vCtx.fill();vCtx.fillStyle='#88888880';vCtx.fillRect(sx-sz*.3,sy-sz*.42,sz*.1,sz*.3);vCtx.fillRect(sx+sz*.2,sy-sz*.42,sz*.1,sz*.3);vCtx.fillStyle='#44bbff60';vCtx.fillRect(sx-sz*.08,sy-sz*.65,sz*.06,sz*.04);vCtx.fillRect(sx+sz*.02,sy-sz*.65,sz*.06,sz*.04);vCtx.fillStyle='#1a3a8a80';vCtx.fillRect(sx-sz*.18,sy-sz*.1,sz*.14,sz*.35);vCtx.fillRect(sx+sz*.04,sy-sz*.1,sz*.14,sz*.35)}
    const bColor=isCar?'rgba(239,68,68,.8)':e.type==='child'?'rgba(16,185,129,.8)':isH?'rgba(245,158,11,.8)':'rgba(124,58,237,.8)';const bw=isCar?sz*1.4:sz*.6,bh=isCar?sz*.8:sz*1;const bx=sx-bw/2,by=sy-bh+sz*.25;vCtx.strokeStyle=bColor;vCtx.lineWidth=2;vCtx.setLineDash([4,2]);vCtx.strokeRect(bx,by,bw,bh);vCtx.setLineDash([]);const cl=7;vCtx.lineWidth=3;
    vCtx.beginPath();vCtx.moveTo(bx,by+cl);vCtx.lineTo(bx,by);vCtx.lineTo(bx+cl,by);vCtx.stroke();vCtx.beginPath();vCtx.moveTo(bx+bw-cl,by);vCtx.lineTo(bx+bw,by);vCtx.lineTo(bx+bw,by+cl);vCtx.stroke();vCtx.beginPath();vCtx.moveTo(bx,by+bh-cl);vCtx.lineTo(bx,by+bh);vCtx.lineTo(bx+cl,by+bh);vCtx.stroke();vCtx.beginPath();vCtx.moveTo(bx+bw-cl,by+bh);vCtx.lineTo(bx+bw,by+bh);vCtx.lineTo(bx+bw,by+bh-cl);vCtx.stroke();
    const lt=`${e.type.toUpperCase()} ‚Äî ${e.name} ${e.classified?(e.classConf*100).toFixed(0)+'%':'...'}`;vCtx.font=`bold ${Math.max(10,sz*.17)}px JetBrains Mono`;const tw=vCtx.measureText(lt).width;vCtx.fillStyle=bColor;vCtx.fillRect(bx,by-14,tw+6,12);vCtx.fillStyle='#fff';vCtx.fillText(lt,bx+3,by-4);
    vCtx.font=`${Math.max(8,sz*.12)}px JetBrains Mono`;vCtx.fillStyle='rgba(255,255,255,.5)';vCtx.fillText(`${d.toFixed(1)}m | danger: ${e.danger||'none'}`,bx+3,by+bh+10);const tn=(e.thermal-20)/50;vCtx.fillStyle='rgba(0,0,0,.4)';vCtx.fillRect(bx,by+bh+15,bw*.5,4);vCtx.fillStyle=e.thermal>34?'rgba(245,158,11,.7)':'rgba(124,58,237,.6)';vCtx.fillRect(bx,by+bh+15,bw*.5*tn,4);vCtx.fillStyle='rgba(255,255,255,.4)';vCtx.fillText(`${e.thermal.toFixed(0)}¬∞C`,bx+bw*.5+4,by+bh+20)});
  vCtx.strokeStyle='rgba(0,212,255,.15)';vCtx.lineWidth=1;vCtx.setLineDash([3,3]);vCtx.beginPath();vCtx.moveTo(W/2,0);vCtx.lineTo(W/2,H);vCtx.stroke();vCtx.beginPath();vCtx.moveTo(0,H/2);vCtx.lineTo(W,H/2);vCtx.stroke();vCtx.setLineDash([]);
  const tlC={green:'#10b981',yellow:'#f59e0b',red:'#ef4444'};vCtx.fillStyle='rgba(0,0,0,.6)';vCtx.fillRect(W-90,10,80,24);vCtx.fillStyle=tlC[tlPhase];vCtx.beginPath();vCtx.arc(W-70,22,6,0,Math.PI*2);vCtx.fill();vCtx.font='bold 10px JetBrains Mono';vCtx.fillText(tlPhase.toUpperCase(),W-58,26);
  document.getElementById('vHudR').textContent=`${inFov.length} in FOV`;document.getElementById('vHud').textContent=`CAM | 30fps | ${opt.avoiding?'‚ö† AVOID':opt.waitingAtLight?'‚óè WAIT':'CITY MODE'}`;
}

function drawMM(){const W=mmC.width,H=mmC.height;mCtx.fillStyle='#0a0a14';mCtx.fillRect(0,0,W,H);const sx=W/WW,sy=H/WH;mCtx.fillStyle='#222';hRoads.forEach(hy=>{mCtx.fillRect(0,(hy-ROAD_W/2)*sy,W,ROAD_W*sy)});vRoads.forEach(vx=>{mCtx.fillRect((vx-ROAD_W/2)*sx,0,ROAD_W*sx,H)});mCtx.fillStyle='#2a2a35';buildings.forEach(b=>{mCtx.fillRect(b.x*sx,b.y*sy,b.w*sx,b.h*sy)});entities.forEach(e=>{mCtx.fillStyle=e.type==='car'?'#ef4444':e.type==='child'?'#10b981':e.type==='human'?'#f59e0b':'#7c3aed';mCtx.beginPath();mCtx.arc(e.x*sx,e.y*sy,e.isCar?3:2,0,Math.PI*2);mCtx.fill()});const ox=opt.x*sx,oy=opt.y*sy;mCtx.fillStyle='rgba(0,212,255,.08)';mCtx.beginPath();mCtx.moveTo(ox,oy);mCtx.arc(ox,oy,opt.fovRange*sx,opt.heading-opt.fovAngle/2,opt.heading+opt.fovAngle/2);mCtx.closePath();mCtx.fill();mCtx.fillStyle=opt.avoiding?'#ef4444':'#2a6aee';mCtx.beginPath();mCtx.arc(ox,oy,4,0,Math.PI*2);mCtx.fill();mCtx.fillStyle='#cc2222';mCtx.beginPath();mCtx.arc(ox,oy,2,0,Math.PI*2);mCtx.fill()}

function updateUI(inFov){
  const list=document.getElementById('entityList');list.innerHTML='';
  inFov.slice(0,6).forEach(({e,d})=>{const icon=e.isCar?'üöó':e.type==='child'?'üë∂':e.type==='human'?'üßë':'ü§ñ';const tc=e.isCar?'car':e.type;const conf=e.classified?(e.classConf*100).toFixed(0)+'%':'...';const cc=e.classConf>.85?'high':'mid';const card=document.createElement('div');card.className=`entity-card${d<80?' highlight':''}`;card.innerHTML=`<div class="e-icon">${icon}</div><div class="e-info"><div class="e-name">${e.name} <span class="e-type ${tc}">${e.type.toUpperCase()}</span></div></div><div class="e-dist">${d.toFixed(0)}m</div><div class="e-conf ${cc}">${conf}</div>`;list.appendChild(card)});
  if(inFov.length>0){const n=inFov[0].e;document.getElementById('fType').textContent=n.type.toUpperCase();document.getElementById('fType').style.color=n.isCar?'var(--car-color)':n.type==='child'?'var(--child-color)':n.type==='human'?'var(--human-color)':'var(--robot-color)';document.getElementById('fTherm').textContent=n.thermal.toFixed(1)+'¬∞C';document.getElementById('fTherm').style.color=n.thermal>34?'var(--human-color)':'var(--robot-color)';document.getElementById('fGait').textContent=n.gait||'‚Äî';document.getElementById('fSpd').textContent=n.speed?.toFixed(1)+' m/s'||'‚Äî';document.getElementById('fDanger').textContent=n.danger||'none';document.getElementById('fDanger').style.color=n.danger==='high'?'var(--red)':n.danger==='caution'?'var(--yellow)':'var(--green)';document.getElementById('fAction').textContent=n.isCar?'STOP & WAIT':n.type==='child'?'SLOW + CAUTION':'PASS'}
  document.getElementById('entityCount').textContent=entities.length;document.getElementById('hSeen').textContent=seenH.size;document.getElementById('rSeen').textContent=seenR.size;document.getElementById('cSeen').textContent=seenC.size;document.getElementById('chSeen').textContent=seenCh.size;document.getElementById('walkDist').textContent=totalDist.toFixed(0)+'m';document.getElementById('avoidances').textContent=avoidCount;
}

function addLog(tag,msg){const t=new Date().toTimeString().slice(0,8);const c=document.getElementById('consoleBody');const el=document.createElement('div');el.className='log';el.innerHTML=`<span class="lt">${t}</span><span class="ltag ${tag}">${tag.toUpperCase()}</span><span class="lmsg">${msg}</span>`;c.appendChild(el);c.scrollTop=c.scrollHeight;while(c.children.length>120)c.removeChild(c.firstChild)}

function toggleAuto(){autoWalk=!autoWalk;document.getElementById('btnAuto').classList.toggle('active',autoWalk);addLog('nav',autoWalk?'Auto-walk ON':'Paused')}
function toggleFOV(){showFOV=!showFOV}

let carTimer=0;
function autoSpawnCars(dt){carTimer-=dt;if(carTimer<=0){carTimer=1.5+Math.random()*3;spawnEntity('car');for(let i=entities.length-1;i>=0;i--){const e=entities[i];if(e.isCar&&(e.x<-250||e.x>WW+250||e.y<-250||e.y>WH+250))entities.splice(i,1)}}}

// ==================== TECH TAB CONSOLE ====================
function addTechLog(tag,msg){const t=new Date().toTimeString().slice(0,8)+'.'+String(Date.now()%1000).padStart(3,'0');const c=document.getElementById('techConsole');const el=document.createElement('div');el.className='log-entry';el.innerHTML=`<span class="log-time">${t}</span><span class="log-tag ${tag}">${tag.toUpperCase()}</span><span class="log-msg">${msg}</span>`;c.appendChild(el);c.scrollTop=c.scrollHeight;while(c.children.length>200)c.removeChild(c.firstChild)}
const techMsgs={vision:['Frame processed: 7 objects detected','Segmentation map: 12 classes, 94% mIoU','Pose estimation: person@2.8m','Affordance: cup ‚Üí graspable'],fusion:['EKF update: 84-dim state propagated','CoM: [0.02, -0.01, 0.82] ‚Äî nominal','Contact: 2 feet grounded, slip=0.01'],world:['Voxel map: 2.4M pts, 0.02m resolution','SLAM: city block mapped','Physics: collision check pass'],planner:['LLM: city navigation goal active','PDDL: 5 subtasks queued','BT: SEQUENCE node active'],rl:['Policy: 200Hz nominal','Action: 30-dim (28j + 2g)','Reward: +0.87'],control:['PID: 1000Hz all nominal','ZMP: within polygon','Safety: all joints OK'],memory:['Spatial: city map +12m¬≤','Episodic: 142 events','Vector DB: 14.2K embeddings']};
const techTags=['vision','fusion','world','planner','rl','control','memory'];

setInterval(()=>{const tag=techTags[Math.floor(Math.random()*techTags.length)];const pool=techMsgs[tag];addTechLog(tag,pool[Math.floor(Math.random()*pool.length)]);
  // Metrics
  const cpu=55+Math.floor(Math.random()*20);document.getElementById('cpuVal').textContent=cpu+'%';document.getElementById('cpuBar').style.width=cpu+'%';
  const gpu=70+Math.floor(Math.random()*18);document.getElementById('gpuVal').textContent=gpu+'%';document.getElementById('gpuBar').style.width=gpu+'%';
  const net=8+Math.floor(Math.random()*12);document.getElementById('netVal').textContent=net+' ms';document.getElementById('netBar').style.width=net+'%';
  const temp=38+Math.floor(Math.random()*10);document.getElementById('thermVal').textContent=temp+'¬∞C';document.getElementById('thermBar').style.width=temp+'%';
  document.getElementById('t_vFPS').textContent=(28+Math.floor(Math.random()*5))+' FPS';
  document.getElementById('t_ftVal').textContent=(10+Math.random()*8).toFixed(1)+' N';
  // Padel training progress tick
  trainingModules.forEach(t=>{if(t.progress<99.9)t.progress=Math.min(99.9,t.progress+Math.random()*.02)});
  if(Math.random()<.15){document.getElementById('pvAcc').textContent=(96.5+Math.random()*2).toFixed(1)+'%';document.getElementById('pvLat').textContent=(3.5+Math.random()*1.5).toFixed(1)+'ms';document.getElementById('pvShot').textContent=(93+Math.random()*3).toFixed(1)+'%';document.getElementById('pmSpd').textContent=(3.8+Math.random()*.8).toFixed(1)+' m/s';document.getElementById('pmReact').textContent=(78+Math.floor(Math.random()*15))+'ms';document.getElementById('pmSwing').textContent=(95+Math.random()*3).toFixed(1)+'%'}
},1200);

// ==================== BATTERY SYSTEM ====================
const battMapC=document.getElementById('battMapCanvas'),bMCtx=battMapC.getContext('2d');
const battRingC=document.getElementById('battRingCanvas'),bRCtx=battRingC.getContext('2d');
let battery={pct:84,voltage:48.2,current:-3.8,temp:34,health:96.2,cycles:523,charging:false,targetStation:null};
const chargingStations=[
  {id:1,name:'Station Alpha ‚Äî NW Corner',x:300,y:200,status:'available',power:'50kW DC Fast',slots:4,usedSlots:1,icon:'‚ö°'},
  {id:2,name:'Station Beta ‚Äî NE Corner',x:2900,y:200,status:'available',power:'50kW DC Fast',slots:3,usedSlots:0,icon:'‚ö°'},
  {id:3,name:'Station Gamma ‚Äî SW Corner',x:300,y:2200,status:'busy',power:'22kW AC Level 2',slots:2,usedSlots:2,icon:'üîå'},
  {id:4,name:'Station Delta ‚Äî SE Corner',x:2900,y:2200,status:'available',power:'50kW DC Fast',slots:4,usedSlots:2,icon:'‚ö°'},
  {id:5,name:'Station Epsilon ‚Äî City Center',x:1600,y:1200,status:'available',power:'150kW Ultra-Fast',slots:6,usedSlots:1,icon:'üîã'},
  {id:6,name:'Station Zeta ‚Äî North Central',x:1600,y:350,status:'available',power:'22kW AC Level 2',slots:2,usedSlots:0,icon:'üîå'},
  {id:7,name:'Station Eta ‚Äî East Central',x:2700,y:1200,status:'offline',power:'50kW DC Fast',slots:3,usedSlots:0,icon:'üö´'},
  {id:8,name:'Station Theta ‚Äî South Central',x:1600,y:2100,status:'available',power:'50kW DC Fast',slots:4,usedSlots:3,icon:'‚ö°'}
];

function resizeBattMap(){const r=battMapC.parentElement;battMapC.width=r.clientWidth;battMapC.height=r.clientHeight}
function drawBattMap(){
  const W=battMapC.width,H=battMapC.height;if(!W)return;
  bMCtx.fillStyle='#0a0a14';bMCtx.fillRect(0,0,W,H);
  const sx=W/WW,sy=H/WH,sc2=Math.min(sx,sy);
  // Roads
  bMCtx.fillStyle='#1a1a24';bMCtx.fillRect(0,0,W,H);
  bMCtx.fillStyle='#2a2a2a';
  hRoads.forEach(hy=>{bMCtx.fillRect(0,(hy-ROAD_W/2)*sy,W,ROAD_W*sy)});
  vRoads.forEach(vx=>{bMCtx.fillRect((vx-ROAD_W/2)*sx,0,ROAD_W*sx,H)});
  // Buildings
  bMCtx.fillStyle='#22222e';buildings.forEach(b=>{bMCtx.fillRect(b.x*sx,b.y*sy,b.w*sx,b.h*sy)});
  // Charging stations
  chargingStations.forEach(st=>{
    const cx=st.x*sx,cy=st.y*sy;
    const col=st.status==='available'?'#10b981':st.status==='busy'?'#f59e0b':'#ef4444';
    // Range ring
    bMCtx.strokeStyle=col+'30';bMCtx.lineWidth=1;bMCtx.setLineDash([4,4]);
    bMCtx.beginPath();bMCtx.arc(cx,cy,40*sc2,0,Math.PI*2);bMCtx.stroke();bMCtx.setLineDash([]);
    // Station marker
    bMCtx.fillStyle=col+'40';bMCtx.beginPath();bMCtx.arc(cx,cy,16*sc2,0,Math.PI*2);bMCtx.fill();
    bMCtx.fillStyle=col;bMCtx.beginPath();bMCtx.arc(cx,cy,8*sc2,0,Math.PI*2);bMCtx.fill();
    bMCtx.strokeStyle='#fff';bMCtx.lineWidth=2;
    bMCtx.beginPath();bMCtx.moveTo(cx-2*sc2,cy-5*sc2);bMCtx.lineTo(cx+2*sc2,cy);bMCtx.lineTo(cx-1*sc2,cy);bMCtx.lineTo(cx+2*sc2,cy+5*sc2);bMCtx.stroke();
    // Label
    bMCtx.font=`bold ${Math.max(9,10*sc2)}px JetBrains Mono`;bMCtx.fillStyle='#fff';bMCtx.textAlign='center';
    bMCtx.fillText(st.name.split('‚Äî')[0].trim(),cx,cy-14*sc2);
    bMCtx.font=`${Math.max(7,8*sc2)}px JetBrains Mono`;bMCtx.fillStyle=col;
    bMCtx.fillText(st.status.toUpperCase(),cx,cy+20*sc2);
    bMCtx.textAlign='start';
    // Route line if this is target
    if(battery.targetStation===st.id){
      bMCtx.strokeStyle='#10b98180';bMCtx.lineWidth=2;bMCtx.setLineDash([6,4]);
      bMCtx.beginPath();bMCtx.moveTo(opt.x*sx,opt.y*sy);bMCtx.lineTo(cx,cy);bMCtx.stroke();bMCtx.setLineDash([]);
      bMCtx.fillStyle='#10b981';bMCtx.font=`bold ${Math.max(9,10*sc2)}px JetBrains Mono`;bMCtx.textAlign='center';
      const mx=(opt.x*sx+cx)/2,my=(opt.y*sy+cy)/2;
      const dist=Math.sqrt((opt.x-st.x)**2+(opt.y-st.y)**2);
      bMCtx.fillText(`${(dist/100).toFixed(0)}m ‚Üí CHARGING`,mx,my-8);bMCtx.textAlign='start';
    }
  });
  // Optimus position
  const ox=opt.x*sx,oy=opt.y*sy;
  bMCtx.fillStyle='rgba(42,106,238,.15)';bMCtx.beginPath();bMCtx.arc(ox,oy,20*sc2,0,Math.PI*2);bMCtx.fill();
  bMCtx.fillStyle='#2a6aee';bMCtx.beginPath();bMCtx.arc(ox,oy,6*sc2,0,Math.PI*2);bMCtx.fill();
  bMCtx.fillStyle='#cc2222';bMCtx.beginPath();bMCtx.arc(ox,oy,3*sc2,0,Math.PI*2);bMCtx.fill();
  bMCtx.font=`bold ${Math.max(9,10*sc2)}px JetBrains Mono`;bMCtx.fillStyle='#44bbff';bMCtx.textAlign='center';
  bMCtx.fillText('OPTIMUS',ox,oy-10*sc2);bMCtx.textAlign='start';
}
function drawBattRing(){
  const W=140,H=140,cx=70,cy=70,r=55,lw=10;
  bRCtx.clearRect(0,0,W,H);
  // BG ring
  bRCtx.strokeStyle='#2a2a3a';bRCtx.lineWidth=lw;bRCtx.lineCap='round';
  bRCtx.beginPath();bRCtx.arc(cx,cy,r,-Math.PI*.75,Math.PI*.75);bRCtx.stroke();
  // Fill ring
  const pct=battery.pct/100;const col=battery.pct>50?'#10b981':battery.pct>20?'#f59e0b':'#ef4444';
  const endAngle=-Math.PI*.75+pct*Math.PI*1.5;
  bRCtx.strokeStyle=col;bRCtx.lineWidth=lw;bRCtx.lineCap='round';
  bRCtx.beginPath();bRCtx.arc(cx,cy,r,-Math.PI*.75,endAngle);bRCtx.stroke();
  // Glow
  bRCtx.shadowBlur=15;bRCtx.shadowColor=col;bRCtx.beginPath();bRCtx.arc(cx,cy,r,-Math.PI*.75,endAngle);bRCtx.stroke();bRCtx.shadowBlur=0;
  // Icon
  bRCtx.font='bold 22px sans-serif';bRCtx.fillStyle=col;bRCtx.textAlign='center';bRCtx.textBaseline='middle';
  bRCtx.fillText(battery.charging?'‚ö°':'üîã',cx,cy);bRCtx.textBaseline='alphabetic';bRCtx.textAlign='start';
}
function renderStationList(){
  const list=document.getElementById('stationList');list.innerHTML='';
  chargingStations.forEach(st=>{
    const dist=Math.sqrt((opt.x-st.x)**2+(opt.y-st.y)**2);
    const card=document.createElement('div');
    card.className=`station-card${battery.targetStation===st.id?' active':''}`;
    card.innerHTML=`<div class="st-icon">${st.icon}</div><div class="st-info"><div class="st-name">${st.name}</div><div class="st-detail">${st.power} ‚Ä¢ ${st.slots-st.usedSlots}/${st.slots} free ‚Ä¢ ${(dist/100).toFixed(0)}m away</div></div><div class="st-status ${st.status}">${st.status.toUpperCase()}</div>`;
    card.onclick=()=>{battery.targetStation=st.id;renderStationList();drawBattMap();addChargeLog(`Route set ‚Üí ${st.name}`)};
    list.appendChild(card);
  });
}
function goToNearestStation(){
  let best=null,bestD=Infinity;
  chargingStations.forEach(st=>{if(st.status==='available'){const d=Math.sqrt((opt.x-st.x)**2+(opt.y-st.y)**2);if(d<bestD){bestD=d;best=st}}});
  if(best){battery.targetStation=best.id;renderStationList();drawBattMap();addChargeLog(`‚ö° Auto-route ‚Üí ${best.name} (${(bestD/100).toFixed(0)}m)`)}
}
function addChargeLog(msg){
  const t=new Date().toTimeString().slice(0,8);const c=document.getElementById('chargeLog');
  const el=document.createElement('div');el.style.cssText='padding:2px 0;display:flex;gap:6px';
  el.innerHTML=`<span style="color:var(--dim)">${t}</span><span style="flex:1">${msg}</span>`;
  c.appendChild(el);c.scrollTop=c.scrollHeight;
}
function updateBattery(dt){
  if(battery.charging){battery.pct=Math.min(100,battery.pct+dt*2.5);battery.current=12+Math.random()*3;
    if(battery.pct>=100){battery.charging=false;battery.targetStation=null;addChargeLog('‚úì Fully charged ‚Äî resuming tasks')}}
  else{battery.pct=Math.max(0,battery.pct-dt*0.03);battery.current=-(3+Math.random()*2)}
  battery.voltage=42+battery.pct/100*6.5+Math.random()*.2;
  battery.temp=30+Math.abs(battery.current)*0.4+Math.random()*2;
  const col=battery.pct>50?'var(--green)':battery.pct>20?'var(--yellow)':'var(--red)';
  document.getElementById('battPctBig').textContent=battery.pct.toFixed(1)+'%';
  document.getElementById('battPctBig').style.color=col;
  document.getElementById('battState').textContent=battery.charging?'‚ö° Charging':'Discharging';
  document.getElementById('battVolt').textContent=battery.voltage.toFixed(1)+'V';
  document.getElementById('battAmp').textContent=(battery.charging?'+':'')+battery.current.toFixed(1)+'A';
  document.getElementById('battAmpSub').textContent=battery.charging?'Fast Charging':'Discharging';
  document.getElementById('battTemp').textContent=battery.temp.toFixed(0)+'¬∞C';
  document.getElementById('battRange').textContent=(battery.pct/100*14.8).toFixed(1)+' km';
  document.getElementById('battRangeSub').textContent='~'+(battery.pct/100*4.9).toFixed(1)+' hrs walk';
  document.getElementById('battPower').textContent=(Math.abs(battery.current)*battery.voltage).toFixed(0)+'W';
  // Also update tech tab battery
  document.getElementById('battVal').textContent=battery.pct.toFixed(0)+'%';document.getElementById('battBar').style.width=battery.pct+'%';
  // Low battery auto-navigate
  if(battery.pct<15&&!battery.charging&&!battery.targetStation){goToNearestStation();addChargeLog('‚ö† LOW BATTERY ‚Äî auto-routing to charger')}
  // Check if near target station
  if(battery.targetStation){
    const st=chargingStations.find(s=>s.id===battery.targetStation);
    if(st){const d=Math.sqrt((opt.x-st.x)**2+(opt.y-st.y)**2);if(d<60&&!battery.charging){battery.charging=true;addChargeLog('üîå Connected to '+st.name+' ‚Äî charging started')}}
  }
  drawBattRing();
  // Randomly change station statuses
  if(Math.random()<.002){const st=chargingStations[Math.floor(Math.random()*chargingStations.length)];if(st.id!==battery.targetStation){const statuses=['available','available','available','busy'];st.status=statuses[Math.floor(Math.random()*statuses.length)];st.usedSlots=st.status==='busy'?st.slots:Math.floor(Math.random()*(st.slots-1))}}
}

// ==================== TODO LIST ====================
const weekSchedule=[
  {day:'Senin',date:'17 Feb',type:'weekday',tasks:[
    {time:'06:00-07:30',name:'Antar Koran & Surat',loc:'Perumahan Elite Sudirman',cat:'work',energy:8,status:'done'},
    {time:'08:00-10:00',name:'Cuci Mobil (5 unit)',loc:'Garage Pak Hartono, Menteng',cat:'work',energy:15,status:'done'},
    {time:'10:30-12:00',name:'Bersihkan Got & Gorong-gorong',loc:'Jl. Sudirman Blok A-D',cat:'work',energy:18,status:'progress'},
    {time:'13:00-15:00',name:'Benerin Mobil (Ganti Oli + Filter)',loc:'Bengkel Jaya Motor',cat:'maintenance',energy:12,status:'pending'},
    {time:'15:30-17:00',name:'Antar Paket E-Commerce',loc:'Area Sudirman-Thamrin',cat:'work',energy:10,status:'pending'}
  ]},
  {day:'Selasa',date:'18 Feb',type:'weekday',tasks:[
    {time:'06:00-07:30',name:'Antar Koran & Surat',loc:'Perumahan Green Garden',cat:'work',energy:8,status:'pending'},
    {time:'08:00-11:00',name:'Cuci Kuda (3 ekor)',loc:'Sentul Highland Stable',cat:'work',energy:22,status:'pending'},
    {time:'11:30-13:00',name:'Bersihkan Got',loc:'Jl. Gatot Subroto',cat:'work',energy:15,status:'pending'},
    {time:'14:00-16:00',name:'Angkut Material Bangunan',loc:'Proyek Gedung Baru, Kuningan',cat:'work',energy:20,status:'pending'},
    {time:'16:30-17:30',name:'Charging Session',loc:'Station Epsilon ‚Äî City Center',cat:'charge',energy:-40,status:'pending'}
  ]},
  {day:'Rabu',date:'19 Feb',type:'weekday',tasks:[
    {time:'06:00-07:30',name:'Antar Koran & Surat',loc:'Komplek BSD Serpong',cat:'work',energy:8,status:'pending'},
    {time:'08:00-10:30',name:'Bersihkan Gorong-gorong Besar',loc:'Underpass Senen-Kemayoran',cat:'work',energy:25,status:'pending'},
    {time:'11:00-12:30',name:'Cuci Mobil (3 unit)',loc:'Showroom Honda, Kelapa Gading',cat:'work',energy:10,status:'pending'},
    {time:'13:30-15:00',name:'Benerin AC Mobil',loc:'Bengkel Jaya Motor',cat:'maintenance',energy:14,status:'pending'},
    {time:'15:30-17:00',name:'Patrol Keamanan Komplek',loc:'Perumahan Green Garden',cat:'work',energy:8,status:'pending'}
  ]},
  {day:'Kamis',date:'20 Feb',type:'weekday',tasks:[
    {time:'06:00-07:30',name:'Antar Koran & Surat',loc:'Perumahan PIK',cat:'work',energy:8,status:'pending'},
    {time:'08:00-11:00',name:'Cuci Kuda (4 ekor)',loc:'Sentul Highland Stable',cat:'work',energy:28,status:'pending'},
    {time:'11:30-13:00',name:'Bersihkan Got Area Pasar',loc:'Pasar Tanah Abang',cat:'work',energy:18,status:'pending'},
    {time:'14:00-15:30',name:'Benerin Mobil (Rem + Suspensi)',loc:'Bengkel Jaya Motor',cat:'maintenance',energy:15,status:'pending'},
    {time:'16:00-17:00',name:'Charging Session',loc:'Station Delta ‚Äî SE Corner',cat:'charge',energy:-35,status:'pending'}
  ]},
  {day:'Jumat',date:'21 Feb',type:'weekday',tasks:[
    {time:'06:00-07:30',name:'Antar Koran & Surat',loc:'Area Bundaran HI',cat:'work',energy:8,status:'pending'},
    {time:'08:00-10:00',name:'Cuci Mobil (4 unit)',loc:'Parkiran Mall Grand Indonesia',cat:'work',energy:13,status:'pending'},
    {time:'10:30-12:00',name:'Bersihkan Got & Saluran Air',loc:'Jl. Thamrin',cat:'work',energy:16,status:'pending'},
    {time:'13:30-15:00',name:'Angkut Sampah Besar',loc:'TPS Menteng ‚Üí TPA Bantargebang',cat:'work',energy:22,status:'pending'},
    {time:'15:30-17:00',name:'Weekly Report & Self-Diagnostic',loc:'Home Base',cat:'maintenance',energy:5,status:'pending'}
  ]},
  {day:'Sabtu',date:'22 Feb',type:'weekend',tasks:[
    {time:'07:00-09:00',name:'Main Padel üéæ',loc:'Padel Court, SCBD Jakarta',cat:'leisure',energy:12,status:'pending'},
    {time:'09:30-11:00',name:'Full Charging Session',loc:'Station Epsilon ‚Äî City Center',cat:'charge',energy:-60,status:'pending'},
    {time:'11:30-13:00',name:'Self-Maintenance Check',loc:'Bengkel Optimus Home Base',cat:'maintenance',energy:5,status:'pending'},
    {time:'14:00-16:00',name:'Main Padel (Turnamen Robot) üèÜ',loc:'Padel Arena Senayan',cat:'leisure',energy:18,status:'pending'}
  ]},
  {day:'Minggu',date:'23 Feb',type:'weekend',tasks:[
    {time:'07:00-09:00',name:'Morning Walk & Area Scan',loc:'Taman Suropati',cat:'leisure',energy:6,status:'pending'},
    {time:'09:30-11:30',name:'Ke Bengkel (Service Berkala)',loc:'Bengkel Robot Specialist, Kemang',cat:'maintenance',energy:10,status:'pending'},
    {time:'12:00-14:00',name:'Full Charging + Calibration',loc:'Station Epsilon ‚Äî Ultra-Fast',cat:'charge',energy:-80,status:'pending'},
    {time:'15:00-17:00',name:'Main Padel Santai üéæ',loc:'Padel Court, PIK',cat:'leisure',energy:10,status:'pending'}
  ]}
];
function renderTodoList(){
  const week=document.getElementById('todoWeek');week.innerHTML='';
  let totalTasks=0,doneTasks=0,progressTasks=0,totalEnergy=0;
  weekSchedule.forEach(day=>{
    const col=document.createElement('div');col.className='day-col';
    col.innerHTML=`<div class="day-header ${day.type}"><span>${day.day}</span><span class="day-date">${day.date}</span></div>`;
    const tasksDiv=document.createElement('div');tasksDiv.className='day-tasks';
    day.tasks.forEach(task=>{
      totalTasks++;
      if(task.status==='done')doneTasks++;
      if(task.status==='progress')progressTasks++;
      if(task.energy>0)totalEnergy+=task.energy;
      const card=document.createElement('div');card.className=`task-card ${task.cat}`;
      const statusLabel=task.status==='done'?'‚úì DONE':task.status==='progress'?'‚óè ACTIVE':'PENDING';
      const statusColor=task.status==='done'?'var(--green)':task.status==='progress'?'var(--yellow)':'var(--dim)';
      const energyColor=task.energy<0?'var(--green)':task.energy>15?'var(--red)':'var(--yellow)';
      const energyLabel=task.energy<0?`+${Math.abs(task.energy)}% charge`:`-${task.energy}% battery`;
      const barW=Math.min(100,Math.abs(task.energy)*2);
      card.innerHTML=`<div class="task-time">${task.time}</div><div class="task-name">${task.name}</div><div class="task-loc">üìç ${task.loc}</div><div class="task-status" style="color:${statusColor};border:1px solid ${statusColor};background:${statusColor}15">${statusLabel}</div><div class="task-energy"><span style="color:${energyColor}">${energyLabel}</span><div class="energy-bar"><div class="energy-fill" style="width:${barW}%;background:${energyColor}"></div></div></div>`;
      tasksDiv.appendChild(card);
    });
    col.appendChild(tasksDiv);week.appendChild(col);
  });
  document.getElementById('todoTotal').textContent=totalTasks;
  document.getElementById('todoDone').textContent=doneTasks;
  document.getElementById('todoProgress').textContent=progressTasks;
  document.getElementById('todoEnergy').textContent=(totalEnergy*0.048).toFixed(1)+' kWh';
}

// Simulate task progress over time
let taskProgressTimer=0;
function updateTaskProgress(dt){
  taskProgressTimer+=dt;
  if(taskProgressTimer>15){taskProgressTimer=0;
    for(const day of weekSchedule){for(const task of day.tasks){
      if(task.status==='progress'){task.status='done';renderTodoList();return}
      if(task.status==='pending'){task.status='progress';renderTodoList();return}
    }}
  }
}

// ==================== DAMAGE & REPAIR SYSTEM ====================
const bodyComponents=[
  {id:'head',name:'Head Unit',health:92,maxHealth:100,x:'50%',y:'14%',part:'Helm sensor array + visor'},
  {id:'torso',name:'Chest / Torso',health:85,maxHealth:100,x:'50%',y:'37%',part:'Core reactor + chest armor'},
  {id:'lshoulder',name:'Left Shoulder',health:88,maxHealth:100,x:'76%',y:'27%',part:'Shoulder servo + armor plate'},
  {id:'rshoulder',name:'Right Shoulder',health:95,maxHealth:100,x:'24%',y:'27%',part:'Shoulder servo + armor plate'},
  {id:'larm',name:'Left Arm',health:78,maxHealth:100,x:'78%',y:'48%',part:'Actuator + forearm hydraulics'},
  {id:'rarm',name:'Right Arm',health:90,maxHealth:100,x:'22%',y:'48%',part:'Actuator + forearm hydraulics'},
  {id:'lhand',name:'Left Hand',health:72,maxHealth:100,x:'78%',y:'62%',part:'Grip servos + tactile sensors'},
  {id:'rhand',name:'Right Hand',health:94,maxHealth:100,x:'22%',y:'62%',part:'Grip servos + tactile sensors'},
  {id:'waist',name:'Waist Joint',health:90,maxHealth:100,x:'50%',y:'52%',part:'Hip actuator + rotation ring'},
  {id:'lleg',name:'Left Leg',health:82,maxHealth:100,x:'58%',y:'68%',part:'Thigh servo + knee joint'},
  {id:'rleg',name:'Right Leg',health:86,maxHealth:100,x:'42%',y:'68%',part:'Thigh servo + knee joint'},
  {id:'lfoot',name:'Left Foot',health:75,maxHealth:100,x:'60%',y:'84%',part:'Wheel + ankle gyroscope'},
  {id:'rfoot',name:'Right Foot',health:80,maxHealth:100,x:'40%',y:'84%',part:'Wheel + ankle gyroscope'}
];

const repairHistory=[
  {date:'15 Feb 2026',title:'Tabrakan dengan Tiang Lampu',desc:'Sensor LiDAR depan terbentur saat navigasi malam. Visor retak minor.',cost:'Rp 2.800.000',severity:'warning',status:'‚úì Fixed'},
  {date:'12 Feb 2026',title:'Kerusakan Tangan Kiri (Cuci Kuda)',desc:'Grip servo overload saat menahan kuda yang panik di Sentul. Motor servo kiri perlu recalibrate.',cost:'Rp 4.200.000',severity:'critical',status:'‚úì Fixed'},
  {date:'10 Feb 2026',title:'Ganti Ban / Wheel Bearing',desc:'Wheel bearing kaki kiri aus setelah 1200km jalan kota. Diganti dengan heavy-duty bearing.',cost:'Rp 1.500.000',severity:'routine',status:'‚úì Fixed'},
  {date:'8 Feb 2026',title:'Kena Banjir Got (Gorong-gorong)',desc:'Air kotor masuk ke lower leg joint saat bersihkan gorong-gorong. Perlu flushing & waterproof seal baru.',cost:'Rp 3.100.000',severity:'warning',status:'‚úì Fixed'},
  {date:'5 Feb 2026',title:'Servis Berkala ‚Äî 500 Jam',desc:'Full diagnostic, joint lubrication, firmware update v4.1.8 ‚Üí v4.2.1, sensor recalibration.',cost:'Rp 5.500.000',severity:'routine',status:'‚úì Done'},
  {date:'1 Feb 2026',title:'Ditabrak Mobil di Persimpangan',desc:'Mobil menerobos lampu merah, tabrakan sisi kanan. Shoulder plate penyok, arm actuator misaligned.',cost:'Rp 8.700.000',severity:'accident',status:'‚úì Fixed'},
  {date:'28 Jan 2026',title:'Overheat saat Benerin Mobil',desc:'Thermal management gagal saat kerja di bawah mobil (suhu 48¬∞C). Emergency shutdown, coolant refill.',cost:'Rp 1.200.000',severity:'critical',status:'‚úì Fixed'},
  {date:'25 Jan 2026',title:'Kerusakan Kaki ‚Äî Lubang Jalan',desc:'Kaki kanan masuk lubang jalan besar di Jl. Sudirman. Ankle gyroscope error, perlu recalibrate.',cost:'Rp 2.400.000',severity:'warning',status:'‚úì Fixed'},
  {date:'20 Jan 2026',title:'Ganti Chest Armor Plate',desc:'Armor dada sudah terlalu banyak lecet dari kerja harian. Ganti dengan armor plate baru titanium alloy.',cost:'Rp 12.000.000',severity:'routine',status:'‚úì Done'},
  {date:'15 Jan 2026',title:'Software Crash ‚Äî Navigation Module',desc:'Bug di SLAM module menyebabkan robot jalan berputar-putar. Hotfix patch v4.1.7b deployed.',cost:'Rp 800.000',severity:'warning',status:'‚úì Fixed'},
  {date:'10 Jan 2026',title:'Kerusakan Visor ‚Äî Anak Lempar Batu',desc:'Anak kecil lempar batu ke kepala robot. Visor kaca tergores, perlu polish & coating ulang.',cost:'Rp 1.800.000',severity:'accident',status:'‚úì Fixed'}
];

const spareParts=[
  {name:'Servo Motor (Joint)',stock:8,min:4,unit:'pcs',price:'Rp 850k/pc'},
  {name:'Hydraulic Actuator',stock:3,min:2,unit:'pcs',price:'Rp 2.1M/pc'},
  {name:'Armor Plate (Titanium)',stock:2,min:2,unit:'pcs',price:'Rp 6M/pc'},
  {name:'LiDAR Sensor',stock:1,min:1,unit:'pcs',price:'Rp 15M/pc'},
  {name:'Vision Camera',stock:2,min:1,unit:'pcs',price:'Rp 4.5M/pc'},
  {name:'Wheel Bearing',stock:6,min:4,unit:'pcs',price:'Rp 350k/pc'},
  {name:'Grip Servo (Hand)',stock:4,min:2,unit:'pcs',price:'Rp 1.2M/pc'},
  {name:'Coolant Fluid',stock:5,min:3,unit:'liter',price:'Rp 180k/L'},
  {name:'Joint Lubricant',stock:8,min:4,unit:'tube',price:'Rp 95k/tube'},
  {name:'Waterproof Seal Kit',stock:3,min:2,unit:'set',price:'Rp 450k/set'},
  {name:'Gyroscope Module',stock:2,min:1,unit:'pcs',price:'Rp 3.2M/pc'},
  {name:'Battery Cell (Replace)',stock:1,min:1,unit:'pcs',price:'Rp 28M/pc'},
  {name:'Visor Glass',stock:2,min:1,unit:'pcs',price:'Rp 1.8M/pc'},
  {name:'Cable Harness Set',stock:4,min:2,unit:'set',price:'Rp 650k/set'}
];

function renderDamageIndicators(){
  const wrap=document.getElementById('dmgIndicators');wrap.innerHTML='';
  bodyComponents.forEach(c=>{
    const sev=c.health>85?'minor':c.health>70?'warning':'critical';
    if(c.health<95){
      const dot=document.createElement('div');
      dot.className=`dmg-indicator ${sev}`;
      dot.style.left=c.x;dot.style.top=c.y;
      dot.title=`${c.name}: ${c.health}%`;
      dot.onmouseenter=()=>{const tt=document.getElementById('dmgTooltip');if(!tt)return;tt.style.display='block';tt.style.left=c.x;tt.style.top=`calc(${c.y} - 30px)`;tt.innerHTML=`<span style="color:${sev==='critical'?'var(--red)':sev==='warning'?'var(--yellow)':'var(--green)'}">${c.name}</span> ‚Äî ${c.health}%<br><span style="color:var(--dim)">${c.part}</span>`};
      dot.onmouseleave=()=>{const tt=document.getElementById('dmgTooltip');if(tt)tt.style.display='none'};
      wrap.appendChild(dot);
    }
  });
  // Add tooltip div
  if(!document.getElementById('dmgTooltip')){const tt=document.createElement('div');tt.id='dmgTooltip';tt.className='dmg-tooltip';document.getElementById('dmgBodyWrap').appendChild(tt)}
}

function renderComponentHealth(){
  const container=document.getElementById('componentHealth');container.innerHTML='';
  bodyComponents.forEach(c=>{
    const col=c.health>85?'var(--green)':c.health>70?'var(--yellow)':'var(--red)';
    const div=document.createElement('div');div.style.cssText='margin-bottom:6px';
    div.innerHTML=`<div style="display:flex;justify-content:space-between;font-size:9px;margin-bottom:2px"><span style="color:var(--dim)">${c.name}</span><span style="font-weight:700;color:${col};font-family:JetBrains Mono,monospace">${c.health}%</span></div><div class="component-bar"><div class="component-fill" style="width:${c.health}%;background:${col}"></div></div>`;
    container.appendChild(div);
  });
}

function renderRepairHistory(){
  const timeline=document.getElementById('repairTimeline');timeline.innerHTML='';
  repairHistory.forEach(r=>{
    const entry=document.createElement('div');entry.className=`repair-entry ${r.severity}`;
    entry.innerHTML=`<div class="re-date">${r.date}</div><div class="re-title">${r.title}</div><div class="re-desc">${r.desc}</div><div class="re-cost">üí∞ ${r.cost}</div><div class="re-status" style="color:var(--green);border:1px solid var(--green);background:rgba(16,185,129,.1)">${r.status}</div>`;
    timeline.appendChild(entry);
  });
}

function renderSpareParts(){
  const tbody=document.getElementById('partsTableBody');tbody.innerHTML='';
  spareParts.forEach(p=>{
    const status=p.stock>p.min?'ok':p.stock===p.min?'low':'out';
    const label=status==='ok'?'IN STOCK':status==='low'?'LOW':'OUT';
    const tr=document.createElement('tr');
    tr.innerHTML=`<td style="font-weight:600">${p.name}<br><span style="font-size:8px;color:var(--dim)">${p.price}</span></td><td style="font-family:JetBrains Mono,monospace;font-weight:700">${p.stock} ${p.unit}</td><td><span class="stock-badge ${status}">${label}</span></td>`;
    tbody.appendChild(tr);
  });
}

function renderCostSummary(){
  const costs=[
    {label:'Spare Parts',val:'Rp 18.500.000',pct:38,col:'var(--accent)'},
    {label:'Labor / Service',val:'Rp 12.200.000',pct:25,col:'var(--accent2)'},
    {label:'Emergency Repairs',val:'Rp 8.700.000',pct:18,col:'var(--red)'},
    {label:'Charging Energy',val:'Rp 4.800.000',pct:10,col:'var(--yellow)'},
    {label:'Software License',val:'Rp 3.200.000',pct:7,col:'var(--green)'},
    {label:'Insurance',val:'Rp 1.100.000',pct:2,col:'var(--dim)'}
  ];
  const container=document.getElementById('costSummary');container.innerHTML='';
  costs.forEach(c=>{
    const div=document.createElement('div');div.style.cssText='background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:6px 8px';
    div.innerHTML=`<div style="display:flex;justify-content:space-between;font-size:9px;margin-bottom:2px"><span style="color:var(--dim)">${c.label}</span><span style="font-weight:700;font-family:JetBrains Mono,monospace;color:${c.col}">${c.val}</span></div><div class="component-bar"><div class="component-fill" style="width:${c.pct}%;background:${c.col}"></div></div>`;
    container.appendChild(div);
  });
  const total=document.createElement('div');total.style.cssText='background:linear-gradient(135deg,rgba(0,212,255,.06),rgba(124,58,237,.06));border:1px solid var(--accent);border-radius:6px;padding:8px 10px;text-align:center';
  total.innerHTML=`<div style="font-size:8px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px">Total Monthly</div><div style="font-size:16px;font-weight:900;color:var(--accent);font-family:JetBrains Mono,monospace">Rp 48.500.000</div>`;
  container.appendChild(total);
}

function renderDmgAlerts(){
  const alerts=[
    {sev:'warning',msg:'Left Hand grip servo dropping ‚Äî 72% health',time:'2 hrs ago'},
    {sev:'minor',msg:'Left Foot wheel bearing wear detected ‚Äî schedule replacement',time:'5 hrs ago'},
    {sev:'warning',msg:'Left Arm actuator needs recalibration after heavy load task',time:'1 day ago'},
    {sev:'minor',msg:'Chest armor surface scratches accumulating ‚Äî cosmetic only',time:'3 days ago'}
  ];
  const container=document.getElementById('dmgAlerts');container.innerHTML='';
  alerts.forEach(a=>{
    const col=a.sev==='critical'?'var(--red)':a.sev==='warning'?'var(--yellow)':'var(--green)';
    const icon=a.sev==='critical'?'üî¥':a.sev==='warning'?'üü°':'üü¢';
    const div=document.createElement('div');div.style.cssText=`background:var(--surface);border:1px solid var(--border);border-left:3px solid ${col};border-radius:6px;padding:6px 8px;font-size:10px`;
    div.innerHTML=`<div style="display:flex;gap:5px;align-items:flex-start"><span>${icon}</span><div style="flex:1"><div style="font-weight:600">${a.msg}</div><div style="font-size:8px;color:var(--dim);margin-top:2px">${a.time}</div></div></div>`;
    container.appendChild(div);
  });
}

function addDmgLog(msg){
  const t=new Date().toTimeString().slice(0,8);const c=document.getElementById('dmgLog');
  const el=document.createElement('div');el.style.cssText='padding:2px 0;display:flex;gap:6px';
  el.innerHTML=`<span style="color:var(--dim)">${t}</span><span style="flex:1">${msg}</span>`;
  c.appendChild(el);c.scrollTop=c.scrollHeight;while(c.children.length>80)c.removeChild(c.firstChild);
}

// Simulate random damage events
let dmgEventTimer=0;
function updateDamage(dt){
  dmgEventTimer+=dt;
  if(dmgEventTimer>20){dmgEventTimer=0;
    // Random minor wear
    const comp=bodyComponents[Math.floor(Math.random()*bodyComponents.length)];
    const wear=Math.random()*.8;
    comp.health=Math.max(10,comp.health-wear);
    if(wear>.5){
      addDmgLog(`‚ö† ${comp.name} wear: ${comp.health.toFixed(1)}% (${comp.part})`);
    }
    // If avoidance happened in sim, might cause minor damage
    if(opt.avoiding&&Math.random()<.3){
      const impactComp=bodyComponents[Math.floor(Math.random()*6)];
      const impactDmg=1+Math.random()*3;
      impactComp.health=Math.max(10,impactComp.health-impactDmg);
      addDmgLog(`üî¥ Impact on ${impactComp.name}! -${impactDmg.toFixed(1)}% ‚Üí ${impactComp.health.toFixed(1)}%`);
    }
    // Update overall
    const avg=bodyComponents.reduce((s,c)=>s+c.health,0)/bodyComponents.length;
    document.getElementById('dmgOverall').textContent=avg.toFixed(0)+'%';
    document.getElementById('dmgOverall').style.color=avg>80?'var(--green)':avg>60?'var(--yellow)':'var(--red)';
    // Re-render if on dmg tab
    if(document.getElementById('page-dmg').classList.contains('active')){
      renderDamageIndicators();renderComponentHealth();
    }
  }
  // Slow self-repair (nano-repair system)
  if(Math.random()<.005){
    const comp=bodyComponents.filter(c=>c.health<95).sort((a,b)=>a.health-b.health)[0];
    if(comp){comp.health=Math.min(100,comp.health+0.5);addDmgLog(`üîß Nano-repair: ${comp.name} +0.5% ‚Üí ${comp.health.toFixed(1)}%`)}
  }
}

// ==================== PADEL AI SYSTEM ====================
const padelC=document.getElementById('padelCanvas'),pCtx=padelC.getContext('2d');
// Court dimensions: 20m x 10m, walls on all sides, glass back walls
const COURT_L=20,COURT_W=10;
let pBall={x:10,y:5,vx:3,vy:2,spin:0,z:1.2,vz:0};
// Doubles: 2 vs 2 ‚Äî Padel is ALWAYS played in pairs
let pOptimus={x:4,y:3,tx:4,ty:3,speed:4.2,swinging:false,swingT:0,shot:'',role:'back'};
let pPartner={x:4,y:7,tx:4,ty:7,speed:4.0,swinging:false,swingT:0,shot:'',name:'NEXUS-4',role:'net'};
let pOpponent={x:16,y:3,tx:16,ty:3,speed:3.8,swinging:false,swingT:0,role:'back'};
let pOppPartner={x:16,y:7,tx:16,ty:7,speed:3.6,swinging:false,swingT:0,name:'VOLT-12',role:'net'};
let pScore={optimus:0,opponent:0,set:[0,0],game:[0,0],rally:0,totalRallies:0};
let pActiveMove='';let pTrainT=0;

const padelTechniques=[
  {id:'forehand',name:'Forehand Drive',icon:'üí™',desc:'Power forehand dari baseline, topspin agresif untuk push lawan ke belakang',speed:95,spin:80,power:90,acc:88},
  {id:'backhand',name:'Backhand Slice',icon:'üîÑ',desc:'Backspin slice untuk variasi tempo, bola rendah susah diangkat lawan',speed:75,spin:90,power:65,acc:92},
  {id:'smash',name:'Overhead Smash',icon:'‚ö°',desc:'Smash dari atas, shot paling powerful. Timing kritis ‚Äî 50ms window',speed:100,spin:40,power:100,acc:78},
  {id:'bandeja',name:'Bandeja',icon:'üéØ',desc:'Overhead cut shot khas padel, digunakan saat lawan lob. Kontrol > power',speed:60,spin:85,power:50,acc:95},
  {id:'vibora',name:'V√≠bora',icon:'üêç',desc:'Side-spin overhead ‚Äî bola memantul ke dinding samping lalu keluar sudut, sangat sulit di-return',speed:80,spin:95,power:70,acc:82},
  {id:'chiquita',name:'Chiquita',icon:'üçå',desc:'Soft lob pendek dari net ke kaca belakang. Memaksa lawan mundur dan buka posisi',speed:40,spin:70,power:30,acc:96},
  {id:'volley',name:'Net Volley',icon:'üèê',desc:'Volley agresif di depan net ‚Äî reflex shot, minimal backswing. Key untuk net dominance',speed:85,spin:50,power:75,acc:90},
  {id:'wallplay',name:'Wall Rebound',icon:'üß±',desc:'Baca pantulan dari dinding kaca, posisi kaki optimal untuk return. Unik di padel',speed:70,spin:60,power:55,acc:93},
  {id:'lob',name:'Defensive Lob',icon:'üåà',desc:'Lob tinggi ke belakang saat tertekan. Beli waktu untuk recovery posisi',speed:50,spin:45,power:40,acc:97},
  {id:'bajada',name:'Bajada (Off-Glass)',icon:'üíé',desc:'Attack langsung dari pantulan kaca belakang ‚Äî shot ofensif paling advanced',speed:88,spin:75,power:85,acc:74}
];

const matchResults=[
  {team:'OPTIMUS + NEXUS-4',opp:'ATLAS-X9 + VOLT-12 (Tesla)',result:'W',score:'6-4, 6-3',date:'15 Feb 2026',notes:'Net play dominance by NEXUS-4'},
  {team:'OPTIMUS + NEXUS-4',opp:'ASIMO-Pro + ASIMO-S2 (Honda)',result:'W',score:'7-5, 4-6, 6-2',date:'12 Feb 2026',notes:'OPTIMUS clutch serves in 3rd set'},
  {team:'OPTIMUS + NEXUS-4',opp:'DIGIT-v3 + DIGIT-v5 (Agility)',result:'W',score:'6-2, 6-1',date:'10 Feb 2026',notes:'Wall play coordination'},
  {team:'OPTIMUS + NEXUS-4',opp:'PHOENIX-R7 + PHOENIX-R9 (Samsung)',result:'L',score:'3-6, 6-7',date:'8 Feb 2026',notes:'Lost tiebreak ‚Äî comm error'},
  {team:'OPTIMUS + NEXUS-4',opp:'AMECA-Sport + AMECA-X (EA)',result:'W',score:'6-3, 6-4',date:'5 Feb 2026',notes:'Smash + volley combo'},
  {team:'OPTIMUS + NEXUS-4',opp:'ATLAS-X9 + VOLT-12 (Tesla)',result:'W',score:'6-4, 7-5',date:'1 Feb 2026',notes:'Revenge doubles match'},
  {team:'OPTIMUS + NEXUS-4',opp:'SPOT-T + SPOT-S (BD)',result:'W',score:'6-0, 6-1',date:'28 Jan 2026',notes:'Too slow for padel doubles'},
  {team:'OPTIMUS + NEXUS-4',opp:'PHOENIX-R7 + PHOENIX-R9 (Samsung)',result:'L',score:'4-6, 6-4, 5-7',date:'25 Jan 2026',notes:'Epic 3-set doubles battle'},
  {team:'OPTIMUS + NEXUS-4',opp:'UNITREE-H1 + UNITREE-G1 (Unitree)',result:'W',score:'6-2, 6-3',date:'22 Jan 2026',notes:'Speed + formation advantage'},
  {team:'OPTIMUS + NEXUS-4',opp:'NAO-Evo + NAO-V6 (Aldebaran)',result:'W',score:'6-1, 6-0',date:'20 Jan 2026',notes:'Size & coordination mismatch'}
];

const trainingModules=[
  {name:'Ball Trajectory Prediction',progress:97.8,col:'var(--accent)',episodes:'2.4M'},
  {name:'Opponent Shot Classification',progress:94.2,col:'var(--accent2)',episodes:'1.8M'},
  {name:'Footwork & Court Coverage',progress:94.6,col:'var(--green)',episodes:'3.1M'},
  {name:'Racket Swing Precision',progress:96.3,col:'var(--orange)',episodes:'4.5M'},
  {name:'Wall Rebound Physics',progress:92.1,col:'var(--yellow)',episodes:'2.0M'},
  {name:'Match Strategy (LLM)',progress:88.5,col:'var(--pink)',episodes:'50K matches'},
  {name:'Serve Placement',progress:91.7,col:'var(--red)',episodes:'1.2M'},
  {name:'Net Approach Timing',progress:89.3,col:'var(--accent)',episodes:'800K'}
];

function renderPadelTechniques(){
  const container=document.getElementById('padelTechniques');container.innerHTML='';
  padelTechniques.forEach(t=>{
    const card=document.createElement('div');
    card.className=`tech-card${pActiveMove===t.id?' active-move':''}`;
    card.onclick=()=>{pActiveMove=t.id;renderPadelTechniques()};
    card.innerHTML=`<div class="tc-icon">${t.icon}</div><div class="tc-name">${t.name}</div><div class="tc-desc">${t.desc}</div><div class="tc-stats"><span style="color:var(--green)">SPD ${t.speed}</span><span style="color:var(--yellow)">SPN ${t.spin}</span><span style="color:var(--red)">PWR ${t.power}</span></div>`;
    container.appendChild(card);
  });
}
function renderMatchHistory(){
  const container=document.getElementById('matchHistory');container.innerHTML='';
  matchResults.forEach(m=>{
    const row=document.createElement('div');row.className=`match-row ${m.result==='W'?'win':'loss'}`;
    row.innerHTML=`<div class="mr-result" style="color:${m.result==='W'?'var(--green)':'var(--red)'}">${m.result}</div><div class="mr-opp"><span style="font-size:8px;color:var(--accent)">vs</span> ${m.opp}<br><span style="font-size:8px;color:var(--dim)">${m.notes}</span></div><div class="mr-score">${m.score}</div><div class="mr-date">${m.date}</div>`;
    container.appendChild(row);
  });
}
function renderTrainingProgress(){
  const container=document.getElementById('trainingProgress');container.innerHTML='';
  trainingModules.forEach(t=>{
    const div=document.createElement('div');div.style.cssText='background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:6px 8px';
    div.innerHTML=`<div style="display:flex;justify-content:space-between;font-size:9px;margin-bottom:1px"><span style="color:var(--dim)">${t.name}</span><span style="font-weight:700;font-family:JetBrains Mono,monospace;color:${t.col}">${t.progress}%</span></div><div style="font-size:7px;color:var(--dim);font-family:JetBrains Mono,monospace;margin-bottom:2px">${t.episodes} episodes</div><div class="training-bar"><div class="training-fill" style="width:${t.progress}%;background:${t.col}"></div></div>`;
    container.appendChild(div);
  });
}
function addPadelLog(msg){
  const t=new Date().toTimeString().slice(0,8);const c=document.getElementById('padelLog');
  const el=document.createElement('div');el.style.cssText='padding:2px 0;display:flex;gap:6px';
  el.innerHTML=`<span style="color:var(--dim)">${t}</span><span style="flex:1">${msg}</span>`;
  c.appendChild(el);c.scrollTop=c.scrollHeight;while(c.children.length>60)c.removeChild(c.firstChild);
}

function resizePadel(){const r=padelC.parentElement;padelC.width=r.clientWidth;padelC.height=r.clientHeight}

function drawPadelCourt(){
  const W=padelC.width,H=padelC.height;if(!W)return;
  pCtx.fillStyle='#0a1628';pCtx.fillRect(0,0,W,H);
  // Scale court to fit canvas with padding
  const pad=40;const cw=W-pad*2,ch=H-pad*2;
  const sx=cw/COURT_L,sy=ch/COURT_W;const s=Math.min(sx,sy);
  const ox=(W-COURT_L*s)/2,oy=(H-COURT_W*s)/2;
  function cx(x){return ox+x*s}function cy(y){return oy+y*s}

  // Court surface ‚Äî blue padel court
  pCtx.fillStyle='#1a3a5a';pCtx.fillRect(cx(0),cy(0),COURT_L*s,COURT_W*s);

  // Service boxes
  pCtx.strokeStyle='rgba(255,255,255,.4)';pCtx.lineWidth=2;
  pCtx.strokeRect(cx(0),cy(0),COURT_L*s,COURT_W*s);
  // Center line
  pCtx.beginPath();pCtx.moveTo(cx(COURT_L/2),cy(0));pCtx.lineTo(cx(COURT_L/2),cy(COURT_W));pCtx.stroke();
  // Service lines
  pCtx.beginPath();pCtx.moveTo(cx(3),cy(0));pCtx.lineTo(cx(3),cy(COURT_W));pCtx.stroke();
  pCtx.beginPath();pCtx.moveTo(cx(17),cy(0));pCtx.lineTo(cx(17),cy(COURT_W));pCtx.stroke();
  // Service center marks
  pCtx.beginPath();pCtx.moveTo(cx(3),cy(COURT_W/2));pCtx.lineTo(cx(0),cy(COURT_W/2));pCtx.stroke();
  pCtx.beginPath();pCtx.moveTo(cx(17),cy(COURT_W/2));pCtx.lineTo(cx(COURT_L),cy(COURT_W/2));pCtx.stroke();
  // Net
  pCtx.strokeStyle='#ffffff';pCtx.lineWidth=3;pCtx.setLineDash([]);
  pCtx.beginPath();pCtx.moveTo(cx(COURT_L/2),cy(-0.3));pCtx.lineTo(cx(COURT_L/2),cy(COURT_W+0.3));pCtx.stroke();
  pCtx.strokeStyle='rgba(255,255,255,.3)';pCtx.lineWidth=1;pCtx.setLineDash([4,4]);
  for(let ny=0;ny<COURT_W;ny+=0.5){pCtx.beginPath();pCtx.moveTo(cx(COURT_L/2-0.1),cy(ny));pCtx.lineTo(cx(COURT_L/2+0.1),cy(ny));pCtx.stroke()}
  pCtx.setLineDash([]);

  // Glass walls ‚Äî semi-transparent borders
  pCtx.fillStyle='rgba(100,180,255,.08)';
  pCtx.fillRect(cx(-0.5),cy(0),0.5*s,COURT_W*s); // left back wall
  pCtx.fillRect(cx(COURT_L),cy(0),0.5*s,COURT_W*s); // right back wall
  pCtx.fillRect(cx(0),cy(-0.5),COURT_L*s,0.5*s); // top side wall
  pCtx.fillRect(cx(0),cy(COURT_W),COURT_L*s,0.5*s); // bottom side wall
  // Wall labels
  pCtx.font=`bold ${Math.max(8,s*.4)}px JetBrains Mono`;pCtx.fillStyle='rgba(100,180,255,.3)';pCtx.textAlign='center';
  pCtx.save();pCtx.translate(cx(-0.25),cy(COURT_W/2));pCtx.rotate(-Math.PI/2);pCtx.fillText('GLASS WALL',0,0);pCtx.restore();
  pCtx.save();pCtx.translate(cx(COURT_L+0.25),cy(COURT_W/2));pCtx.rotate(Math.PI/2);pCtx.fillText('GLASS WALL',0,0);pCtx.restore();
  pCtx.fillText('WIRE FENCE',cx(COURT_L/2),cy(-0.25));
  pCtx.fillText('WIRE FENCE',cx(COURT_L/2),cy(COURT_W+0.35));
  pCtx.textAlign='start';

  // Ball shadow
  const bsx=cx(pBall.x),bsy=cy(pBall.y);
  pCtx.fillStyle='rgba(0,0,0,.3)';pCtx.beginPath();pCtx.ellipse(bsx,bsy+pBall.z*s*.3,6+pBall.z*2,3+pBall.z,0,0,Math.PI*2);pCtx.fill();
  // Ball
  const bz=pBall.z*s*.15;
  const ballY=bsy-bz;
  pCtx.fillStyle='#ccff00';pCtx.strokeStyle='#aadd00';pCtx.lineWidth=1.5;
  pCtx.beginPath();pCtx.arc(bsx,ballY,5+Math.min(bz*.3,4),0,Math.PI*2);pCtx.fill();pCtx.stroke();
  // Ball trail
  pCtx.strokeStyle='rgba(204,255,0,.15)';pCtx.lineWidth=2;pCtx.setLineDash([3,3]);
  pCtx.beginPath();pCtx.moveTo(bsx,ballY);pCtx.lineTo(bsx-pBall.vx*s*.3,ballY-pBall.vy*s*.3);pCtx.stroke();pCtx.setLineDash([]);

  // === DRAW PLAYER FUNCTION (reusable for all 4 players) ===
  function drawPlayer(player,labelName,bodyColor,strokeColor,eyeColor,racketDir,isSwinging){
    const px=cx(player.x),py=cy(player.y);
    // Glow circle
    pCtx.fillStyle=strokeColor+'26';pCtx.beginPath();pCtx.arc(px,py,18,0,Math.PI*2);pCtx.fill();
    // Body
    pCtx.fillStyle=bodyColor;pCtx.strokeStyle=strokeColor;pCtx.lineWidth=2;
    pCtx.beginPath();pCtx.arc(px,py,10,0,Math.PI*2);pCtx.fill();pCtx.stroke();
    // Head
    const headCol=strokeColor==='#2a6aee'||strokeColor==='#10b981'?'#cc2222':'#333';
    pCtx.fillStyle=headCol;pCtx.beginPath();pCtx.arc(px,py-3,5,0,Math.PI*2);pCtx.fill();
    // Eyes
    pCtx.fillStyle=eyeColor;
    pCtx.beginPath();pCtx.arc(px-2,py-4,1.5,0,Math.PI*2);pCtx.fill();
    pCtx.beginPath();pCtx.arc(px+2,py-4,1.5,0,Math.PI*2);pCtx.fill();
    // Racket
    const rd=racketDir; // 1 = right, -1 = left
    if(isSwinging&&player.swinging){
      pCtx.strokeStyle='#ffdd00';pCtx.lineWidth=3;
      const sa=Math.sin(player.swingT*10)*15;
      pCtx.beginPath();pCtx.moveTo(px+8*rd,py);pCtx.lineTo(px+(18+sa)*rd,py-5);pCtx.stroke();
      pCtx.fillStyle='#ffdd0080';pCtx.beginPath();pCtx.arc(px+(18+sa)*rd,py-5,5,0,Math.PI*2);pCtx.fill();
    }else{
      pCtx.strokeStyle='#888';pCtx.lineWidth=2;
      pCtx.beginPath();pCtx.moveTo(px+8*rd,py);pCtx.lineTo(px+16*rd,py-8);pCtx.stroke();
      pCtx.fillStyle='#88888880';pCtx.beginPath();pCtx.arc(px+16*rd,py-8,4,0,Math.PI*2);pCtx.fill();
    }
    // Role indicator (NET / BACK)
    pCtx.font=`${Math.max(7,s*.28)}px JetBrains Mono`;pCtx.fillStyle=strokeColor+'90';pCtx.textAlign='center';
    pCtx.fillText(player.role.toUpperCase(),px,py+14);
    // Name
    pCtx.font=`bold ${Math.max(9,s*.4)}px JetBrains Mono`;pCtx.fillStyle=strokeColor;
    pCtx.fillText(labelName,px,py+24);pCtx.textAlign='start';
  }

  // Blue Team (left side): OPTIMUS + NEXUS-4
  drawPlayer(pOptimus,'OPTIMUS','#1a3a8a','#2a6aee','#44bbff',1,true);
  drawPlayer(pPartner,pPartner.name,'#1a5a3a','#10b981','#44ffaa',1,true);

  // Red Team (right side): ATLAS-X9 + VOLT-12
  drawPlayer(pOpponent,'ATLAS-X9','#5a1a1a','#ef4444','#ef4444',-1,true);
  drawPlayer(pOppPartner,pOppPartner.name,'#5a3a1a','#f59e0b','#f59e0b',-1,true);

  // Team labels at court edges
  pCtx.font=`bold ${Math.max(10,s*.45)}px JetBrains Mono`;pCtx.textAlign='center';pCtx.globalAlpha=.25;
  pCtx.fillStyle='#2a6aee';pCtx.fillText('BLUE TEAM',cx(COURT_L*.25),cy(COURT_W+1.2));
  pCtx.fillStyle='#ef4444';pCtx.fillText('RED TEAM',cx(COURT_L*.75),cy(COURT_W+1.2));
  pCtx.globalAlpha=1;pCtx.textAlign='start';

  // Court labels
  pCtx.font=`${Math.max(7,s*.3)}px JetBrains Mono`;pCtx.fillStyle='rgba(255,255,255,.15)';pCtx.textAlign='center';
  pCtx.fillText('SERVICE BOX',cx(1.5),cy(COURT_W/4));pCtx.fillText('SERVICE BOX',cx(1.5),cy(COURT_W*3/4));
  pCtx.fillText('SERVICE BOX',cx(18.5),cy(COURT_W/4));pCtx.fillText('SERVICE BOX',cx(18.5),cy(COURT_W*3/4));
  pCtx.textAlign='start';
}

function updatePadel(dt){
  // Ball physics
  pBall.x+=pBall.vx*dt;pBall.y+=pBall.vy*dt;pBall.z+=pBall.vz*dt;pBall.vz-=9.8*dt;
  // Floor bounce
  if(pBall.z<0.1){pBall.z=0.1;pBall.vz=Math.abs(pBall.vz)*.65;if(Math.abs(pBall.vz)<.5)pBall.vz=0}
  // Wall bounces
  if(pBall.y<0.2){pBall.y=0.2;pBall.vy=Math.abs(pBall.vy)*.8}
  if(pBall.y>COURT_W-0.2){pBall.y=COURT_W-0.2;pBall.vy=-Math.abs(pBall.vy)*.8}
  // Back wall bounces (glass)
  if(pBall.x<0.3){pBall.x=0.3;pBall.vx=Math.abs(pBall.vx)*.75}
  if(pBall.x>COURT_L-0.3){pBall.x=COURT_L-0.3;pBall.vx=-Math.abs(pBall.vx)*.75}
  // Slow down
  pBall.vx*=.998;pBall.vy*=.998;

  // === DOUBLES AI: Blue Team (Optimus + Nexus-4) ‚Äî left side ===
  const predX=pBall.x+pBall.vx*.4,predY=pBall.y+pBall.vy*.4;
  const ballOnBlue=pBall.vx<0; // ball heading to blue side

  // Doubles formation: one at net (y<5), one at back (y>5), swap roles dynamically
  // Optimus (primary) ‚Äî covers the ball side
  if(ballOnBlue){
    // Determine who chases: closer player to predicted ball position
    const distOpt=Math.sqrt((pOptimus.x-predX)**2+(pOptimus.y-predY)**2);
    const distPar=Math.sqrt((pPartner.x-predX)**2+(pPartner.y-predY)**2);
    if(distOpt<=distPar){
      // Optimus chases ball, Partner covers net
      pOptimus.role='back';pPartner.role='net';
      pOptimus.tx=Math.max(1,Math.min(9,predX-0.5));
      pOptimus.ty=Math.max(0.8,Math.min(COURT_W-0.8,predY));
      pPartner.tx=Math.max(2,Math.min(7,3+Math.sin(performance.now()*.0008)*1.5));
      pPartner.ty=predY<COURT_W/2?Math.min(COURT_W-1.5,COURT_W/2+2):Math.max(1.5,COURT_W/2-2);
    }else{
      // Partner chases ball, Optimus covers net
      pPartner.role='back';pOptimus.role='net';
      pPartner.tx=Math.max(1,Math.min(9,predX-0.5));
      pPartner.ty=Math.max(0.8,Math.min(COURT_W-0.8,predY));
      pOptimus.tx=Math.max(2,Math.min(7,3+Math.cos(performance.now()*.0008)*1.5));
      pOptimus.ty=predY<COURT_W/2?Math.min(COURT_W-1.5,COURT_W/2+2):Math.max(1.5,COURT_W/2-2);
    }
  }else{
    // Ball going away ‚Äî formation positioning
    pOptimus.role='back';pPartner.role='net';
    pOptimus.tx=3+Math.sin(performance.now()*.0006)*1.5;
    pOptimus.ty=COURT_W*.3+Math.sin(performance.now()*.001)*1.5;
    pPartner.tx=3+Math.cos(performance.now()*.0007)*1.5;
    pPartner.ty=COURT_W*.7+Math.cos(performance.now()*.001)*1.5;
  }

  // Move blue team players
  function movePlayer(p,dt){
    const dx=p.tx-p.x,dy=p.ty-p.y,d=Math.sqrt(dx*dx+dy*dy);
    if(d>.1){const spd=Math.min(p.speed*dt,d);p.x+=dx/d*spd;p.y+=dy/d*spd}
    if(p.swinging){p.swingT+=dt;if(p.swingT>.4)p.swinging=false}
  }
  movePlayer(pOptimus,dt);movePlayer(pPartner,dt);

  // Blue team hit ball ‚Äî whoever is closer
  function tryHitBlue(player){
    const dist=Math.sqrt((player.x-pBall.x)**2+(player.y-pBall.y)**2);
    if(dist<1.5&&pBall.vx<1&&!player.swinging){
      player.swinging=true;player.swingT=0;
      const tech=padelTechniques[Math.floor(Math.random()*padelTechniques.length)];
      pActiveMove=tech.id;
      // Net player hits more angled, back player hits more powerful
      const isNet=player.role==='net';
      pBall.vx=isNet?3+Math.random()*3:4+Math.random()*4;
      pBall.vy=(Math.random()-.5)*(isNet?8:6);
      pBall.vz=isNet?.5+Math.random()*1.5:1+Math.random()*3;
      pBall.spin=tech.spin;player.shot=tech.name;
      pScore.rally++;pScore.totalRallies++;
      renderPadelTechniques();
      return true;
    }
    return false;
  }
  if(!tryHitBlue(pOptimus))tryHitBlue(pPartner);

  // === DOUBLES AI: Red Team (Atlas-X9 + Volt-12) ‚Äî right side ===
  const ballOnRed=pBall.vx>0;
  if(ballOnRed){
    const distOpp=Math.sqrt((pOpponent.x-predX)**2+(pOpponent.y-predY)**2);
    const distOpp2=Math.sqrt((pOppPartner.x-predX)**2+(pOppPartner.y-predY)**2);
    if(distOpp<=distOpp2){
      pOpponent.role='back';pOppPartner.role='net';
      pOpponent.tx=Math.max(11,Math.min(19,predX+0.5));
      pOpponent.ty=Math.max(0.8,Math.min(COURT_W-0.8,predY));
      pOppPartner.tx=Math.max(13,Math.min(18,17+Math.sin(performance.now()*.0009)*1.5));
      pOppPartner.ty=predY<COURT_W/2?Math.min(COURT_W-1.5,COURT_W/2+2):Math.max(1.5,COURT_W/2-2);
    }else{
      pOppPartner.role='back';pOpponent.role='net';
      pOppPartner.tx=Math.max(11,Math.min(19,predX+0.5));
      pOppPartner.ty=Math.max(0.8,Math.min(COURT_W-0.8,predY));
      pOpponent.tx=Math.max(13,Math.min(18,17+Math.cos(performance.now()*.0009)*1.5));
      pOpponent.ty=predY<COURT_W/2?Math.min(COURT_W-1.5,COURT_W/2+2):Math.max(1.5,COURT_W/2-2);
    }
  }else{
    pOpponent.role='back';pOppPartner.role='net';
    pOpponent.tx=17+Math.sin(performance.now()*.0006)*1.5;
    pOpponent.ty=COURT_W*.3+Math.sin(performance.now()*.0011)*1.5;
    pOppPartner.tx=17+Math.cos(performance.now()*.0007)*1.5;
    pOppPartner.ty=COURT_W*.7+Math.cos(performance.now()*.0011)*1.5;
  }
  movePlayer(pOpponent,dt);movePlayer(pOppPartner,dt);

  // Red team hit ball ‚Äî whoever is closer
  function tryHitRed(player){
    const dist=Math.sqrt((player.x-pBall.x)**2+(player.y-pBall.y)**2);
    if(dist<1.5&&pBall.vx>-1&&!player.swinging){
      player.swinging=true;player.swingT=0;
      const isNet=player.role==='net';
      pBall.vx=isNet?-(3+Math.random()*3):-(4+Math.random()*3);
      pBall.vy=(Math.random()-.5)*(isNet?8:5);
      pBall.vz=isNet?.5+Math.random()*1.5:1+Math.random()*2;
      pScore.rally++;
      return true;
    }
    return false;
  }
  if(!tryHitRed(pOpponent))tryHitRed(pOppPartner);

  // Scoring ‚Äî if ball stops or goes too slow for too long
  const totalV=Math.abs(pBall.vx)+Math.abs(pBall.vy);
  if(totalV<0.3&&pBall.z<0.3){
    if(pBall.x<COURT_L/2){pScore.opponent++;addPadelLog(`‚ùå Point to Red Team (${pScore.optimus}-${pScore.opponent})`)}
    else{pScore.optimus++;addPadelLog(`‚úì Point to Blue Team! (${pScore.optimus}-${pScore.opponent})`)}
    // Reset ball ‚Äî serve (alternating server in doubles)
    const serverSide=(pScore.optimus+pScore.opponent)%4<2;
    pBall.x=serverSide?3:17;pBall.y=COURT_W/2+(Math.random()-.5)*3;
    pBall.vx=serverSide?5:-5;pBall.vy=(Math.random()-.5)*3;pBall.vz=2+Math.random()*2;
    pScore.rally=0;
    // Game scoring
    if(pScore.optimus>=4&&pScore.optimus-pScore.opponent>=2){pScore.game[0]++;pScore.optimus=0;pScore.opponent=0;addPadelLog(`üéæ Game Blue Team! (${pScore.game[0]}-${pScore.game[1]})`)}
    if(pScore.opponent>=4&&pScore.opponent-pScore.optimus>=2){pScore.game[1]++;pScore.optimus=0;pScore.opponent=0;addPadelLog(`üéæ Game Red Team (${pScore.game[0]}-${pScore.game[1]})`)}
    if(pScore.game[0]>=6&&pScore.game[0]-pScore.game[1]>=2){pScore.set[0]++;pScore.game=[0,0];addPadelLog(`üèÜ SET Blue Team! (${pScore.set[0]}-${pScore.set[1]})`)}
    if(pScore.game[1]>=6&&pScore.game[1]-pScore.game[0]>=2){pScore.set[1]++;pScore.game=[0,0];addPadelLog(`üèÜ SET Red Team (${pScore.set[0]}-${pScore.set[1]})`)}
  }

  // Update HUD
  const ballSpd=Math.sqrt(pBall.vx**2+pBall.vy**2)*3.6*2;
  document.getElementById('padelBallSpd').textContent=ballSpd.toFixed(0)+' km/h';
  document.getElementById('padelRally').textContent=pScore.rally;
  document.getElementById('padelReact').textContent=(75+Math.random()*20).toFixed(0)+' ms';
  document.getElementById('psOptimus').textContent=pScore.optimus;
  document.getElementById('psOpponent').textContent=pScore.opponent;
  document.getElementById('psSetScore').textContent=pScore.set[0]+'-'+pScore.set[1];
  document.getElementById('psGameScore').textContent=pScore.game[0]+'-'+pScore.game[1];
  // Strategy
  const strats=['Baseline','Net Rush','Wall Play','Defensive','Counter-Attack','Serve & Volley'];
  if(Math.random()<.005)document.getElementById('psStrat').textContent=strats[Math.floor(Math.random()*strats.length)];
}

let padelAnimating=false;
function padelLoop(){
  if(!document.getElementById('page-padel').classList.contains('active')){padelAnimating=false;return}
  updatePadel(1/60);drawPadelCourt();
  requestAnimationFrame(padelLoop);
}

// ==================== UPTIME ====================
const startTime=Date.now();
setInterval(()=>{const e=Math.floor((Date.now()-startTime)/1000);document.getElementById('uptime').textContent=`${String(Math.floor(e/3600)).padStart(2,'0')}:${String(Math.floor((e%3600)/60)).padStart(2,'0')}:${String(e%60).padStart(2,'0')}`},1000);

// ==================== GAME LOOP ====================
let lt=0,uiT=0;
function loop(now){
  const dt=Math.min((now-lt)/1000,.05);lt=now;
  autoSpawnCars(dt);update(dt);updateBattery(dt);updateTaskProgress(dt);updateDamage(dt);const inFov=getInFOV();classify(inFov);drawCity();drawVision(inFov);drawMM();
  uiT+=dt;if(uiT>.7){uiT=0;updateUI(inFov);if(document.getElementById('page-batt').classList.contains('active')){drawBattMap();renderStationList()}const logs=[['vision',`Tracking ${entities.length} entities`],['lidar',`${280+Math.floor(Math.random()*20)}K pts ‚Äî buildings mapped`],['nav',`Heading ${(opt.heading*180/Math.PI).toFixed(0)}¬∞ | ${(totalDist).toFixed(0)}m walked`],['traffic',`Signal: ${tlPhase.toUpperCase()} (${tlTimer.toFixed(1)}s)`]];const l=logs[Math.floor(Math.random()*logs.length)];addLog(l[0],l[1])}
  requestAnimationFrame(loop);
}

document.addEventListener('keydown',e=>{if(e.key===' '){toggleAuto();e.preventDefault()}if(e.key==='h')spawnEntity('human');if(e.key==='r')spawnEntity('robot');if(e.key==='c')spawnEntity('car');if(e.key==='k')spawnEntity('child');if(e.key==='f')toggleFOV()});

window.addEventListener('load',()=>{
  resize();genCity();
  // *** BUSY CITY ‚Äî spawn lots of entities immediately ***
  for(let i=0;i<25;i++)spawnEntity('human');
  for(let i=0;i<8;i++)spawnEntity('robot');
  for(let i=0;i<10;i++)spawnEntity('child');
  for(let i=0;i<15;i++)spawnEntity('car');
  tlTimer=TL_GREEN;
  addLog('nav','Optimus initialized ‚Äî Downtown City Walk');
  addLog('vision','ViT-L/14 + DETR: urban entity classifier ready');
  addLog('lidar','LiDAR 128ch: building + vehicle detection active');
  addLog('traffic','Traffic light system: GREEN/YELLOW/RED cycle');
  addLog('avoid','Collision avoidance: buildings, vehicles, pedestrians');
  addLog('nav','Auto-walk ON ‚Äî exploring busy city sidewalks');
  // Battery, Todo & Damage init
  renderStationList();renderTodoList();drawBattRing();
  renderDamageIndicators();renderComponentHealth();renderRepairHistory();renderSpareParts();renderCostSummary();renderDmgAlerts();
  renderPadelTechniques();renderMatchHistory();renderTrainingProgress();
  addPadelLog('üéæ Padel AI system online');
  addPadelLog('YOLOv9-Padel + LSTM trajectory predictor loaded');
  addPadelLog('PadelGPT strategy engine: ready');
  addPadelLog('Swing controller: 14 shot types calibrated');
  addPadelLog('Doubles mode: OPTIMUS+NEXUS-4 vs ATLAS-X9+VOLT-12');
  addChargeLog('System boot ‚Äî battery monitor online');
  addChargeLog(`Battery: ${battery.pct}% | Health: ${battery.health}%`);
  addChargeLog('8 charging stations mapped across city');
  addDmgLog('Damage monitor online ‚Äî 13 components tracked');
  addDmgLog('Nano-repair system: ACTIVE');
  addDmgLog('Next service: Minggu, 23 Feb 2026');
  // Tech tab boot
  setTimeout(()=>addTechLog('control','System boot: 1kHz tick confirmed'),100);
  setTimeout(()=>addTechLog('vision','ViT-L/14 + DETR loaded ‚Äî warm-up complete'),300);
  setTimeout(()=>addTechLog('fusion','Sensor fusion: EKF ready'),500);
  setTimeout(()=>addTechLog('world','World model: voxel map + Dreamer-v3 ready'),700);
  setTimeout(()=>addTechLog('planner','LLM (7B multimodal) + PDDL engine ready'),900);
  setTimeout(()=>addTechLog('rl','Policies: locomotion_v4, grasp_v2'),1100);
  setTimeout(()=>addTechLog('memory','Memory online ‚Äî city map from persistence'),1300);
  setTimeout(()=>addTechLog('control','‚úì ALL SYSTEMS NOMINAL'),1500);
  lt=performance.now();requestAnimationFrame(loop);
});
window.addEventListener('resize',resize);
</script>
</body>
</html>
